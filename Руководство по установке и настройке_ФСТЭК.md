Программный комплекс «FANSY»

Руководство по установке и настройке

RU-62.01.29-000-52775472-2024-01 85

Версия документа 1.0

Перечень сокращений

|  |  |
| --- | --- |
| **СУБД** | – система управления базами данных |
| **ОС** | – операционная система |
| **ПК** | – программный комплекс |
|  |  |
|  |  |
|  |  |

Содержание

[Перечень сокращений 2](#_Toc198553745)

[Содержание 3](#_Toc198553746)

[1 Введение 4](#_Toc198553747)

[1.1 Назначение программы 4](#_Toc198553748)

[1.2 Минимальный состав аппаратных средств 5](#_Toc198553749)

[1.3 Минимальный состав программных средств 5](#_Toc198553750)

[2 Настройка среды функционирования ПК «FANSY» 6](#_Toc198553751)

[2.1 Настройка серверной части 7](#_Toc198553752)

[3 Развертывание баз данных ПК FANSY 12](#_Toc198553753)

[3.1 Развертывание баз данных META и DATA в СУБД «Ред База Данных» 12](#_Toc198553754)

[3.2 Развертывание баз данных META и DATA в СУБД PostgreSQL 12](#_Toc198553755)

[4 Установка и настройка клиентской части ПК FANSY 14](#_Toc198553756)

# Введение

Настоящее руководство описывает установку и первоначальную настройку программного комплекса «FANSY» (далее ПК FANSY).

## Назначение программы

Программный комплекс «FANSY» используется для учета и отчетности не кредитных финансовых организаций и фондовых отделов кредитных финансовых организаций. Представляет из себя клиент-серверное приложение, состоящие из исполняемого файла, базы данных системных метафункций, базы данных, содержащей пользовательские данные, библиотеки шаблонов отчетов.

ПК FANSY включает в себя следующие компоненты:

* модуль для работы с электронными документами (система внутреннего учета депозитария «FANSY-DEPO», система внутреннего учета специализированного регистратора «FANSY-REESTR», система внутреннего учета «FANSY-SPECTRE», система автоматизации бэк-офиса фондового отдела банка «FANSY-TRUST», универсальная учетная система НФО «FANSY-STANDARD») для графического отображения документов и форм для работы с ними, а также взаимодействия между хранилищем программных настроек и хранилищем целевых данных;
* файл базы данных программных настроек и библиотек функций работы с документами, содержащий правила атрибутного разграничения доступа и библиотеку функций реализующих совокупность правил и ограничений автоматизируемых операций (bal\_meta);
* файл базы данных хранилища целевых данных (bal\_data, база DATA), содержащий данные, вводимые через интерфейс приложения пользователями ПК FANSY;
* библиотека шаблонов отчетов для вывода на печать стандартизированных отчетов пользователей ПК FANSY в виде файлов в формате табличного редактора сalc (формат электронных таблиц) пакета LibreOffice (содержимое папок «REPORT» и «MACROS»).

## Минимальный состав аппаратных средств

Для работы клиентской части ПК FANSY необходим персональный компьютер c процессором не менее 1ГГц, объемом оперативной памяти от 2 Гб и свободным дисковым пространством от 300 Гб.

Для работы серверной части необходим сервер с процессором от 2.6 ГГц, объемом оперативной памяти от 2Гб и свободным дисковым пространством от 300 Гб.

Данные параметры обозначены для первоначального запуска комплекса. В процессе эксплуатации база данных увеличивается и они должны быть пересмотрены в части объема оперативной памяти и дискового пространства.

Расчет оперативной памяти определяется исходя из объема базы DATA умноженного на 2.

## Минимальный состав программных средств

Для работы клиентской части ПК «FANSY» необходимы следующие программные компоненты:

* Операционная система РЕД ОС версии 7.3 х64 (сертификат соответствия ФСТЭК России № 4060, дата выдачи 12 января 2019 г.) или Операционная система специального назначения «Astra Linux Special Edition» 1.8 x64 (сертификат соответствия ФСТЭК России №2557, дата выдачи 27 января 2012 г.).
* LibreOffice из состава операционной системы (для визуализации стандартных отчетов).

Для работы серверной части ПК FANSY необходимы следующие программные компоненты:

* Операционная система РЕД ОС версии 7.3 х64 (сертификат соответствия ФСТЭК России № 4060, дата выдачи 12 января 2019 г.) или Операционная система специального назначения «Astra Linux Special Edition» 1.8 x64 (сертификат соответствия ФСТЭК России №2557, дата выдачи 27 января 2012 г.).
* СУБД «Ред База Данных» версии 5.0 (сертификат соответствия ФСТЭК России № 2729, дата выдачи 8 октября 2012 г.) или «Postgres Pro Enterprise» версии 16.4.1 (сертификат соответствия ФСТЭК России № 4063, дата выдачи 16 января 2019 г.) или PostgreSQL из состава ОС «Astra Linux Special Edition».

# Настройка среды функционирования ПК «FANSY»

Вне зависимости от комплектации, настройка среды функционирования состоит из двух этапов – настройка серверной части и настройка клиентской части.

Состав дистрибутива ПК FANSY:

1. **Каталог Fansy:**

* DEPO - папка с приложением "Депозитарий":
* DEPO\MACROS - папка с макросами для отчетов;
* DEPO\REPORT - папка с шаблонами для отчетов в формате xls;
* DEPO\DEPO.fansy - исполняемый файл;
* DEPO\depo.ico - иконка приложения для отображения на рабочем столе пользователя;
* DEPO\depo.desktop - шаблон ярлыка для рабочего стола пользователя;
* DEPO\depo.hash - текстовый файл с контрольной суммой исполняемого файла по алгоритмам SHA256 и ГОСТ Р 34.10-2012 (256 бит).
* SPECTRE - папка с приложением "Универсальная учетная система":
* SPECTRE\MACROS - папка с макросами для отчетов;
* SPECTRE\REPORT - папка с шаблонами для отчетов в формате xls;
* SPECTRE\SPECTRE.fansy - исполняемый файл;
* SPECTRE\spectre.ico - иконка приложения для отображения на рабочем столе пользователя;
* SPECTRE\spectre.desktop - шаблон ярлыка для рабочего стола пользователя;
* SPECTRE\spectre.hash - текстовый файл с контрольной суммой исполняемого файла по алгоритмам SHA256 и ГОСТ Р 34.10-2012 (256 бит).
* REESTR - папка с приложением "Система ведения специализированного регистратора":
* REESTR\MACROS - папка с макросами для отчетов;
* REESTR\REPORT - папка с шаблонами для отчетов в формате xls;
* REESTR\REESTR.fansy - исполняемый файл;
* REESTR\reestr.ico - иконка приложения для отображения на рабочем столе пользователя;
* REESTR\reestr.desktop - шаблон ярлыка для рабочего стола пользователя;
* REESTR\reestr.hash - текстовый файл с контрольной суммой исполняемого файла по алгоритмам SHA256 и ГОСТ Р 34.10-2012 (256 бит);
* STANDARD - папка с приложением "Универсальная учетная система НФО"
* STANDARD\MACROS - папка с макросами для отчетов;
* STANDARD\REPORT - папка с шаблонами для отчетов в формате xls;
* STANDARD\STANDARD.fansy - исполняемый файл;
* STANDARD\standard.ico - иконка приложения для отображения на рабочем столе пользователя;
* STANDARD\standard.desktop - шаблон ярлыка для рабочего стола пользователя;
* STANDARD\standard.hash - текстовый файл с контрольной суммой исполняемого файла по алгоритмам SHA256 и ГОСТ Р 34.10-2012 (256 бит);
* TRUST - папка с приложением "Бэк-Офис ФО Банка":
* TRUST\MACROS - папка с макросами для отчетов;
* TRUST\REPORT - папка с шаблонами для отчетов в формате xls;
* TRUST\TRUST.fansy - исполняемый файл;
* TRUST\trust.ico - иконка приложения для отображения на рабочем столе пользователя;
* TRUST\trust.desktop - шаблон ярлыка для рабочего стола пользователя;
* TRUST\trust.hash - текстовый файл с контрольной суммой исполняемого файла по алгоритмам SHA256 и ГОСТ Р 34.10-2012 (256 бит).
* Libs - папка с библиотеками, необходимыми для запуска приложений (используется инсталлятором START)
* Libs\reg.xml - шаблон, имитирующий разделы реестра для хранения данных приложений;

1. **Каталог Setup:**

* START.fansy - исполняемый файл инсталлятора приложений Fansy;
* START.hash - текстовый файл с контрольной суммой исполняемого файла по алгоритмам SHA256 и ГОСТ Р 34.10-2012 (256 бит);
* CHECKER.fansy - исполняемый файл программы проверки контрольных сумм объектов базы данных, отвечающих за предоставление прав доступа пользователям внутри приложений Fansy;
* CHECKER.hash - текстовый файл с контрольной суммой исполняемого файла по алгоритмам SHA256 и ГОСТ Р 34.10-2012 (256 бит).

1. **архив meta\_data\_pg.tar.gz cо схемами баз данных META и DATA для версии под СУБД «PostgreSQL» или meta\_data\_reddatabase.tar.gz для версии под СУБД «РЭД База данных».**

## Настройка серверной части

Независимо от выбранной СУБД, настройка серверной части будет состоять из установки СУБД, настройки пользователя «SYSDBA» в этой СУБД, развертывание баз META и DATA на сервере.

### Инсталляция СУБД «Ред База Данных»

Выполнить установку СУБД в режиме «Суперсервер» (рис.1).

[Рисунок удалён: ID\_1]

[Рисунок удалён: ID\_2]

Рисунок 1 – Окно выбора архитектуры установки сервера СУБД «Ред База Данных»

### Инсталляция СУБД PostgreSQL

* 1. Установить СУБД «Postgres Pro Enterprise» или CУБД из репозитория ОС «Astra Linux Special Edition».

Пример команды установки из репозитория ОС «Astra Linux»:

*sudo apt update*

*sudo apt install postgresql postgresql-contrib*

Проверить статус сервиса (должен запуститься автоматически):

*sudo systemctl status postgresql*

Если не запущен - запустить:

*sudo systemctl start postgresql*

Включить автозапуск:

*sudo systemctl enable postgresql*

Примечание.

В ОС «Astra Linux Special Edition» у учетной записи «postgres» нет пароля по умолчанию. Для корректной установки необходимо скорректировать файл /etc/postgresql/<версия>/main/pg\_hba.conf – строку:

*local all postgres trust*

Перезапустить сервис PostgreSQL командой *systemctl restart postgresql.service*

Для использования метода  md5  необходимо установить пароль для пользователя postgres командой

*ALTER USER postgres WITH PASSWORD 'Пароль';*

Cкорректировать файл /etc/postgresql/<версия>/main/pg\_hba.conf добавив в него строки:

*local all postgres md5*

*local all all md5*

Перезапустить сервис PostgreSQL командой

*systemctl restart postgresql.service.*

*Примечание 2*

Если система, при попытке авторизоваться под пользователем «postgres» все равно выдает сообщение «su: Доступ запрещен», то под Администратором повышаем уровень целостности МРД для пользователя «postgres» до максимального

*sudo pdpl-user -i 63 postgres*

После этого снова пробуем авторизоваться под пользователем «postgres»

* 1. Проверить установленную версию СУБД командой *psql -- version.*

Ожидаемый вывод: версия должна быть не ниже 14.x.

Пример вывода:

*psql --version*

*psql (PostgreSQL) 15.12 (Debian 15.12-astra.se1)*

* 1. Создать схемы bal\_meta и bal\_data:

*psql -U postgres -d postgres -c "CREATE SCHEMA bal\_data;"*

*psql -U postgres -d postgres -c "CREATE SCHEMA bal\_meta;"*

* 1. Создать директории под новые табличные пространства, закрепить за определенной группой и присвоить им разрешения.

Примечание. Рекомендуется разносить табличные пространства на разные физические носители.

В примере приведен пример установки в рамках одного диска:

*sudo mkdir -p /var/lib/postgresql/15/users*

*sudo mkdir -p /var/lib/postgresql/15/indx*

*sudo chown postgres:postgres /var/lib/postgresql/15/users*

*sudo chown postgres:postgres /var/lib/postgresql/15/indx*

*sudo chmod 700 /var/lib/postgresql/15/users*

*sudo chmod 700 /var/lib/postgresql/15/indx*

* 1. Создать табличные пространства :

*psql -U postgres -d postgres -c "CREATE TABLESPACE users LOCATION '/var/lib/postgresql/15/users';"*

*psql -U postgres -d postgres -c "CREATE TABLESPACE indx LOCATION '/var/lib/postgresql/15/indx';"*

* 1. Cоздать необходимые для развертывания баз роли.

Создать роли: «SYSDBA», «fansy\_users», «ADMIN», «USER», «GUEST». У роли «SYSDBA» должны быть все права на схемы «bal\_meta» и «bal\_data», у роли «fansy\_users» только на использование этих схем, роли «ADMIN», «USER», «GUEST» привязываются к роли «fansy\_users».

Последовательно выполнить следующие команды:

Создать роль «SYSDBA»:

*psql -U postgres -d postgres -c "CREATE ROLE \"SYSDBA\" LOGIN PASSWORD 'masterkey'; COMMENT ON ROLE \"SYSDBA\" IS 'СУПЕРАДМИНИСТРАТОР'; GRANT CONNECT ON DATABASE postgres TO \"SYSDBA\"; GRANT USAGE, CREATE ON SCHEMA bal\_meta TO \"SYSDBA\"; GRANT USAGE, CREATE ON SCHEMA bal\_data TO \"SYSDBA\";"*

Создать роль «fansy\_users»:

*psql -U postgres -d postgres -c "CREATE ROLE fansy\_users NOLOGIN; COMMENT ON ROLE fansy\_users IS 'ГРУППА ПОЛЬЗОВАТЕЛЕЙ FANSY'; GRANT USAGE ON SCHEMA bal\_meta TO fansy\_users; GRANT USAGE ON SCHEMA bal\_data TO fansy\_users;"*

Создать роль «ADMIN»:

*psql -U postgres -d postgres -c "CREATE ROLE \"ADMIN\" LOGIN PASSWORD 'masterkey' IN ROLE fansy\_users; COMMENT ON ROLE \"ADMIN\" IS 'АДМИНИСТРАТОР FANSY'; GRANT CONNECT ON DATABASE postgres TO \"ADMIN\";"*

Создать роль «USER»:

*psql -U postgres -d postgres -c "CREATE ROLE \"USER\" LOGIN PASSWORD 'masterkey' IN ROLE fansy\_users; COMMENT ON ROLE \"USER\" IS 'ПОЛЬЗОВАТЕЛЬ FANSY'; GRANT CONNECT ON DATABASE postgres TO \"USER\";"*

Создать роль «GUEST»:

*psql -U postgres -d postgres -c "CREATE ROLE \"GUEST\" LOGIN PASSWORD 'masterkey' IN ROLE fansy\_users; COMMENT ON ROLE \"GUEST\" IS 'ГОСТЬ FANSY'; GRANT CONNECT ON DATABASE postgres TO \"GUEST\";"*

# Развертывание баз данных ПК FANSY

Для корректной работы ПК FANSY необходимо развернуть на сервере ПК FANSY базы данных META и DATA в той СУБД, которая была выбрана и установлена, согласно рекомендациям в п.2.

База META - системная база данных, содержащая производственную логику приложения.

База DATA - системная база данных, содержащая рабочую информацию, данные о клиентах и совершенных операциях, по умолчанию в базе заполнены справочники ценных бумаг и информация об их эмитентах.

Для работы ПК FANSY в сетевом окружении требуются следующие разрешения:

1. клиентских подключений по следующим TCP-портам (указаны значения по умолчанию):

* 22 (ssh) – от рабочего места администратора ПК FANSY к cерверу ПК FANSY (технологическая оснастка для управления сервером ПК FANSY);
* 5432 (tcp) – от клиентов ПК FANSY к серверу ПК FANSY (СУБД PostgreSQL, БД META и DATA);
* 3050 (tcp) – от клиентов ПК FANSY к серверу ПК FANSY (СУБД «Ред База Данных», БД META и DATA);
* 445 (tcp) – от клиентов ПК FANSY к серверу ПК FANSY (для автоматизации установки обновлений на все рабочие места)

## Развертывание баз данных META и DATA в СУБД «Ред База Данных»

В каталоге /opt/RedDatabase создать папку data, распаковать архив bases\_backup.tar.gz c бэкапами баз БД META и DATA из состава дистрибутива:

*sudo mkdir /opt/RedDatabase/data*

*sudo tar -xzvf meta\_data\_reddatabase.tar.gz -C /opt/RedDatabase/data*

Встроенной утилитой gbak развернуть cхемы БД в эту же папку:

*sudo /opt/RedDatabase/bin/gbak –R –v /opt/RedDatabase/data/bal\_data.fbk /opt/RedDatabase/data/bal\_data.fdb*

*sudo /opt/RedDatabase/bin/gbak –R –v /opt/RedDatabase/data/bal\_meta.fbk /opt/RedDatabase/data/bal\_meta.fdb*

Назначить права на чтение и запись

*sudo chmod 666 /opt/RedDatabase/data/bal\_meta.fdb:*

*sudo chmod 666 /opt/RedDatabase/data/bal\_data.fdb*

## Развертывание баз данных META и DATA в СУБД PostgreSQL

Распаковать архив schemas\_backup.tar.gz со схемами БД META и DATA из состава дистрибутива в текущую папку:

*tar -xzvf schemas\_backup.tar.gz -C /home/admin/*

Выполнить команды установки, при запросе пароля – указать пароль заданный для учетной записи postgres:

*/usr/lib/postgresql/15/bin/pg\_restore -U postgres -d postgres --schema bal\_meta --single-transaction --verbose -W bal\_meta.sql*

*/usr/lib/postgresql/15/bin/pg\_restore -U postgres -d postgres --schema bal\_data --single-transaction --verbose -W bal\_data.sql*

# Установка и настройка клиентской части ПК FANSY

Установка клиентских компонент состоит из настройки доступности компонент системы на сервере и на клиенте.

В пп.4.1, 4.2, 4.3 и 4.4 приведена настройка ПК Fansy на сервере с учетной записью администратора (fansy) и на клиенте с учетной записью пользователя (fansyuser), непосредственно работающего с приложением ПК Fansy со своего рабочего места.

## Настройка рабочего пространства на сервере

### Для настройки автоматизированного обновления клиентской составляющей «ПК Fansy” необходимо настроить доступ к исполнимым файлам, макросам и файлам-шаблонам отчетов «ПК Fansy» с рабочих мест пользователей в среде функционирования ОС «Astra Linux Special Edition» 1.8 x64 выполнить действия приведенные в табл.1

Таблица 1 - Настройка рабочего пространства на сервере

|  |  |
| --- | --- |
| **Описание действия по настройке** | **Команда/ожидаемый результат выполнения** |
| Установить samba для настройки общего ресурса | sudo apt update  sudo apt install samba |
| Создать папку и подпапки | sudo mkdir -p /FansySrv/Fansy  sudo mkdir -p /FansySrv/Setup |
| Добавить пользователей рабочих мест, которые будут работать с ПК FANSY. Ниже рассмотрен случай, когда пользователь «fansy» - это администратор сервера, а «fansyuser» - пользователь рабочего места, к этому серверу подключающийся. | sudo adduser fansyuser |
| Создать группу для пользователей с доступом | sudo groupadd fansyusers |
| Добавить пользователей (fansy и fansyuser2) в группу | sudo usermod -aG fansyusers fansy  sudo usermod -aG fansyusers fansyuser |
| установить владельца и права | sudo chown -R :fansyusers /FansySrv  sudo chmod -R 770 /FansySrv |
| Ожидаемый вывод команды проверки прав доступа ls -ld /FansySrv /FansySrv/Fansy /FansySrv/Setup | drwxrwx--- root fansyusers |
| Отредактировать файл конфигурации /etc/samba/smb.conf, добавив новую секцию | [FansySrv]  path = /FansySrv  writable = yes  browsable = yes  guest ok = no  valid users = @fansyusers |
| Проверить синтаксис | sudo testparm |
| Перезапустить службы Samba | sudo systemctl restart smbd  sudo systemctl restart nmbd |
| Для каждого пользователя задать пароль | sudo smbpasswd -a fansy  sudo smbpasswd -a fansyuser |
| Перезагрузить сервер и проверить список пользователей | sudo pdbedit –L |

### Для настройки автоматизированного обновления клиентской составляющей «ПК Fansy” необходимо настроить доступ к исполнимым файлам, макросам и файлам-шаблонам отчетов «ПК Fansy» с рабочих мест пользователей в среде функционирования ОС «РЭД ОС 7.3» Mate x64 выполнить действия приведенные в табл.2

Таблица 2 - Настройка рабочего пространства на сервере

|  |  |
| --- | --- |
| **Описание действия по настройке** | **Команда/ожидаемый результат выполнения** |
| Установить samba для настройки общего ресурса | sudo dnf update  sudo dnf install samba |
| Создать необходимые директории | sudo mkdir -p /FansySrv/Fansy  sudo mkdir -p /FansySrv/Setup |
| Добавить пользователей рабочих мест, которые будут работать с ПК FANSY. Ниже рассмотрен случай, когда пользователь «fansy» - это администратор сервера, а «fansyuser» - пользователь рабочего места, к этому серверу подключающийся. | sudo adduser fansyuser |
| Добавить пользователей «fansy» и «fansyuser» в Samba, задав каждому пароль. | sudo smbpasswd -a fansy  sudo smbpasswd -a fansyuser |
| Создать группу для пользователей с доступом | sudo groupadd fansyusers |
| Добавить пользователей (fansy и fansyuser) в группу | sudo usermod -aG fansyusers fansy  sudo usermod -aG fansyusers fansyuser |
| Установить владельца и права на созданные директории для группы fansyusers | sudo chown -R :fansyusers /FansySrv  sudo chmod -R 770 /FansySrv |
| Ожидаемый вывод команды проверки прав доступа sudo ls -ld /FansySrv /FansySrv/Fansy /FansySrv/Setup | drwxrwx--- root fansyusers |
| Отредактировать файл конфигурации /etc/samba/smb.conf, добавив новую секцию | [FansySrv]  path = /FansySrv  writable = yes  browsable = yes  valid users = @fansyusers |
| Проверить синтаксис | sudo testparm |
| Перезапустить службы Samba | sudo systemctl restart smb.service  sudo systemctl restart nmb.service |
| Для каждого пользователя задать пароль | sudo smbpasswd -a fansy  sudo smbpasswd -a fansyuser |
| Проверить список пользователей | sudo pdbedit –L |
| Проверить статус SELinux командой sestatus | Если Current mode: enforcing  то выполняем настройку ниже |
| Рекурсивно изменяем SELinux контекст для директории /FansySrv | sudo chcon -R -t samba\_share\_t /FansySrv |
| Восстанавливаем контексты системных политик SELinux, чтобы убедится, что «samba\_share\_t» применяется верно | sudo restorecon -R /FansySrv |
| Настраиваем SELinux политики для Samba | sudo setsebool -P samba\_export\_all\_rw on  sudo setsebool -P samba\_enable\_home\_dirs on  sudo setsebool -P samba\_export\_all\_ro on |

## Настройка рабочего пространства на клиенте

### Для настройки автоматизированного обновления клиентской составляющей «ПК Fansy” необходимо настроить доступ к исполнимым файлам, макросам и файлам-шаблонам отчетов «ПК Fansy» с рабочих мест пользователей в среде функционирования ОС «Astra Linux Special Edition» 1.8 x64 выполнить действия приведенные в табл.2.

Таблица 3 - Настройка рабочего пространства на клиенте

|  |  |
| --- | --- |
| **Описание действия по настройке** | **Команда/ожидаемый результат выполнения** |
| Установить Samba | sudo apt update  sudo apt install samba |
| Создать директории для монтирования подпапок | sudo mkdir -p /mnt/fansy  sudo mkdir -p /mnt/fansy.setup |
| Создать файл учётных данных в домашней директории пользователя fansyuser | nano /home/fansyuser/.smbcredentials\_fansyuser |
| Вставить строки, заменив *yourpasswordforfansyuser*  на реальный пароль, заданный на сервере | username=fansyuser  password=yourpasswordforfansyuser |
| Ограничить доступ к файлу | chown fansyuser:fansyuser /home/fansyuser/.smbcredentials\_fansyuser  chmod 600 /home/fansyuser/.smbcredentials\_fansyuser |
| Проверить права | ls -l /home/fansyuser/.smbcredentials\_fansyuser |
| Ожидаемый вывод: | -rw------- 1 fansyuser fansyuser |
| Подготовить файл /etc/fstab для автоматического монтирования - открыть файл /etc/fstab | sudo nano /etc/fstab |
| Добавить следующие строки для автоматического монтирования подпапок | //<IP Сервера>/FansySrv/Fansy /mnt/fansy cifs credentials=/home/fansyuser/.smbcredentials\_fansyuser,vers=3.0,uid=1000,gid=1000 0 0  //<IP Сервера>/FansySrv/Setup /mnt/fansy.setup cifs credentials=/home/fansyuser/.smbcredentials\_fansyuser,vers=3.0,uid=1000,gid=1000 0 0 |
| Заменить uid=1000,gid=1000 на реальные идентификаторы пользователя fansyuser,  узнать реальные uid и gid можно следующими командами: | id -u fansyuser # Узнать UID  id -g fansyuser # Узнать GID |
| Обновить конфигурацию systemd | sudo systemctl daemon-reload |
| Протестировать монтирование | sudo mount -a  ls /mnt/fansy  ls /mnt/fansy.setup |

### Для настройки автоматизированного обновления клиентской составляющей «ПК Fansy” необходимо настроить доступ к исполнимым файлам, макросам и файлам-шаблонам отчетов «ПК Fansy» с рабочих мест пользователей в среде функционирования ОС «РЭД ОС 7.3» Mate x64 выполнить действия приведенные в табл.4.

|  |  |
| --- | --- |
| **Описание действия по настройке** | **Команда/ожидаемый результат выполнения** |
| Установить клиентскую часть СУБД | sudo dnf –y install libfbclient2 |
| Установить Samba | sudo dnf update  sudo dnf install samba |
| Создать директории для монтирования подпапок | sudo mkdir -p /mnt/fansy  sudo mkdir -p /mnt/fansy.setup |
| Создать скрипт учётных данных в домашней директории пользователя (в данном примере для пользователя fansyuser ) | nano /home/fansyuser/.smbcredentials\_fansyuser |
| Вставить строки, заменив *yourpasswordforfansyuser* на реальный пароль, заданный на сервере | username=fansyuser  password=yourpasswordforfansyuser |
| Ограничить доступ к файлу | chown fansyuser:fansyuser /home/fansyuser/.smbcredentials\_fansyuser  chmod 600 /home/fansyuser/.smbcredentials\_fansyuser |
| Проверить права | ls -l /home/fansyuser/.smbcredentials\_fansyuser |
| Ожидаемый вывод: | -rw------- 1 fansyuser fansyuser |
| Подготовить скрипт /usr/local/bin/mount\_cifs.sh для автоматического монтирования - создаем файл mount\_cifs.sh | sudo nano /usr/local/bin/mount\_cifs.sh |
| Вставить в него следующие строки | #!/bin/bash  until ping -c1 192.168.1.137 &>/dev/null; do  sleep 1  done  mount -t cifs //192.168.1.137/FansySrv/Fansy /mnt/fansy -o rw,auto,credentials=/home/fansyuser/.smbcredentials\_fansyuser,file\_mode=0644,dir\_mode=0755  mount -t cifs //192.168.1.137/FansySrv/Setup /mnt/fansy.setup -o rw,exec,auto,credentials=/home/fansyuser/.smbcredentials\_fansyuser |
| Сделать скрипт исполняемым | sudo chmod +x /usr/local/bin/mount\_cifs.sh |
| Создать systemd-сервис. Создать файл mount-cifs.service | sudo nano /etc/systemd/system/mount-cifs.service |
| Вставить содержимое | [Unit]  Description=Mount CIFS shares after network is online  After=network-online.target  [Service]  Type=oneshot  ExecStart=/usr/local/bin/mount\_cifs.sh  RemainAfterExit=yes  User=root  [Install]  WantedBy=multi-user.target |
| Перезапустить сервис, включить его и проверить статус | sudo systemctl daemon-reload  sudo systemctl enable mount-cifs.service  sudo systemctl start mount-cifs.service  sudo systemctl status mount-cifs.service |
| Проверить монтирование | mount | grep cifs  ls /mnt/fansy  ls /mnt/fansy.setup |

После данных настроек, необходимо на сервере, разместить содержимое папки Fansy.Setup, входящую в состав дистрибутива, следующим образом:

* Содержимое подпапки /Fansy.Setup/Fansy поместить в папку /FansySrv/Fansy на сервере
* Содержимое подпапки /Fansy.Setup/Setup поместить в папку /FansySrv/Setup на сервере
* После размещения содержимого повторить присвоение прав на содержимое командами на сервере :
  sudo chown -R :fansyusers /FansySrv

sudo chmod -R 770 /FansySrv

После настройки взаимодействия по протоколу smb на каждом клиенте открыть папку /mnt/fansy.setup и запустить файл START.fansy командой sudo ./START.fansy, отметить галочками устанавливаемое приложение и пользователей, для которых устанавливается приложение, затем нажать кнопку «Выполнить» (рис. 2).

[Рисунок удалён: ID\_3]

Рисунок 2 – Окно установки ПК FANSY

После завершения ПК FANSY установки проверить на рабочем столе пользователя наличие ярлыков приложений ПК FANSY. Запустить по ярлыку требуемое приложение и настроить корректные ссылки (алиасы): открыть ярлык установленного приложения и нажать на выделенную кнопку (рис.3)

[Рисунок удалён: ID\_4]

Рисунок 3 – Вызов настройки соединения

В появившемся окне настройки нажать на кнопку «Добавить новое соединение» (рис.4).

[Рисунок удалён: ID\_5]

Рисунок 4 – Добавление нового соединения

Указать следующие параметры:

* **для СУБД «Ред База Данных»:**
* наименование соединения: bal\_meta и bal\_data (последовательно cоздать оба соединения);
* тип СУБД – Firebird;
* сервер – IP адрес или имя сервера ПК FANSY;
* база данных – абсолютный путь до файла базы данных meta или data на указанном выше сервере.

Нажать на кнопку «Ок» для сохранения настроек.

Проверить соединение введя логин и пароль по умолчанию (если они не были изменены при первоначальной настройке СУБД), нажать на кнопку «Тест соединения» (рис.5).

[Рисунок удалён: ID\_6]

Рисунок 5 – Тестирование соединения

* **для СУБД PostgreSQL:**
* наименование соединения: bal\_meta и bal\_data (последовательно cоздать оба соединения);
* тип СУБД – PostgreSQL;
* сервер – строго IP адрес без знаков «\» (На рисунке №6 указан локальный IP в качестве примера, так как рабочее место является и клиентом и сервером одновременно);
* база данных – наименование базы данных на указанном выше сервере. В случае, если новая база не создавалась а использовалась системная, то указывается «postgres»;
* cхема – bal\_meta или bal\_data, в зависимости от того какой алиас настраивается на текущий момент (рис.6).

[Рисунок удалён: ID\_7]

Рисунок 6 – Переключение между настройками соединений

Нажать на кнопку «Ок» для сохранения настроек.

# Настройка аппаратного ключа Guardant

Аппаратный ключ Guardant необходим как для контроля целостности программы, так и для контроля транзакций и рабочих мест.

Приложение ПК «FANSY» проверяет ключ сразу при старте, поэтому, при не подключенном ключе, на клиенте, после авторизации, вы увидите следующее сообщение при запуске приложения.

[Рисунок удалён: ID\_8]

Рисунок 7 – Ошибка при не подключенном аппаратном ключе

Для настройки необходимо

На сервере необходимо установить программное обеспечение Guardant Control Center с официального ресурса производителя ключей <https://www.guardant.ru/support/users/control-center/> .

В случае, если используете РЭД ОС 7.3 необходимо установить Guardant Control Center 4.4 для Linux RPM (x64).

Если используется Astra Linux 1.8 - Guardant Control Center 4.4 для Linux DEB (x64)

После установки загруженного пакета необходимо перейти по адресу <http://localhost:3189/>

[Рисунок удалён: ID\_9]

Вы должны увидеть ваш ключ на отобразившейся странице.

На компьютере клиента запускаем приложение и проверяем видимость лицензий через меню «Справка» подменю «Информация о защите».

[Рисунок удалён: ID\_10]

[Рисунок удалён: ID\_11]

Рисунок 8 – Проверка подключенного аппаратного ключа

Информация о защите (Транзакции и Профиль) должны совпадать с условиями договора, заключенного при покупке ПК «FANSY»

# Настройка безопасности ПК FANSY

Для безопасной эксплуатации согласно ТУ (62.01.29-000-52775472-2024 раздел 2.5) необходимо настроить идентификацию и аутентификацию конечных пользователя(ей) для чего необходимо выполнить ряд следующих действий:

* Присвоить пользователю(ям) уникальный идентификатор (логин) и прописать его в СУБД и в справочнике операционистов самого приложения (ИАФ.3)
* В справочнике операционистов настроить учетную запись пользователя(ей) согласно штатному расписанию и разграничению прав доступа (УПД.2)
* Настроить блокировку пользователя(ей) спустя заранее оговоренное время неактивности (УПД.1 усиление 1)
* Настроить фиксацию мониторинга транзакций пользователя(ей) (РСБ.2)
* Настроить уведомления о внесении изменений в учетные записи пользователя(ей) (РСБ.1)

## Создание учетной записи пользователя в СУБД

Перед созданием учётной записи нового пользователя в системе администратор обязан определить его роль и соответствующий уровень прав доступа.

Логин пользователя должен начинаться с одного из следующих префиксов:

* ADMIN\_ — для учётных записей с административными правами;
* USER\_ — для учётных записей с правами обычного пользователя;
* GUEST\_ — для учётных записей с ограниченными (гостевыми) правами.

Выбор префикса осуществляется исходя из должностных обязанностей и планируемых действий пользователя в системе. Неправильное назначение префикса может привести к нарушению принципа минимально необходимых прав и создать угрозу информационной безопасности. Подробнее про права и ограничения префиксов описано в Приложении А к Руководству администратора (RU 62.01.29-000-52775472-01 92)

Здесь и далее предполагается, что мы заводим в систему одного пользователя с логином USER\_IVANOV

1. Создание учетной записи пользователя в СУБД PоstgreSQL

Так как, согласно пункту 2.1.2.6 группа «fansy\_users» у нас уже заведена, нам необходимо подключить нового пользователя к этой группе командой:

*psql -U postgres -d postgres -c "CREATE ROLE \"USER\_IVANOV\" LOGIN PASSWORD '<Пароль для нового пользователя>' IN ROLE fansy\_users; COMMENT ON ROLE \"USER\_IVANOV\" IS 'ПОЛЬЗОВАТЕЛЬ FANSY'; GRANT CONNECT ON DATABASE postgres TO \"USER\_IVANOV\";"*

1. Создание учетной записи пользователя в СУБД РЭД База данных 5

Для создания нового пользователя, необходимо будет подключится к специальной базе данных security.fdb. В РЭД База данных 5 она называется security5.fdb.

Для подключения используется команда:

*sudo /opt/RedDatabase/bin/isql /opt/RedDatabase/security5.fdb*

После появления строки приглашения «SQL>» авторизуемся под правами суперадминистратора SYSDBA, пароль для которого задавался в момент установки РЭД Базы данных

CONNECT '/opt/RedDatabase/security5.fdb’ USER ‘SYSDBA’ PASSWORD ‘<Пароль>’;

Создаем нового пользователя после успешного подключения:

CREATE USER USER\_IVANOV PASSWORD ‘<Пароль нового пользователя>';

COMMIT;

EXIT;

Пользователь успешно добавлен в СУБД.

Примечание

Возможна ошибка «Statement failed, SQLSTATE = 28000 no permission for remote access to database /opt/RedDatabase/security5.fdb USE CONNECT or CREATE DATABASE to specify a database»

В данном случае необходимо открыть файл /opt/RedDatabase/databases.conf, поменяв значение параметра RemoteAccess с false на true:

security5.fdb

{

RemoteAccess = true

}

## Создание учетной записи пользователя в справочнике операционистов.

При первоначальном создании новых пользователей в справочнике операционистов необходимо авторизоваться в ПК «FANSY» под суперадминистратором SYSDBA.

Через меню «Форма», подменю «Открыть» откройте перечень форм и выберите «Справочник операционистов»

[Рисунок удалён: ID\_12]

[Рисунок удалён: ID\_13]

Рисунок 9 – Расположение справочника операционистов в интерфейсе

Через кнопку «Добавить новую запись» или через F7 на клавиатуре добавляем новую запись. При этом обязательные поля будут заполнены шаблонными записями синего цвета, что отмечает то, что запись еще не сохранена. [Рисунок удалён: ID\_14]

[Рисунок удалён: ID\_15]

Рисунок 10 – Вид справочника операционистов при добавлении новой записи

Заполните поля «Идентификатор операциониста» (должно совпадать с ранее заведенным в СУБД логином), «Ф.И.О», «Должность», «Юридическое лицо компании» (ваша компания).

После этого сохраните запись при помощи кнопки на верхней панели или клавиши F2 на клавиатуре. [Рисунок удалён: ID\_16]

[Рисунок удалён: ID\_17]

Рисунок 11 – Вид справочника операционистов после сохранения новой записи

Операционист успешно заведен в справочник.

## Настройка учетной записи пользователя в справочнике операционистов.

Настройка учетной записи состоит из четырех компонент:

* Установка количества дней автоматической блокировки при неактивности учетной записи
* Назначение рабочих мест
* Фиксация перечня информации подлежащей мониторингу
* Настройка фиксации событий безопасности (изменения параметров учетных записей пользователя)

1. Настройка автоматической блокировки учетной записи по неактивности

Для реализации данного требования Администратору безопасности необходимо для каждой учетной записи операциониста в справочнике операционистов, на закладке «Сведения» установить Максимальное количество дней неактивности в одноименном поле.

[Рисунок удалён: ID\_18]

Рисунок 12 – Расположение поля «Макс. Кол. дней неактивности»

1. Настройка рабочих мест (прав доступа) операциониста

Рабочее место представляет собой набор прав доступа (атрибутов), определяющих разрешенные действия операциониста с документами, относящимися к определенной функциональной группе (например, «Договоры», «Счета», «Платежные поручения» и.т.д.) Точный перечень и состав рабочих мест определен в приложении «Б» к Руководству администратора (RU 62.01.29-000-52775472-01 92).

Для добавления рабочего места учетной записи пользователя необходимо перейти на закладку «Рабочие места» справочника операционистов, после чего выбрать необходимое рабочее место в пустом поле снизу.

[Рисунок удалён: ID\_19]

Рисунок 13 – Добавление рабочего места

После этого сохранить выбранное через кнопку или F2 на клавиатуре[Рисунок удалён: ID\_20]

[Рисунок удалён: ID\_21]

Рисунок 14 – Добавление дополнительного рабочего места

При необходимости в добавлении еще одного рабочего места нажмите кнопку или F7 на клавиатуре, поле внизу очистится, что означает готовность к вводу следующего рабочего места, после чего повторите выбор и сохранения для дополнительного рабочего места. [Рисунок удалён: ID\_22]

1. Настройка мониторинга транзакций операциониста

Действия в системе ПК «FANSY» фиксируются в базе данных при условии, что в настройках операциониста прописаны те тразакции, которые необходимо фиксировать. В случае, если перечень не задан, то в базу данных записывается только вход и выход пользователя из системы.

Перечень настраивается в справочнике операционистов, на закладке «Сведения» в поле «Мониторинг транзакций»

[Рисунок удалён: ID\_23]

Рисунок 15 – Местоположение поля «Мониторинг транзакций»

Подробнее про мониторинг транзакций описано в Руководстве администратора (RU 62.01.29-000-52775472-01 92) в разделе 11.

1. Настройка фиксаций событий безопасности

Для обеспечения контроля целостности настроек безопасности Администратору безопасности необходимо настроить подписку на оповещения для соответствующих учетных записей (как правило, для учетных записей руководства и самих администраторов).

Порядок настройки подписки на события:

* Выбрать учетную запись, для которой необходимо настроить получение уведомлений.
* На закладке «Сведения» в обязательном порядке заполнить поле «Email для событий оповещения» корректным электронным адресом. А в поле «Параметры SMTP-сервера» указать параметры вашего почтового сервера

[Рисунок удалён: ID\_24]

Рисунок 16 – Местоположение полей для настройки уведомлений

* Перейти на закладку «События оповещения».
* В поле «Событие» выбрать событие «Изменение ограничений пользователя в справочнике операционистов» и сохранить при помощи кнопки или клавиши F2 на клавиатуре. После чего нажать кнопку и выбрать событие «Изменение событий оповещения пользователя в справочнике операционистов». Повторить сохранение и аналогично выбрать и сохранить событие «Изменение рабочих мест (роли) пользователя в справочнике операционистов». [Рисунок удалён: ID\_25][Рисунок удалён: ID\_26]

[Рисунок удалён: ID\_27]

Рисунок 17 – Вид настроенных событий оповещения