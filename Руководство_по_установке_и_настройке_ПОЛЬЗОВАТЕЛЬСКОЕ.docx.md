Универсальная система

внутреннего учета

(брокера, дилера, ДУ,

УК, ПИФ, НПФ, ПФР, СД)

FANSY-SPECTRE

Руководство по инсталляции

и администрированию

[Рисунок удалён: ID\_1]

[Рисунок удалён: ID\_2]

***Содержание***.

1. Состав программного комплекса 4

2. Требования к программно-аппаратному окружению 4

2.1 Требования к аппаратному обеспечению 4

2.2 Требования к программному обеспечению 5

2.3 Параметры рабочей станции 5

2.4 Выбор СУБД 6

3. Процедура инсталляции 8

3.1 +Последовательность инсталляции 8

3.1.1 Инсталляция сервера 8

3.1.2 Инсталляция рабочей станции 8

3.1.3 Инсталляция файлов помощи (hlp,chm) 8

3.1.3.1 Проблема размещения справок на сетевом диске 8

3.1.3.2 Проблема вызова справок в формате HLP 8

3.1.3.3 Проблема со шрифтами в формате HLP 9

3.1.3.4 Проблема со шрифтами в формате CHM 9

3.2 Инсталляция СУБД 9

3.2.1 FIREBIRD 9

3.2.2 MSSQL 10

3.2.3 ORACLE 10

3.2.4 PostgreSQL 12

3.3 Инсталляция шлюза доступа к СУБД 14

3.3.1 Шлюз DBX (dbExpress) 14

3.3.2 Установка и настройка шлюза DBX 14

3.3.2.1 Особенности настройки доступа к СУБД FireBird 15

3.3.2.2 Особенности настройки доступа к СУБД MS SQL 16

3.3.2.3 Особенности настройки доступа к СУБД Oracle 16

3.3.2.4 Особенности настройки доступа к СУБД PostgreSQL 17

3.3.2.5 Особенности настройки доступа к ODBC 17

3.3.3 Файлы, используемые в DBX 17

3.3.4 Добавление новых DBX-драйверов 18

3.3.5 Настройка DBX-соединений из Fansy-приложения 18

3.3.6 Доступ к данным посредством ODBC-соединений 19

3.4 Аппаратный ключ защиты HASP 20

3.4.1 Инсталляция ключа HASP 20

3.4.2 Сообщения о лицензионных ограничениях 21

3.4.3 Использование резервного HASP-ключа 21

3.4.4 Ошибки, вырабатываемые аппаратной защитой 22

3.5 Распаковка баз данных (restore) 23

3.5.1 Распаковка баз данных в FIREBIRD 23

3.5.1.1 Распаковка утилитой IB Expert (оконный интерфейс) 23

3.5.1.2 Распаковка утилитой GBAK (из командной строки) 24

3.5.2 Распаковка баз данных в MSSQL 25

3.5.3 Распаковка баз данных в ORACLE 26

3.5.4 Распаковка баз данных в PostgreSQL 26

3.6 Создание пользователей 26

3.6.1 Создание пользователей в FIREBIRD 27

3.6.1.1 Использование командной строки. 27

3.6.1.2 Использование утилиты IBExpert. 27

3.6.2 Создание пользователей в MSSQL 28

3.6.3 Создание пользователей в ORACLE 30

3.6.4 Создание пользователей в PostgreSQL 31

3.7 Резервное копирование баз данных (backup) 31

3.7.1 Резервное копирование баз данных в Firebird 31

3.7.2 Резервное копирование баз данных в MS SQL 32

3.7.3 Резервное копирование баз данных в ORACLE 33

3.7.4 Резервное копирование баз данных в PostgreSQL 33

3.8 Запуск приложения на многоядерном компьютере 33

4. Настройка программы 35

4.1 Диалог при запуске и параметры приложения 35

4.2 Настройка операционистов 38

4.2.1 Уровни защиты данных 38

4.2.2 Заведение нового пользователя 39

4.2.3 Права для работы с документами и формами 40

4.2.3.1 Рабочие места пользователя (роли) 40

4.2.3.2 Параметры учетной записи пользователя 40

4.2.3.3 События оповещения 41

4.2.3.4 Профили ограничений 41

4.2.3.5 Сертификат пользователя для ЭЦП 41

4.2.3.6 Математическое преобразование пароля пользователя 42

4.2.3.7 Защита доступа к персональным данным 42

4.2.3.8 Мониторинг транзакций пользователя 43

4.2.3.9 Права пользователя на документы 43

4.2.3.10 Права пользователя на приложение 45

4.2.3.11 Права группы ‘ADMIN’ 46

4.2.3.12 Права группы ‘USER’ 46

4.2.3.13 Права группы ‘GUEST’ 47

4.3 Системные параметры 50

4.4 Системные установки 51

4.5 Настройка базы данных 53

4.5.1 Введение новых учетных плоскостей 53

4.5.2 Удаление учетных плоскостей 54

4.5.3 Изменение национальной валюты 54

4.5.4 Удаление документов, котировок и проводок 55

4.6 Чистка базы данных 56

4.7 Репликация объектов при совместной работе приложений 58

4.7.1 Репликация справочников 59

4.7.2 Репликация счетов ДЕПО 59

4.7.3 Репликация проводок и консолидация балансов 59

4.7.4 Репликация документов 60

4.8 Добавление нового конвертора данных 60

4.8.1 Добавление новой операции 61

4.8.2 Код программы конвертирования данных 62

4.8.3 Корректировка информации о субброкере 64

4.8.4 Добавление нового места хранения 64

4.8.5 Задание кодов ценных бумаг 64

4.8.6 Заполнение классификатора 64

4.8.7 Особенности 65

4.9 Настройка справочника отчётов 65

4.10 Настройка параметров приложения 67

4.11 Настройка компонентов форм 69

5. Использование криптографии 70

6. Диагностика ошибок в ПО 78

6.1 Диагностика последней ошибки 78

6.2 Обезличивание базы данных 79

7. Установка обновлений 80

7.1 Получение архивов для проведения изменений в системе 80

7.2 Содержание архивов с обновлениями 80

7.3 Установка обновления Серверной части приложения 81

7.3.1 Обновление серверной части в FIREBIRD 81

7.3.2 Обновление серверной части в Microsoft SQL Server 82

7.3.3 Обновление серверной части в ORACLE 83

7.3.4 Обновление серверной части в PostreSQL 84

7.4 Установка обновления Клиентской части приложения 85

8. Типовые ошибки при инсталляции системы 86

9. HELPDESK - cлужба поддержки клиента 88

9.1 Что такое Helpdesk 88

9.2 Как работает Helpdesk 88

9.3 Список заявок 89

9.4 Просмотр заявки 90

9.5 Создание новой заявки 92

9.6 Предложения и замечания 93

10. Приложение 1. Совокупные права рабочих мест на документы и операции 93

# Состав программного комплекса

Программный комплекс FANSY-SPECTRE включает в себя:

1. Исполнимый модуль SPECTRE.EXE – АРМ для работы с электронными документами.
2. Исполнимый модуль ADMIN.EXE и BALTUN.EXE – АРМ «FANSY-TOOLKIT» для настройки бухгалтерского ядра и ядра документооборота (поставляется опционально).
3. ZZZ\_SP\_DATA.FBK (ZZZ\_SP\_DATA.BAK) – дамп хранилища целевых данных.
4. ZZZ\_SP \_META.FBK (ZZZ\_SP\_META.BAK) – дамп хранилища программных настроек.
5. ib\_Fansy.dll (ib\_Fansy\_3.dll) – функции серверной части программного комплекса.
6. SPECTRE.HLP – справочная система по электронному документообороту бэк-офиса.
7. FANSY.HLP – справочная система по пользовательскому интерфейсу приложений.
8. Аппаратный ключ HASP и математическое обеспечение к нему.
9. Библиотека шаблонов MS Excel и MS Word для встроенных отчетов.
10. Документ “SPECTRE.doc”. Универсальная система внутреннего учета FANSY-SPECTRE. *Руководство по технологии документооборота и делопроизводства*.
11. Документ “INSTALL.doc”. Универсальная система внутреннего учета FANSY-SPECTRE. *Руководство по инсталляции и администрированию* (настоящий документ).
12. Документ “FANSY.doc”. Технология разработки информационных систем FANSY. *Руководство по интерфейсу рабочего стола, формам и справочникам приложений.*
13. Документ “PROGRAM.doc”. Технология разработки информационных систем FANSY. *Руководство программиста*.
14. Документ “ADMIN.doc”. Технология разработки информационных систем FANSY. Утилита ADMIN. *Руководство по эксплуатации и сопровождению приложений.*. (поставляется опционально)
15. Документ “BALTUN.doc”. Технология разработки информационных систем FANSY. Утилита BALTUN. *Руководство по настройке бухгалтерского ядра и ядра документооборота* (поставляется опционально).
16. Документ “EDO.doc”. Технология разработки информационных систем FANSY. *Принципы функционирования и настройки электронного документооборота (ЭДО)*. (поставляется опционально)

# Требования к программно-аппаратному окружению

## Требования к аппаратному обеспечению

В архитектуре клиент-сервер с проектной нагрузкой до 50 пользователей и обработкой до 100000 транзакций в день следует перечислить требования к аппаратному обеспечению сервера.

Сервер и рабочие станции должны находиться в одной локальной сети с подключением не менее 100Мб/сек и со временем отклика сервера (ping) не более 1 мс. В среднем случае можно остановился на двухпроцессорной платформе Intel, и не гнался за брендовыми моделями. Выбор конфигурации (один или два процессора) зависит от стоимости лицензирования СУБД (лицензируется на процессор или пользователя). До 50 пользователей выгоднее лицензировать на пользователей.

Подойдет процессор следующего типа: CPU Intel Xeon с частотой не меньше 3.0 GHz и с необходимым количествоя процессорных ядер.

Для Firebird и частично MS SQL, при меньшем количестве пользователей следует выбирать процессор с максимально большим кэшем, максимальной частотой процессора и памяти и не гнаться за количеством ядер. Для экономии средств, при покупке сервера достаточно на каждое ядро процессора планировать 5-10 пользователей. Запросы SQL выполняются только на одном ядре и частота процессора со скоростью обмена с памятью обеспечивают максимальное быстродействие. Большее количество ядер позволяет обслужить большее количество одновременно работающих пользователей**.**

Что касается памяти, то ее чем больше, тем лучше (учитываем, что сейчас она не очень дорогая).

Узкое место любого сервера – жесткие диски. Для бюджетной конфигурации рекомендуется брать диски типа SATA SSD, небольшим объемом для системы, и отдельно диски для базы и журналов SQL сервера зеркалом в рейд. Рейд контроллер следует брать с батарейкой для write/back кэша и позаботиться о постоянном резервном копировании.

Желательно операционную систему, базу данных, журналы и временные файлы разнести на разные диски, подключенные к отдельным каналам контроллера. Диски с критически важными данными надо обязательно зеркалировать и регулярно копировать.

Идеально брать диски типа SSD NVME. На дисках по заполнению надо иметь двукратный запас свободного места, ну и парочку запасных дисков для моментальной замены.

По цене (на начало 2022 г.) стоимость такого сервера получиться в интервале 800000- 1500000 руб, но это без лицензий на серверное ПО и СУБД.

## Требования к программному обеспечению

Программный комплекс реализован в классической архитектуре клиент-сервер.

Для работы клиентской части комплекса требуется IBM PC, со следующим программным обеспечением:

1. Операционная система: Windows 2000, 2003, XP, Vista, Windows-7,8,10
2. Драйвер доступа к данным: шлюз DBX (набор dll - файлов)
3. Драйвер HASP - ключа
4. Драйвер принтера
5. MS-Office 2003 или выше

Для Linux рабочей станции клиент только х64:

1. Операционная система: Linux-x64 сертифицированная ФСТЭК с графической средой Gnome, Mate, KDE, Xfce. Рекомендуем РэдОс, Alt Linix.
2. Linux х64 клиент доступа к базе данных из репозитория дистрибутива.
3. Пакет OpenSSL3 из репозитория дистрибутива.
4. Драйвер принтера

Серверная часть комплекса может функционировать на различной аппаратной архитектуре, но должна содержать следующее программное обеспечение:

1. Одна из СУБД: Firebird 2.5.4 и выше, Oracle10g-11g или MS SQL 2008R2 и выше, PostgreSQL 9.6 и выше.
2. Для Oracle, PostgreSQL и Firebird рекомендуется Linux с грамотным системным и DBA администраторами.

**Программное обеспечение требует, чтобы на рабочей станции не было установлено никаких взломщиков для ключей защиты, которые иногда идут в комплекте с пиратским программным обеспечением.**

## Параметры рабочей станции

Требуется свободное место на системном диске не менее 0.5Г для временных файлов.

**Для версии клиента на Windows:**

Программа требует следующих системных форматов на вашем компьютере (в «панели управления»):

1. раздел «язык и стандарты» - в качестве разделителя целой и дробной части чисел должен быть задан символ «точка»;
2. в том же разделе формат даты должен быть ‘ДД.ММ.ГГГГ’ или ‘ДД.ММ.ГГ’.

Посмотрите в реестр, в раздел подстановки шрифтов. Если в программе появляется нечитаемый текст, значит, Ваша операционная система путается в кодовых страницах. Чтобы это преодолеть, системе нужно подсказать кодовую страницу. См. раздел реестра \HKEY\_LOCAL\_MACHINE\ SOFTWARE\ Microsoft\ Windows NT\ CurrentVersion\ FontSubstitutes. Добавьте туда следующие строки:

1. Arial,0 "Arial,204"
2. Courier New,0 "Courier New,204"
3. Times New Roman,0 "Times New Roman,204"

Если при старте приложения появится сообщение об ошибке "SQL Error 802. Transliteration error", то тоже самое надо проделать на сервере

Следите за настройками экранных шрифтов в Windows. Приложение спроектировано под мелкие шрифты (Small Fonts), в противном случае часть полей попадет в недоступную область за границами формы.

**Для версии клиента на Linux:**

1. программа сама в качестве разделителя целой и дробной части чисел использует символ «точка»;
2. программа использует формат даты ‘ДД.ММ.ГГГГ’ или ‘ДД.ММ.ГГ’.

## Выбор СУБД

Fansy-приложения могут работать с одной из следующих СУБД (на выбор): FIREBIRD, PostgreSQL, MSSQL, ORACLE, среди которых, первая наименее известна и поэтому требует дополнительного описания. Все перечисленные СУБД соответствуют требованиям, предъявляемых к безопасному хранению и обработке данных.

СУБД FIREBIRD является высокопроизводительной кросс-платформенной реляционной базой данных, сочетающей простую инсталляцию, чрезвычайно низке системные требования и минимальную потребность в сопровождении, что очень важно для надежного функционирования распределенных высокопроизводительных критически важных бизнес-приложений. Среди возможностей базы данных FIREBIRD - обработчики оповещений о событиях, хранимые процедуры, триггеры, определяемые пользователем функции (UDF) и фильтры для работы с объектами BLOB.

СУБД FIREBIRD и PostgreSQL напоминают ORACLE в миниатюре. Основной их особенностью (в отличие от MSSQL), считается версионная архитектура, которая обеспечивает уникальные возможности при многопользовательской работе - пишущие пользователи никогда не блокируют читающих. Также в FIREBIRD и PostgreSQL реализован механизм оптимистической блокировки на уровне записи, т.е. сервер блокирует только те записи, которые реально были изменены пользователем, а не блокирует всю страницу данных целиком (в отличие от MSSQL). Эта особенность еще больше снижает вероятность конфликтов при многопользовательской работе. В отличие от PostgreSQL, FIREBIRD требует лишь незначительного администрирования, прост в инсталляции и разработан с целью уменьшения затрат на сопровождение, что направлено на ускорение процесса разработки приложений и гарантирует быстрый возврат инвестиций для компаний, нуждающихся в сложных распределенных приложениях.

При выборе СУБД следует в первую очередь определиться с двумя основными критериями, влияющими на эффективность их использования в качестве эффективного хранилища данных: количество одновременно работающих пользователей и объем ежедневно вносимой в базу данных информации. В терминах СУБД эти критерии относятся соответственно к механизму реализации так называемых «блокировок» и механизму «секционирования» данных для уровня изоляции транзакций «read-commited», используемому Fansy-приложениями по умолчанию.

Механизм «блокировок» обеспечивает гарантию целостности считывания и изменения данных каждым пользователем при многопользовательском режиме доступа. Важным фактором при выборе платформы следует считать тот аспект, блокирует ли СУБД данные таблиц при вставке записей одними пользователями, для тех пользователей, которые используют эти таблицы для чтения. В типовой ситуации одни пользователи проводят операции текущего дня, в то время как другие хотят получить отчеты за прошедший период, при этом используются данные одних и тех же таблиц.

При выборе СУБД для многопользовательского использования предпочтение следует отдавать СУБД, которые не блокируют соседние записи при вставке и изменении данных.

|  |  |  |
| --- | --- | --- |
| Критерий | FIREBIRD/ PostgreSQL/ ORACLE | MSSQL |
| Наличие блокировок чтения соседних строк при вставке и изменении данных? | Нет блокировок, дополнительные ресурсы не требуются | Блокировки есть. Эскалация блокировок может привести к блокированию таблицы в целом. Количество блокировок уменьшается при включении специального уровня изоляции «Моментальных снимков» (Snapshot), требующего дополнительных ресурсов. |

Механизм «секционирования» данных (partitioning) позволяет разделять большие (критичные по объему) базы данных, таблицы и индексы на множество мелких управляемых частей, каждая из который может быть доступна более эффективным способом, чем весь массив данных в целом. Например, разнесение данных и индексов на два параллельных диска позволят ускорить доступ к данным, т.к. чтение индексов не скажется на производительности чтения данных. Секционирование большой таблицы, индексируемой по дате, на несколько таблиц по интервалу дат, позволит получить более быстрый доступ к данным текущего отчетного периода, при этом доступ к данным предыдущих отчетных периодов замедлится только в случае получения консолидированных данных по периодам, относящихся к разным секциям хранения.

Для обращения к данным СУБД используют индексы, которые, как известно, уменьшают время обращения к данным к логарифмической функции от их объема. Таким образом, большие объемы данных появляются в том случае, если функция «логарифм от объема данных» становится большим числом. При выборе СУБД для хранения больших объемов данных предпочтение следует отдавать СУБД, которые имеют гибкий механизм секционирования.

|  |  |  |  |  |
| --- | --- | --- | --- | --- |
| Критерий | FIREBIRD | PostgreSQL | MSSQL | ORACLE |
| Возможность шифрования хранимых данных и сетевых соединений. | В оригинале – нет, есть решения третьих фирм (например **СУБД Ред База** имеет даже сертификат ФСТЭК**).** | При установки плагина шифрования | Есть | Есть |
| Наличие арифметики больших чисел (более 14 знаков) с фиксированной точкой. | Нет | Есть | Есть | Есть |
| Разделения данных пользователя и системных данных. | Нет разделения | Есть разделение | Есть разделение | Есть разделение |
| Разделения данных пользователя и индексов пользователя? | Нет разделения | Есть разделение | Есть разделение | Есть разделение |
| Наличие секционирования больших таблиц. | Нет секционирования | Есть секционирование (наследование) | Есть секционирование только при создании таблицы (секционированные таблицы ограничены по структуре индексов) | Есть секционирование, как при создании, так и при модификации любых таблиц (нет ограничений на структуру индексов) |

Еще одним критерием являются требования к аппаратному обеспечению и квалификации персонала для обеспечения безопасности и эффективности функционирования СУБД.

|  |  |  |  |  |
| --- | --- | --- | --- | --- |
| Критерий | FIREBIRD | PostgreSQL | MSSQL | ORACLE |
| Требования к аппаратному обеспечению | Нет особых требований, база занимает один файл на диске | Нет особых требований, замечательно масштабируется эффективно использует современное аппаратное обеспечение | Желательно наличие нескольких параллельных дисков для разделения пользовательских областей данных, системных областей данных и журнала транзакций | Требуется наличие нескольких параллельных дисков (не менее 3-х) для функционирования СУБД и желательно наличие дополнительных параллельных дисков для секционирования данных пользователя |
| Требования к программному обеспечению | Кроссплатформенная СУБД | Кроссплатформенная СУБД, рекомендуется Linux\Unix | Windows Server | Кроссплатформенная СУБД, рекомендуется Linux\Unix |
| Требования к квалификации персонала? | Нет особых требований. Достаточно знаний о процедуре дампа баз данных и восстановления баз данных из дампа, для обеспечения их сохранности. | Требуется квалификация в настройке ОС, и глубокие знания администрировании СУБД | Требуются знания о процедуре дампа баз данных, для обеспечения их сохранности.  Требуются знания о командах DDL на секционирование данных и перестройке индексов. | Требуются квалификация в настройке процесса обеспечения отката транзакций и в мапировании табличных пространств на различные дисковые пространства.  Требуются знания о командах DDL на секционирование данных. |

Из сказанного выше легко определить, что FIREBIRD следует выбирать только при работе с небольшими объемами данных, MSSQL - при работе небольшого количества пользователей, PostgreSQL и ORACLE только при наличии сертифицированного персонала и качественного оборудования.

Из сказанного выше также следует, что при работе небольшого коллектива с небольшими объемами данных и отсутствии сертифицированного персонала (приходящий «админ»), следует выбирать между FIREBIRD и MSSQL.

Fansy-приложения могут работать с любой из выбранных вами платформ, при этом гарантируется возможность масштабирования от более простой к более сложной SQL-платформе и обратно.

# Процедура инсталляции

## +Последовательность инсталляции

### Инсталляция сервера

* инсталлировать СУБД;
* переписать на сервер директорию с файлами приложения и дать пользователям права на чтение из этой директории и права на запись в поддиректории REPORT и EXPORT;
* распаковать базу данных и базу метаданных;
* создать пользователей в СУБД;
* установить ключ HASP (если ключ рассчитан на несколько лицензий) в USB порт и инсталлировать драйвер ключа HASPUserSetup;
* настроить резервное копирование (backup) базы данных.

### Инсталляция рабочей станции

* инсталлировать клиентскую часть СУБД;
* запустить DBXAdmin.exe и создать в нём соединения с базой данных
* создать ярлык для запуска exe-файла приложения;
* установить ключ HASP (если ключ рассчитан на одну лицензию) в USB порт и инсталлировать драйвер ключа HASPUserSetup;
* запустить приложение и настроить пользователей в «Справочнике операционистов»;
* в MS Excel снять блокировку макросов.

### Инсталляция файлов помощи (hlp,chm)

Файлы со справками поставляются в двух форматах: hlp (признан устаревших) и chm (современный формат). Обычно справочные файлы размещаются на сетевом диске, при этом возникают 3 известные проблемы.

#### Проблема размещения справок на сетевом диске

Компания Microsoft выпустила обновление системы безопасности Windows, которое блокирует запуск chm-файлов с сетевого пути или с сетевого диска. Для того, что бы локализовать данную ситуацию и снять запрет с запуска chm-файлов по сети, необходимо запустить прилагаемый reg-файл, который внесет необходимые изменения в реестре того ПК, на котором не открываются chm-файлы по сети. Содержимое прилагаемого reg-файла:

REGEDIT4

[HKEY\_LOCAL\_MACHINESOFTWAREMicrosoftHTMLHelp]

[HKEY\_LOCAL\_MACHINESOFTWAREMicrosoftHTMLHelp1.xItssRestrictions] "MaxAllowedZone"=dword:00000001

Более подробная информация о том, почему не открываются chm-файлы по сети, доступна на сайте Microsoft: <http://support.microsoft.com/kb/896054>.

#### Проблема вызова справок в формате HLP

В операционной системе Windows 7 компания Microsoft отказалась от поддержки устаревшего формата справок .HLP в пользу более прогрессивного формата CHM. Так вот, при попытке открыть файлы справки устаревшего формата появляется окно с сообщением: “Справка для этой программы была создана в формате справки Windows, который зависит от компонента, не входящего в данную версию Windows. Для просмотра справки, созданной в формате справки Windows, можно загрузить специальную программу».

В данном случае отсутствующий "компонент" - это файл WinHlp32.exe, который и должен открывать файлы справки. В Windows 7 он физически тоже есть, лежит в папке с установленной системой, но на деле это всего лишь пустышка размером в несколько килобайт. К счастью существует [обновлени](http://www.microsoft.com/downloads/details.aspx?displaylang=ru&FamilyID=258aa5ec-e3d9-4228-8844-008e02b32a2c)е, устанавливающее в систему Windows правильный файл WinHlp32.exe, но чтобы их скачать требуется пройти проверку подлинности операционной системы. Также опытным путем выяснилось, что проблема устраняется, если взять файлы WinHlp32.exe от Windows XP и заменить ими пустышки в Windows 7. В этом случае сперва придется удалить файл-пустышку, а он заблокирован системой. Для удаления неудаляемого файла проще всего воспользоваться бесплатной программой [Unlocker](http://www.emptyloop.com/unlocker/).

#### Проблема со шрифтами в формате HLP

Если в справке появляется нечитаемый текст, значит, справочная система Вашей операционной системы путается в кодовых страницах. Чтобы это преодолеть системе нужно подсказать кодовую страницу. См. раздел реестра \HKEY\_LOCAL\_MACHINE\ SOFTWARE\ Microsoft\ Windows NT\ CurrentVersion\ FontSubstitutes. Добавьте туда с помощью программы – редактора системного реестра «REGEDIT» следующие строки:

|  |  |
| --- | --- |
| Имя | Значение |
| Arial,0 | Arial,204 |
| Courier New,0 | Courier New,204 |
| Times New Roman,0 | Times New Roman,204 |

После введенных изменение - перезагрузить компьютер.

#### Проблема со шрифтами в формате CHM

Если в справке появляется нечитаемый текст, значит, справочная система Вашей операционной системы путается в кодовых страницах. Проблема лечится включением в Internet Explorer параметра Вид-Кодировка в значение «Автовыбор». Все дело в том, что для просмотра CHM Windows использует движок Internet Explorer.

## Инсталляция СУБД

### FIREBIRD

Установить Firebird сервер версии не ниже чем 2.5.4 и клиентскую часть СУБД. Можно для серверной части и клиентской использовать один и тот же компьютер.

Сервер Firebird2.5.4 можно установить в двух основных режимах – SuperServer и SuperClassic. В режиме SuperServer процесс fbserver использует только одно ядро процессора на базу данных и общий кэш данных для всех подключений, что позволяет значительно быстрее работать с небольшим количеством одновременных пользователей базы данных. В режиме SuperClassic Firebird позволяет задействовать многопроцессорную архитектуру и для каждого клиентского подключения создается отдельный поток внутри серверного процесса и свой кэш данных. В режиме SuperServer работа кэша намного эффективнее, чем в SuperClassic, но SuperClassic позволяет использовать многопроцессорную архитектуру и распределить нагрузку по разным ядрам процессора. Но при этом, режим SuperClassic из за отдельно кэша для каждого подключения более требователен к кэшу операционной системы и скорости обмена данных с жестким диском. Вам следует выбирать режим работы сервера Firebird исходя из анализа загрузки процессора, количества одновременных подключений к базе данных и скорости работы Fansy-приложения.

Для работы с большим количеством одновременных клиентских подключений (ориентировочно от 20-ти) для Windows и Linux серверов FireBird 2.5 следует устанавливать в режиме SuperClassic (процесс fb\_inet\_server.exe) на серверную операционную систему.

Для небольшого количества одновременных клиентских подключений (до 20-ти) для Windows сервера FireBird 2.5 следует устанавливать в режиме SuperServer (процесс fbserver.exe) и привязывать его на одно ядро процессора параметром «/affinity» при запуске, либо параметром «CpuAffinityMask» в конфигурационном файле firebird.conf. Потери производительности Firebird из-за переключений операционной системой между ядрами процессора могут достигать от 10-50%. Версию ОС Windows можно использовать и не серверную, но крайне желательно 64-х разрядную для поддержки большего объема оперативной памяти. При постоянной загрузке ядра процессом fbserver.exe следует переставить Firebird в режим SuperClassic.

Обязательно прочитайте рекомендации по настройке производительности оборудования одного из разработчиков Firebird с сайта <http://www.ibase.ru/files/firebird/Firebird_Hardware_Guide_2015_rus.pdf> и замените стандартный конфигурационный файл FireBird «оптимизированным».

Для сервера и рабочей станции выбирайте процессор с максимальной частотой и размером кеша ядра процессора. Количество ядер на сервере используйте исходя из количества одновременных или планируемых пользователей базы данных. Сервер БД и рабочая станция должны быть в одной локальной сети с ping’ом не более 1 мс между ними.

Firebird является версионной СУБД, поэтому в процессе его работы образуется много версий данных, индексов и требуется чистка устаревших записей, оптимизация внутри файла базы данных. Для этого регулярно проводите замену рабочей базы восстановленной после бэкапа. При этом происходит чистка мусора, перестроение индексов, оптимизация таблиц, что сказывается на ускорении работы с базой данных. Частота подмены базы зависит от интенсивности и количества изменений и добавлений записей в базу.

Базы поставляются в транспортабельном формате FBK и могут работать с версиями СУБД на платформах MS Windows и UNIX. Их нужно предварительно развернуть утилитой GBAK или IBExpert.

После установки Firebird надо добавить к нему библиотеку функций. Библиотека копируется в директорию …\Firebird\UDF.

* Для MS Windows библиотека поставляется в готовом виде – ib\_Fansy.dll и ib\_Fansy\_3.dll
* Для UNIX поставляются исходные тексты библиотеки (FsFBUDF.cpp, FsFBUDF.h и Makefile); скомпилируйте из них библиотеку ib\_Fansy компилятором g++ командой make из папки с Makefile файлом. Для CentOs 7.0 установка компилятора выполняется командой yum install gcc-c++

Если на сервере уже установлена библиотека функций, сравните версии файлов и выберете самую свежую версию библиотеки. Все версии системной библиотеки совместимы снизу вверх. После добавления/изменения системных библиотек Firebird сервер следует перезапустить.

Не забудьте установить клиентскую часть Firebird на каждую рабочую станцию, которая будет подключаться к серверу Firebird. Fansy-приложения используют 32-битную библиотеку клиентской части.

### MSSQL

Для работы приложений нужна версия MS SQL 2008 R2 или выше.

Параметры сортировки сервера должны не зависеть от регистра букв (case insensitive – маленькие и большие буквы неразлечимы), например: Cyrillic\_General\_CI\_AS.

Желательно, чтобы SQL Server был инсталлирован с двоякой проверкой подлинности (Authentication) – не только Windows Authentication, но и SQL Server Authentication.

Дампы баз данных находятся в файлах с расширением BAK.

Рекомендуется для базы данных устанавливать опцию READ\_COMMITTED\_SNAPSHOT (мы рекомендуем эту опцию) или даже ALLOW\_SNAPSHOT\_ISOLATION. Выбор нужного режима изоляции транзакций возлагается на пользователя. Если ни одна из этих опций не установлена, то база данных будет работать в режиме READ\_UNCOMMITED, что приводит к экскалации блокировок и затрудняет работу в многопользовательском режиме. Включение любой из этих опций приводит к уменьшению количества блокировок, но повышают требования к объему системной базы данных **tempdb** (особенно для опции ALLOW\_SNAPSHOT\_ISOLATION**).** Для повышения производительности рекомендуется разместить системную базу данных **tempdb** на отдельном диске и выделить ей соответствующее пространство.

Не забудьте установить клиентскую часть MSSQL на каждую рабочую станцию, которая будет подключаться к серверу MSSQL. Fansy-приложения используют 32-битную библиотеку клиентской части.

### ORACLE

На сервере следует установить экземпляр Oracle сервер (не младше 11g) и сгенерировать general purpose экземпляр базы в кодировке CL8MSWIN1251. Системы использует стандартные табличные пространства USERS, INDX, TEMP и SYSTEM. Табличные пространства USERS и INDX настоятельно рекомендуется располагать на различных дисках/томах (логических томах RAID), в противном случае производительность системы будет неудовлетворительной (раза в 2 медленнее чем при работе с FireBird). Также, когда это возможно, разные группы оперативных журналов регистрации транзакций должны быть разнесены по разным дискам/томам. Кроме того, дисковое пространство, куда процесс ARCH пишет архивные журналы транзакций, должно быть отделено от места расположения оперативных журналов транзакций. Одним важным моментом, который нужно учитывать, является тот факт, что в то время, как LGWR пишет данные в один оперативный журнал транзакций, ARCH может читать из предыдущего журнала, чтобы создать архивный журнал транзакций. Это означает, что для оптимальной производительности и исключения конкуренции между процессами LGWR и ARCH, требуется более одного диска/тома. Если Вы ограничены в количестве дисков, создайте по одному логическому тому отдельно для четных и нечетных групп оперативных журналов вместе с отдельным логическим томом для архивных журналов.

На клиентских машинах следует установить экземпляр ORACLE клиент. Чтобы Fansy-приложения отображали данные в правильной кодировке, а утилиты ORACLE давали читаемую диагностику, значение переменной NLS\_LANG в системном реестре Windows, в домашнем разделе ORACLE должна быть установлена в значение «AMERICAN.CL8MSWIN1251» или «RUSSIAN\_CIS.CL8MSWIN1251», а значение переменной NLS\_DATE\_FORMAT в значение «DD.MM.RRRR HH24:MI:SS». Домашний раздел ORACLE в разных Windows и в разных версиях ORACLE может быть разным. Например: HKEY\_LOCAL\_MACHINE\SOFTWARE\ORACLE\HOME или HKEY\_LOCAL\_MACHINE\SOFTWARE\Wow6432Node\ORACLE\KEY\_OraClient11g\_home1. Если не корректно отображаются русские буквы в Fansy-приложениях, то можно указать эту в Windows среде: SET NLS\_LANG = RUSSIAN\_CIS.CL8MSWIN1251.

При конфигурировании экземпляра базы можно (но не рекомендуется) указать параметр optimizer\_mode=CHOOSE, что означает автоматический выбор стратегии оптимизации. Все запросы к данным написаны так, что достаточно пользоваться оптимизатором, основанном на правилах (optimizer\_mode=RULE). Для достижения максимальной производительности лучше использовать оптимизатор, основанный на стоимостном подходе (optimizer\_mode=FIRST\_ROWS). В этом случае задача управления статистикой базы ложится на администратора системы. Скрипт на сбор статистики входит в поставку системы.

Дампы баз данных находятся в файлах с расширением DMP и могут работать с версиями СУБД для различных платформ. Поставляемы дампы баз сформированы в формате утилиты IMPDP.

В реальных случаях (установлено несколько различных Fansy-приложений или одно Fansy-приложение используется с различными базами данных) каждая база данных экспортируется в схему с названием, согласованным с пользователем. Дампы баз необходимо импортировать утилитой IMPDP, предварительно создав как пользователей SYSDBA, ADMIN, USER (которые играют в системе особую роль), так и пользователей с именами соответствующих схем и с ролями CONNECT и EXECUTE ANY TYPE (пользователи с именами схем ответственны за прогон скриптов на создание и обновление схемы данных приложения). Особенность пользователя SYSDBA заключается в предоставлении ему всех прав (включая права на создание, модификацию и удаление объектов БД) на все схемы данных, используемых приложениями Fansy. После импорта баз данных для этого случая (назовем его COMPLEX-инсталляция) имя каждой схемы базы данных следует прописывать в алиасе DBX-соединения. Ситуация усугубляется в случае если требуется поддерживать несколько версий одновременно работающих Fansy-приложений, когда требуется несколько баз метаданных. Следует заметить, что случай COMPLEX -инсталляция позволяет иметь рабочую и тестовую базу приложения, и как следствие, рекомендуется к использованию в любом случае.

Пример корректного создания пользователя SYSDBA:

create user SYSDBA IDENTIFIED BY password;

grant connect to SYSDBA;

grant execute any type to SYSDBA;

grant create any synonym to SYSDBA;

grant drop any synonym to SYSDBA;

Пример создания пользователя ADMIN:

create user ADMIN password;

grant connect to ADMIN;

grant execute any type to ADMIN;

При импорте баз данных автоматически загрузятся права всех пользователей на данные. Порядок импорта важен: сначала импортируется база данных, затем – база метаданных. Пример:

impdp SYSTEM/pass@ORACLE\_BASE SCHEMAS=SYSDBA DUMPFILE=exp.dmp COMPILE=Y

impdp SYSTEM/pass@ORACLE\_BASE SCHEMAS=SYSDBA REMAP\_SCHEMA=SYSDBA:TRUST DUMPFILE=exp.dmp

impdp SYSTEM/pass@ORACLE\_BASE SCHEMAS=META DUMPFILE=expmeta.dmp COMPILE=Y

В поставляемом дампе таблицы привязаны к табличному пространству USERS, а индексы к табличному пространству INDX, соответсвенно все пользователи ситемы должны иметь права на эти пространства. Если используются другие табличные пространства, то в утилите impdp необходимо использовать параметр REMAP\_TABLESPACE (пример: REMAP\_TABLESPACE= USERS : MY\_USERS).

При настройке экземпляров следует иметь ввиду, что база метаданных используется только на чтение, объем данных в ней небольшой, и защищать данные от потери не требуется, т.к. их всегда можно получить у службы сопровождения. Ниже приводится пример параметров экземпляра базы данных из файла spfileXXXX.ora:

\*.nls\_language='AMERICAN'

\*.nls\_date\_format='DD.MM.RRRR HH24:MI:SS'

\*.nls\_numeric\_characters='. '

\*.nls\_sort='BINARY'

\*.open\_cursors=300

\*.optimizer\_index\_caching=90

\*.optimizer\_index\_cost\_adj=15

\*.optimizer\_mode='FIRST\_ROWS'

\*.processes=150

\*.query\_rewrite\_enabled='FALSE'

\*.session\_cached\_cursors=100

\*.star\_transformation\_enabled='TRUE'

\*.timed\_statistics=TRUE

\*.undo\_management='AUTO'

\*.undo\_retention=900

Среди вышеуказанных параметров, установка приведенных значений не являются необходимым, т.к. FANSY-приложения устанавливает NLS параметры для каждой открываемой сессии. Для установки значений параметров, совместимых с работой FANSY-приложения следует выполнить следующие команды:

alter session set NLS\_DATE\_FORMAT = 'DD.MM.RRRR HH24:MI:SS' scope =spfile;

alter session set NLS\_SORT = BINARY scope =spfile;

alter session set NLS\_NUMERIC\_CHARACTERS=". " scope =spfile;

Не забудьте установить клиентскую часть ORACLE на каждую рабочую станцию, которая будет подключаться к серверу ORACLE. 32-битные Fansy-приложения используют 32-битную библиотеку клиентской части.

Запустите на клиенте ORACLE Net Manager и укажите правильное имя сервиса экземпляра базы данных на сервере. Пример:

![](data:image/png;base64...)

### PostgreSQL

Для работы приложений нужна версия PostgreSQL 9.6 или выше. Настоятельно рекомендуется использовать Unix семейства операционных систем. Поддерживаемые версии ОС и дистрибутивы можно посмотреть на сайте www.postgresql.org.

Система использует табличные пространства «users» для таблиц данных пользователя и «indx» для индексов данных пользователя. Для увеличения производительность системы табличные пространства users и indx рекомендуется располагать на различных дисках. Права на директории с табличными пространствами должны принадлежать пользователю, которому принадлежит сервер PostgreSQL.

Файлы баз данных поставляются в файлах дампов схем, обычно с расширением “sql”. Для распаковки можно использовать команды консоли PSQL или графическую оболочку PgAdmin v4 и выше (www.pgadmin.org).

Пример команд создания директорий и psql команд для для создания табличных пространств и восстановления схемы pg\_depo.sql в базу на сервере CentOS:

sudo mkdir -p /var/lib/postgresql/17/users

sudo mkdir -p /var/lib/postgresql/17/indx

sudo chown postgres:postgres /var/lib/postgresql/17/users

sudo chown postgres:postgres /var/lib/postgresql/17/indx

sudo chmod 700 /var/lib/postgresql/17/users

sudo chmod 700 /var/lib/postgresql/17/indx

И уже в PSQL:

postgres=# CREATE TABLESPACE users LOCATION '/var/lib/pgsql/17/users';

postgres=# CREATE TABLESPACE indx LOCATION '/var/lib/pgsql/17/indx';

Метакоманда \db утилиты [psql](https://postgrespro.ru/docs/postgrespro/9.5/app-psql.html) позволяет отобразить список существующих табличных пространств.

Выйти из psql и затем восстановить схемы из файлов бэкапа bal\_meta.sql и bal\_data.sql под пользователем postgres в базу по умолчанию postgres:

/usr/lib/postgresql/17/bin/pg\_restore -U postgres -d postgres --schema bal\_meta --single-transaction --verbose -W bal\_meta.sql

/usr/lib/postgresql/17/bin/pg\_restore -U postgres -d postgres --schema bal\_meta --single-transaction --verbose -W bal\_data.sql.

Пример команды psql для восстановления базы на сервере Windows:

C:\Program Files\PostgreSQL\9.6\bin psql.exe-f *D:\Fansy\Bases\* bal\_data.sql -U postgres

Для корректного отображения русских букв в Windows psql первой командой выполните «\! Chcp 1251 chcp 1251» или установите кодовую страницу перед запуском psql в командном файле (chcp 1251) и выберите шрифт Lucida Console.

Намного удобнее и привычнее проводить операции с PostgreSQL через графическую оболочку PgAdmin. Скачать её можно с сайта <https://www.pgadmin.org/download/> или установить из репозитория Вашей ОС Линукс.

Конфигурационные файлы PostgreSQL обязательно откорректировать для оптимальной производительности оборудования и приложения. Для ориентировочных значений конфигурационных параметров можно воспользоваться рекомендациями с сайта <http://pgtune.leopard.in.ua/> или <https://www.pgconfig.org/#/?max_connections=100&pg_version=16&environment_name=WEB&total_ram=6&cpus=2&drive_type=SSD&arch=x86-64&os_type=linux>

***Параметры PostgreSQL для Вашей версии увеличивать ОБЯЗАТЕЛЬНО! Со стандартными настройками ПО FANSY не работает!***

Откройте директорию установки PostgreSQL и откройте файл **postgresql.conf**. Строки, идущие после символа «#» являются комментариями и кратко описывают доступные параметры сервера. Удалите символ «#» перед именем параметра, чтобы изменение вступило в силу. В зависимости от версии, параметры сервера могут отличаться.

Для работы с программами Fansy необходимо означить следующие параметры:

|  |  |  |
| --- | --- | --- |
| **Имя параметра** | **Стандартное в 9.6** | **Рекомендуемое значение** |
| max\_connections | 40 | 100 |
| search\_path | '"$user", public' | "$user",public,data,extensions' + имена схем ваших приложений |
| lock\_timeout | 0 | 3000 |
| datestyle | 'iso, dmy' | 'German, DMY' |
| client\_encoding | - | sql\_ascii |
| lc\_messages | 'Russian\_Russia.1251' | 'C' |
| lc\_monetary | 'Russian\_Russia.1251' | 'C' |
| lc\_numeric | 'Russian\_Russia.1251' | 'C' |
| lc\_time | 'Russian\_Russia.1251' | 'Russian\_Russia.1251' |
| max\_locks\_per\_transaction | 64 | 2048 |

Параметры производительности зависят от вашей конфигурации сервера, однако мы рекомендуем не оставлять настройки стандартными и отредактировать некоторые значения для сервера с 16 Гб ОЗУ 8- ядрами и SSD диском:

|  |  |  |
| --- | --- | --- |
| **Имя параметра** | **Стандартное в v.16** | **Рекомендуемое значение** |
| shared\_buffers | 128MB | 4GB |
| temp\_buffers | 8MB | 512MB |
| work\_mem | 4MB | 5000KB |
| maintenance\_work\_mem | 64MB | 1GB |
| effective\_cache\_size | 4GB | 12Gb |
| max\_locks\_per\_transaction | 512 | 8000 |
| wal\_buffers |  | 16MB |
| random\_page\_cost |  | 1.1 |
| effective\_io\_concurrency |  | 200 |
| huge\_pages |  | off |
| min\_wal\_size |  | 1GB |
| max\_wal\_size |  | 4GB |
| max\_worker\_processes |  | 8 |
| max\_parallel\_workers\_per\_gather |  | 4 |
| max\_parallel\_workers |  | 8 |
| max\_parallel\_maintenance\_workers |  | 4 |
| max\_stack\_depth | 2MB | 100MB |

## Инсталляция шлюза доступа к СУБД

### Шлюз DBX (dbExpress)

Для доступа к СУБД на рабочей станции необходимо установить и настроить шлюз доступа DBX (dbExpress).

Шлюз DBX был разработан для решения следующих задач:

* обеспечение доступа к данным и процедурам СУБД;
* минимизация объема и количества используемых ресурсов;
* получение максимальной скорости работы;
* обеспечение легкости установки и настройки;

### Установка и настройка шлюза DBX

Шлюз DBX (dbExpress) не требует установки в традиционном понимании. Для работы через него необходимо переписать соответствующий exe-файл приложения и dll-файлы, поставляемые с системой. Эти dll-файлы можно разместить как в директории с приложением, так и в любой директории доступной для поиска операционной системой. После записи файлов необходимо настроить соединения утилитой DBX Administrator (DBXAdmin.exe – входит в комплект поставки системы). Запускать программу следует под правами системного администратора рабочей станции, т.к. программа делает запись в системный реестр MS Windows.

Форма DBX Administrator для настройки соединений выглядит следующим образом:

![](data:image/png;base64...)

Слева отображается список соединений (может быть пуст, если ни одно соединение не создано). Справа – параметры выбранного соединения. Кнопки сверху:

«Добавить» и «Удалить» – добавление нового и удаление выбранного соединения;

«Копировать» – создаёт копию выбранного соединения;

«Переименовать» – предлагает ввести новое наименование выбранного соединения;

«Редактор ODBC DSN» - открывает встроенный в Windows редактор ODBC соединений.

«Импорт из BDE» - создаёт копии соединений, настроенных ранее в шлюзе BDE (для тех рабочих станций, на которых ранее использовался шлюз BDE).

«Тест» – открывает соединение с целью проверки правильности параметров;

Поля «Драйвер» и «Отображать известные имена» используются для фильтрации имён соединений. Драйвер можно выбрать для того, чтобы видеть соединения, работающие через конкретный драйвер. Флаг «Отображать известные имена» покажет только те соединения, имена которых содержат рекомендуемые данным документом суффиксы (META, DATA, DEPO, REESTR, SPECTRE или STANDARD).

Кнопка «ОК» сохраняет все соединения и их параметры; кнопка «Cancel» закрывает программу, не сохранив ничего.

При создании нового соединения все параметры выставляются в значения по умолчанию, указанному в системном файле настроек dbxdrivers.ini. Их можно не трогать, за исключением наименования баз данных и путей к базам данных.

#### Особенности настройки доступа к СУБД FireBird

Для СУБД FireBird в системном файле настроек dbxdrivers.ini используются следующие параметры:

[Firebird]

GetDriverFunc=getSQLDriverINTERBASE

LibraryName=dbexpint.dll

VendorLib=fbclient.dll

Database=database.gdb

RoleName=RoleName

User\_Name=sysdba

Password=masterkey

ServerCharSet=

SQLDialect=1

BlobSize=-1

CommitRetain=False

WaitOnLocks=True

ErrorResourceFile=

LocaleCode=0000

Interbase TransIsolation=ReadCommited

Trim Char=True

Для СУБД FireBird в параметре Database должен быть указан путь к базе данных в следующем формате:

<имя сервера>:<буква диска>:\<путь к файлу базы данных>

например:

server\_name:d:\fansy\bases\ZZZ\_DATA.fdb

Если используется база данных в формате диалекта 3, то надо выставить параметр SQLDialect в значение 3.

#### Особенности настройки доступа к СУБД MS SQL

Для СУБД MS SQL в системном файле настроек dbxdrivers.ini используются следующие параметры:

[DevartSQLServer]

GetDriverFunc=getSQLDriverSQLServer

LibraryName=dbexpsda.dll

VendorLib=sqloledb.dll

BlobSize=-1

HostName=

DataBase=

User\_Name=

Password=

Для доступа к СУБД MS SQL должен использоваться драйвер SQLServer; в параметре HostName должно быть указано имя сервера, а в параметре Database – имя базы данных.

#### Особенности настройки доступа к СУБД Oracle

Для СУБД Oracle (драйвер DevartOracle) в системном файле настроек dbxdrivers.ini используются следующие параметры:

[DevartOracle]

GetDriverFunc=getSQLDriverORA

LibraryName=dbexpoda.dll

VendorLib=OCI.DLL

BlobSize=-1

DataBase=

Schema=

ErrorResourceFile=

LocaleCode=0000

Password=

Oracle TransIsolation=ReadCommitted

User\_Name=

UseUnicode=False

В параметре DataBase указывается имя базы данных.

Для доступа к СУБД Oracle в параметре Schema указывается имя cхемы соответствующей базы данных или метаданных Fansy-приложение. При задании этого параметра Fansy-приложение включит режим переадресации всех SQL-команд от схемы пользователя к заданной схеме базы данных. Указание схемы является обязательным условием.

#### Особенности настройки доступа к СУБД PostgreSQL

Для СУБД PostgreSQL (драйвер Devart PostgreSQL) в системном файле настроек dbxdrivers.ini используются следующие параметры:

[DevartPostgreSQL]

GetDriverFunc=getSQLDriverPostgreSQL

LibraryName=dbexppgsql.dll

VendorLib=dbexppgsql.dll

BlobSize=-1

HostName=

SchemaName=

DataBase=

User\_Name=

Password=

UseQuoteChar=False

EnableBCD=True

,где:

HostName - имя сервера, DataBase - имя базы, SchemaName - имя схемы.

Для доступа к СУБД PostgreSQL (в случае, когда установлено несколько различных Fansy-приложений или одно Fansy-приложение используется с различными базами данных) в параметре SchemaName указывается имя cхемы, соответствующей базы данных или метаданных Fansy-приложение. Указание схемы является обязательным условием.

#### Особенности настройки доступа к ODBC

Для работы через ODBC (драйвер OpenODBC) в системном файле настроек dbxdrivers.ini используются следующие параметры:

[OpenOdbc]

LibraryName=dbxoodbc.dll

GetDriverFunc=getSQLDriverODBC

VendorLib=odbc32.dll

OpenOdbc TransIsolation=ReadCommited

Database=

User\_Name=user

Password=password

RowsetSize=20

BlobSize=-1

Trim Char=True

Custom String=coNetPacketSize=8192;coLockMode=17

Для работы через мост DBX-ODBC должен использоваться драйвер OpenODBC; необходимо в поле Database указать имя источника данных (Data Source Name) из редактора ODBC DSN.

### Файлы, используемые в DBX

Драйверы и соединения DBX описываются в файлах dbxdrivers.ini и dbxconnections.ini соответственно. Они обычно расположены в директории

<ProgramData>\FANSY\DBX

или в

<ProgramFiles>\Common Files\Borland Shared\dbExpress

Если DBX ранее не использовался, то эти файлы создаются программой DBX Administrator при первом запуске. Также DBX Administrator прописывает пути до этих файлов в системном реестре в разделе:

HKEY\_CURRENT\_USER\Software\FANSY\DBX

или в

HKEY\_CURRENT\_USER\Software\Borland\DBExpress

В директории с приложением должны бать расположены dll-файлы с драйверами используемой СУБД

dbexpint.dll – для Firebird

dbexpca400.dll – для DB2

dbxoodbc.dll – для обеспечения моста доступа к ODBC и чтения DBF файлов

dbexpoda.dll – для ORACLE

dbexpsda.dll – для MSSQL

ВНИМАНИЕ! Драйверы dbexpoda.dll, dbexpsda.dll рекомендуется приобрести у производителя (http://www.devart.com/dbx/download.html)

Проблемы могут возникнуть, если ранее на рабочей станции был установлен и позже удалён пакет Delphi. При удалении Delphi в системном реестре (в вышеупомянутом разделе) может остаться путь на несуществующую директорию. В этом случае утилита DBX Administrator не показывает ни одного драйвера для доступа к базам. Этот раздел можно удалить вручную. Утилита DBX Administrator при запуске создаст правильный путь и пропишет его в реестр.

### Добавление новых DBX-драйверов

Файлы db\*.dll новых драйверов необходимо переписать в папку, в которую настроены пути поиска Windows (переменная среды PATH) (кроме %Windows%\system32), либо в папку самого Fansy-приложения, заменив старые файлы.

Для установки нового драйвера необходимо изменить файла конфигурации dbxdrivers.ini. Для примера рассмотрим как добавить OpenODBC драйвер в dbxdrivers.ini.

В раздел [Installed Drivers] дописываем строчку:

OpenODBC=1

Далее копируем раздел [OpenOdbc] из dbxdrivers.ini, предоставляемого поставщиком,. Раздел имеет следующий вид:

[OpenOdbc]

LibraryName=dbxoodbc.dll

GetDriverFunc=getSQLDriverODBC

VendorLib=odbc32.dll

OpenOdbc TransIsolation=ReadCommited

Database=

User\_Name=user

Password=password

RowsetSize=20

BlobSize=-1

Trim Char=True

Custom String=coNetPacketSize=8192;coLockMode=17

После этого копируем раздел [OpenOdbc TransIsolation]:

[OpenOdbc TransIsolation]

DirtyRead=0

ReadCommited=1

RepeatableRead=2

Теперь драйвер добавлен и можно настраивать соединения используя новый драйвер.

### Настройка DBX-соединений из Fansy-приложения

Перед подключением к базе данных из приложений Fansy можно вызвать редактор DBX соединений, чтобы добавить недостающие соединения или подкорректировать существующие. Для этого на закладке «База данных» формы «Регистрация» сделана кнопка «Редактор соединений». По кнопке запускается форма DBX Administrator, идентичная описанной в предыдущем разделе. В отличие от приложения DBX Administrator здесь нельзя импортировать настройки из BDE.

![](data:image/png;base64...)

### Доступ к данным посредством ODBC-соединений

ODBC соединения используются для подключения к любым базам данных поддерживающим стандарт (Open DataBase Connectivity), включая такие распространенные БД как MS Access и \*.dbf.

Для настройки ODBC алиаса необходимо наличие у вас драйверов OpenODBC и их настроек в DBXAdmin. Подробнее о добавлении данных драйверов см. «Руководство по инсталляции и администрированию» раздел «Добавление новых DBX-драйверов».

Для начала необходимо настроить ODBC соединение средствами Windows, для этого необходимо:

1. Откройте окно «Источники данных ODBC» (Пуск->Панель управления->Администрирование->Источники данных ODBC).

![](data:image/png;base64...)

1. На закладке «Пользовательский DSN» нажмите кнопку «Добавить» и выберите необходимый вам тип драйвера.
2. В качестве имени источника данных введите любое наименование соединения латинскими буквами. Далее нажмите кнопку “Выбрать” и в появившемся диалоговом окне выберите файл подключаемой базы данных.

![](data:image/png;base64...)

1. Нажмите кнопку “OK”. В таблице пользовательских DSN должно появиться новое соединение.

Далее откройте DBXAdmin и создайте новый алиас выбрав в качестве драйвера OpenODBC, а в поле Database впишите имя источника данных, созданного ранее.

Теперь при запросе подключения к внешней базе вы можете использовать данный алиас.

## Аппаратный ключ защиты HASP

### Инсталляция ключа HASP

Данный раздел следует применять в случае, если поставленное Вам программное обеспечение защищено аппаратным ключом. Установите драйвер ключа (HASPUserSetup.exe) на всех компьютерах, использующих приложение. Также в случае если у вас сетевой HASP ключ необходимо поставить драйвера HASP на тот компьютер, к которому физически будет подключен ключ.

Файл драйвера входит в комплект поставки ПО, но крайне рекомендуется скачать последнюю версию драйвера с сайта производителя <http://sentinelcustomer.safenet-inc.com/sentineldownloads/>. При наличии на компьютере более ранних версий драйверов HASP необходимо предварительно удалить их, произвести перезагрузку компьютера, после чего обновить драйвер. Проверить работоспособность драйвера, а также посмотреть информацию по ключу можно через web-интерфейс, введя в адресную строку браузера <http://localhost:1947>

При наличии в сети электронных ключей HASP сторонних поставщиков программного обеспечения, либо при установки ключа в другую (относительно рабочей станции) подсеть, следует настроить IP-адрес сервера с ключом. Настройки производятся на рабочей станции через тот же web-интерфейс (порт 1947), выбрав опцию Configuration. IP-адрес указывается на закладке Access to Remote License Managers в поле Specify Search Parameters. В случае конфликта с ключом стороннего поставщика можно ещё снять флаг Broadcast Search for Remote Licenses. Отредактированные поля становятся розовыми; после редактирования надо сохранить изменения, нажав кнопку Submit.

При необходимости пробросить ключ в ОС семейства Windows, развернутую на удаленной рабочей станции, необходимо использовать стороннее ПО (например, USB over Network), работающее через ЛВС, или же аппаратное решение AnywhereUSB. В случае использования виртуальных сред, можно использовать те же средства проброса, или инструменты, предоставляемые разработчиками виртуальных сред.

![](data:image/png;base64...)

По вопросам установки ключа в различных операционных системах обращайтесь к производителю продукта на сайт <http://www.aladdin-rd.ru/>

Если вы скачали демо-версию приложения, *устанавливать ключ не требуется*. Демо-версия не защищена аппаратным ключём.

### Сообщения о лицензионных ограничениях

В ключе HASP содержится информация о приобретенных лицензиях на программное обеспечение. Лицензируются количество одновременно работающих с программным обеспечением рабочих мест и количество транзакций[[1]](#footnote-1) в день. В случае нарушения лицензионных ограничений пользователи получат на экране следующие сообщения:

**Превышено количество рабочих мест.** Сообщение выдаётся при запуске приложения пользователем, когда приложение уже используется лимитированным количеством пользователей. Для входа нового пользователя кому-либо из текущих пользователей нужно закрыть приложение. Если на какой-нибудь рабочей станции приложение запущено 2 раза, то становятся занятыми 2 лицензии.

**Нарушение ограничений лицензии на объем транзакций. Свяжитесь с правообладателем! 2.04.2012 было проведено 1085 операций. Лицензия допускает 1000 операций.** Сообщение выдаётся при запуске приложения при однократном превышении купленного количества транзакций. Пользователю сообщается о дате превышения, о превышенном и разрешённом количестве транзакций. Данное сообщение выдается пользователю при запуске приложения, при отсутствии повторения превышения по истечении 90 дней автоматически прекращается.

**Двукратное нарушение ограничений лицензии на объем транзакций. Свяжитесь с правообладателем! 2.04.2012 было проведено 1085 операций; 3.05.2012 было проведено 1203 операций. Ключ будет действителен по: 2.06.2012.** Сообщение выдаётся при запуске приложения при обнаружении двукратного превышения купленного количества транзакций. Пользователю сообщается о двух первых датах, в которые возникало превышение. Необходимо докупить нужное количество транзакций, на покупку даётся тридцать дней с момента второго нарушения. Если в течение месяца требуемое количество транзакций не докуплено, то приложение перестаёт запускаться. После оплаты высылается новая прошивка для HASP-ключа (ехе-файл по электронной почте) с новым количеством транзакций.

**Многократное нарушение ограничений лицензии на объем транзакций. 2.04.2012 было проведено 1085 операций; 3.05.2012 было проведено 1203 операций. Лицензия допускает 1000 операций. Вторичное нарушение было более 30 дней назад. Свяжитесь с правообладателем!** Сообщение выдаётся при просрочке 30 дней с момента второго нарушения. Приложение запускаться больше не будет, т.к. оплаты за новое количество транзакций не поступило. Для запуска программы необходимо докупить нужное количество транзакций. Пользователю сообщается о двух первых датах, в которые возникало превышение.

Информацию о количестве совершённых транзакций (сделок, операций) за каждый контролируемый день можно посмотреть в меню Справка – Информация о защите.

### Использование резервного HASP-ключа

Есть возможность заказать резервный ключ для осуществления непрерывной работы приложения при утрате (поломке, краже, и т.п.) рабочего HASP-ключа. Резервный ключ может быть активирован на несколько дней и использован до тех пор, пока рабочий ключ восстанавливают. По окончании срока активации резервный ключ блокируется. Для его разблокировки заказывается новая прошивка. Прошивку делает разработчик и отправляет её в виде выполняемого ехе-файла.

Когда приложение обнаруживает резервный не активированный ключ оно задаёт следующий вопрос операционисту:

**Обнаружен резервный HASP-ключ. Он может быть активирован на … дня. Активировать? (если Нет, то приложение будет закрыто)**

При нажатии кнопки «Да» ключ активируется и работа приложения продолжается до окончания срока активации. При нажатии «Нет» приложение закрывается, а ключ остаётся не активированным.

Если произошла незапланированная активация ключа или пользователь решил протестировать работу активации, то для восстановления его работоспособности необходимо оплатить новую прошивку.

### Ошибки, вырабатываемые аппаратной защитой

**Внимание!** Если на рабочей станции установлены пиратские копии программного обеспечения, которые используют взломщик для HASP, то могут быть проблемы с установкой драйвера HASP. За невозможность установки программного обеспечения на такую рабочую станцию производитель ответственности не несёт.

Коды ошибок HASP в процессе работы программы

|  |  |
| --- | --- |
| 1 | Запрос вышел за пределы памяти HASP |
| 2 | Недопустимый тип приложения |
| 3 | Недостаточно памяти |
| 4 | Превышен предел подключений к приложениям |
| 5 | Доступ к приложению закрыт |
| 6 | Функция дешифрации недоступна этому приложению |
| 7 | Ключ HASP недоступен |
| 8 | Буфер шифрования слишком мал для вызова функции |
| 9 | Неверный указатель. Указатель, переданный функции, неверен. |
| 10 | Указанный тип памяти отсутствует |
| 11 | Установленный драйвер устарел |
| 12 | В ключе отсутствует функция времени |
| 13 | Общая ошибка вызова host |
| 14 | Необходимый драйвер отсутсвует |
| 15 | Неправильный формат файла обновления HASP |
| 16 | Невозможно выполнить функцию в данному контексте |
| 17 | Данные переданные в функцию не содержат обновления |
| 18 | Ключ HASP не найден |
| 19 | Не найдены необходимые XML тэги |
| 20 | Текущее обновление не поддерживается ключом HASP |
| 21 | Счетчик обновлений установлен некореектно |
| 22 | Неправильный код разработчика |
| 23 | Ключ не поддерживает данный тип шифрования |
| 24 | Преданное значение выходит за границы типа |
| 25 | Батарейка времени разряжена |
| 26 | Запрошенные обновление данные отсуствуют |
| 27 | Программа выполняет на сервере терминалов |
| 28 | Отсутствует запрошенный тип программы |
| 29 | Алгоритм использованный в V2C файле неизвестен |
| 30 | Подпись ключа не прошла проверку |
| 31 | Данный тип программы отсуствует в ключе |
| 32 | Лог доступа недоступен |
| 33 | Ошибка подключения API к локальному License Manager’у |
| 34 | API не распознал ключ разработчика |
| 35 | Ошибка спецификации XML |
| 36 | Ошибка разбора XML |
| 37 | Подключено слишком много HASP ключей |
| 38 | Слишком много активных соединений |
| 39 | Сессия будет прервана |
| 40 | Ошибка соединения между локальным и сетевым License Manager’ами |
| 41 | Программа устарела |
| 42 | Версия License Managera устарела |
| 43 | I/O Error |
| 44 | Повторная установка обновления невозможна, обновление уже установлено |
| 45 | Ошибка системного времени |
| 46 | Ошибка соединения в зашифрованном канале |
| 47 | В защищенной области ключа повреждены данные |
| 48 | Невозможно найти библиотеку вендора |
| 49 | Невозможно загрузить библиотеку вендора |
| 50 | Невозможно найти подходящее приложение |
| 51 | Программа запущена на виртуальном компьютере |
| 52 | Несовместимость с софт ключом |
| 53 | Доступ к ключу запрещен настройками пользователя |
| 54 | Ошибка последовательности |
| 55 | Обновление устарело |
| 56 | Библиотека вендора устарела |
| 57 | Загрузка прервана из-за неверного формата |
| 58 | Неверный параметр получателя в XML |
| 59 | Неверный параметр действия в XML |
| 60 | Фильтр по продукту не возвращает уникальной записи |
| 61 | Неверная информация о продукте |
| 62 | Неизвестный получатель |
| 63 | Неверное значение длительности |
| 64 | Попытка клонирования ключа |

## Распаковка баз данных (restore)

Этот раздел будет полезен в том случае, если инсталляция системы поставщиком не предусмотрена условиями поставки, и это проблема встала перед вашим сисадмином.

### Распаковка баз данных в FIREBIRD

#### Распаковка утилитой IB Expert (оконный интерфейс)

Меню: Services –> Restore Database

![](data:image/png;base64...)

В диалоговом окне Database Restore надо означить следующие поля:

* в поле «Restore into» выбрать «New database»;
* в поле «Select Database»e указать имя файла будущей базы данных; путь к файлу может начинаться с имени сервера;
* в поле «File Name» выбрать файл с копией базы; файл должен находится на том же сервере, что и будущая база данных.

#### Распаковка утилитой GBAK (из командной строки)

Консольное приложение gbak.exe находится в директории Firebird\bin. Оно запускается из командной строки операционной системы и принимает все необходимые параметры для того, чтобы его можно было запускать автоматически из командного файла.

Пример для MS Windows:

"C:\Program Files\Firebird\Firebird\_2\_5\bin\gbak" -c -user sysdba -password masterkey -v -se server\_name:service\_mgr c:\fansy\bases\dem\_data.fbk c:\fansy\bases\dem\_data.fdb

или

"C:\Program Files\Firebird\Firebird\_2\_5\bin\gbak" -c -user sysdba -password masterkey -v c:\fansy\bases\dem\_data.fbk server\_name:c:\fansy\bases\dem\_data.fdb

Пример для UNIX:

/opt/firebird/bin/gbak -c -user sysdba -password masterkey -v -se server\_name:service\_mgr /opt/firebird/backup/dem\_data.fbk /opt/forebird/data/dem\_data.fdb

или

/opt/firebird/bin/gbak -c -user sysdba -password masterkey -v /opt/firebird/backup/dem\_data.fbk server\_name:/opt/forebird/data/dem\_data.fdb

В примере использованы следующие опции:

* -c – (create database) говорит о том, что нужна операция restore;
* -user sysdba – вход в базу будет произведён с именем sysdba;
* -password masterkey – пароль для входа; по умолчанию masterkey;
* -v – (verbose) вывод подробной информации о выполнении команды;
* -se server\_name:service\_mgr – распаковка с использованием сервис-менеджера (можно и без него, но с ним быстрее); тут вместо server\_name надо подставить имя вашего сервера.

После опций указывается копируемая база данных и имя файла, в который это копирование пойдёт.

Команду gbak.exe можно выполнять из любого планировщика задач, например из MS Schedule+

### Распаковка баз данных в MSSQL

Разверните базу используя утилиту Microsoft SQL Server Management Studio

![](data:image/png;base64...)

В диалоговом окне «Восстановление базы данных» надо означить следующие поля:

* в поле «В базу данных» надо ввести будущее имя базы;
* выбрать флаг «С устройства»;
* в качестве Устройства выбрать присланный Вам файл zzz\_META.bak;
* установить флаг в первой колонке таблицы, отметив, таким образом, что нужно восстановить полную базу данных.

На странице «Параметры» установить флаг «Перезаписывать существующую базу данных».

![](data:image/png;base64...)

После разворачивания базы метаданных надо в ней создать пользователей. См. раздел "Создание пользователей в MSSQL" данного документа.

### Распаковка баз данных в ORACLE

Cоздайте схемы пользователя META и пользователя SYSDBA. Выполните скрипты из файлов ORA\_META\_PUBLIC.sql и ORA\_DATA\_PUBLIC.sql. Проимпортируйте DMP-файлs баз данных из дистрибутива утилитой IMPDP, например командой:

impdp SYSTEM/password@ORACLE\_BASE SCHEMAS=SYSDBA DUMPFILE=expdata.dmp COMPILE=Y

impdp SYSTEM/password@ORACLE\_BASE SCHEMAS=META DUMPFILE=expmeta.dmp COMPILE=Y

Дамп баз данных в сервисном центре создается командой:

expdp SYSTEM/password@ORACLE\_BASE SCHEMAS=SYSDBA DUMPFILE=expdata.dmp.

expdp SYSTEM/password@ORACLE\_BASE SCHEMAS=META DUMPFILE=expmeta.dmp.

После разворачивания базы метаданных надо в ней создать пользователей. После создания пользователей желательно создать приватные синонимы на объекты баз данных для всех пользователей. Скрипты для создания синонимов поставляются с дистрибутивом системы: файл ORA\_META\_PRIVATE.sql и ORA\_DATA\_PRIVATE.sql.

### Распаковка баз данных в PostgreSQL

Файлы баз данных поставляются в виде дампов схем, обычно с расширением sql. Для распаковки можно использовать команды консоли PSQL или графическую оболочку PgAdmin v4 и выше ([www.pgadmin.org](http://www.pgadmin.org)).

Примеры команд для Линукса:

/usr/lib/postgresql/17/bin/pg\_restore -U postgres -d postgres --schema bal\_meta --single-transaction --verbose -W bal\_meta.sql

/usr/lib/postgresql/17/bin/pg\_restore -U postgres -d postgres --schema bal\_meta --single-transaction --verbose -W bal\_data.sql.

Пример команды psql для восстановления схемы pg\_depo базы postgres на сервере Windows из файла дампа:

C:\Program Files\PostgreSQL\9.6\bin psql.exe-f *D:\Fansy\Bases\pg\_depo.sql* -U postgres -schema "pg\_depo"

Пример команды pg\_restore.exe восстановления схемы pg\_depo.sql в базу postgres:

pg\_restore.exe -username postgres -W --dbname "postgres" --verbose --schema "pg\_depo" pg\_depo.SQL

Для корректного отображения русских букв в psql первой командой выполните «\! Chcp 1251 chcp 1251» или установите кодовую страницу перед запуском psql в командном файле (chcp 1251) и выберите шрифт Lucida Console.

## Создание пользователей

Приложение настроено для пользователей SYSDBA, ADMIN, USER и GUEST. Заведите их в качестве пользователей СУБД и присвойте им пароли.

### Создание пользователей в FIREBIRD

#### Использование командной строки.

Для создания пользователей в FireBird’е можно воспользоваться консольной утилитой gsec со следующими параметрами:

* -user < имя администратора СУБД (SYSDBA) >
* -password < пароль администратора СУБД (SYSDBA) >
* -database < сетевой путь (имя сервера:путь к файлу БД на диске) к базе данных на сервере security.fdb >
* -add < имя нового пользователя >
* -pw < пароль нового пользователя>
* -modify <имя изменяемого пользователя>

Пример №1, добавление нового пользователя:

gsec -user SYSDBA -password masterkey -database "ServerName:C:\Program Files\Firebird\Firebird\_2\_5\security.fdb" -add USER\_VASSYA -pw SECRET

Пример №2, изменение пароля у пользователя:

gsec -user SYSDBA -password masterkey -database "ServerName:C:\Program Files\Firebird\Firebird\_2\_5\security.fdb" -modify USER\_VASSYA -pw PAROL

#### Использование утилиты IBExpert.

Запустите IBExpert, выберите в верхнем меню Инструменты(Tools) -> Менеджер Пользователей(User Manager)

![](data:image/png;base64...)

В окне менеджера пользователей в поле сервер(server) впишите имя сервера, нажмите кнопку соединиться (connect) и введите имя и пароль в открывшееся окошко Server Login.

![](data:image/png;base64...)

Для добавления пользователя нажмите кнопку Добавить(Add) в форме Менеджера Пользователей и в открывшемся окошке введите реквизиты нового пользователя. Для изменения учётной записи пользователя нажмите кнопку Изменить(Edit). По окончании ввода нажмите кнопку ОК.

![](data:image/png;base64...)

### Создание пользователей в MSSQL

В СУБД MSSQL 2005 пользователи заводятся утилитой Management Studio. Пользователя SYSDBA надо создать обязательно. Это ключевой пользователь для администрирования предметной базы данных из приложений Fansy.

Перед созданием пользователя надо создать одноимённый логин (Login). После создания логина его привязывают к конкретной базе данных, создавая пользователя (User).

Следующий рисунок показывает пример создания логина.

![](data:image/png;base64...)

При назначении логина базе данных (User mapping) создаётся пользователь. Каждому пользователю должны быть назначены роли db\_datareader и db\_datawriter.

![](data:image/png;base64...)

На рисунке показано создание пользователя SYSDBA, который будет заходить в выбранную базу данных с логином SYSDBA. Пользователю SYSDBA назначаются вышеперечисленные роли.

На следующем рисунке показано тоже самое, но взгляд не с точки зрения базы данных, а с точки зрения логина SYSDBA. Пользователю, вошедшему в базу данных MIL\_DATA с логином SYSDBA, будет дано имя SYSDBA и роли db\_datareader, db\_datawriter (Роль public дана всем пользователям и не подлежит отмене).

![](data:image/png;base64...)

**Внимание!** Ни в коем случае не давайте пользователю никаких серверных ролей (закладка Server Roles) и не делайте его владельцем базы данных. Запрос select user должен вернуть имя пользователя и ни в коем случае не должен возвращать dbo

При переносе базы данных с одного сервера на другой может случиться ситуация когда логин не связывается с базой данных (пользователь не создаётся). При этом выдаётся следующее сообщение об ошибке:

![](data:image/png;base64...)

Это получается из-за того, что база данных уже была связана с этим логином (точнее с одноимённым логином) на другом сервере и не позволяет связываться с ним повторно (не поняв, что тут под этим именем выступает другой логин). Для преодоления такой ситуации эту связь надо удалить (удалить пользователя). Удаление возможно Delete из контекстного меню базы данных или следующей командой SQL:

exec sp\_dropuser 'USER\_1'

### Создание пользователей в ORACLE

В СУБД ORACLE пользователи заводятся утилитой Enterprise Manager Console. Всем пользователям необходимо присвоить роль "CONNECT" и системную привилегию "EXECUTE ANY TYPE". Надо обязательно завести пользователя SYSDBA, для загрузки дампа баз данных, и пользователя META, для загрузки дампа базы метаданных. Пользователям SYSDBA и META необходимо присвоить роли "CONNECT" и "DBA".

create user <user\_name> identifyed by <password>;;

grant DBA to <password>;

grant drop any sequence to <user\_name>;

grant create any sequence to <user\_name>;

### Создание пользователей в PostgreSQL

Для создания пользователей в PostgreSQL можно воспользоваться консольной утилитой PSQL или одной из графических оболочек, например PgAdmin. Обратите внимание, что имена пользователей для PostgreSQL регистрозависимы. Для создания пользователя большими буквами его надо взять в двойные кавычки. Создайте предустановленных пользователей программы SYSDBA, ADMIN, USER, GUEST. Для раздачи прав для Ваших пользователей на схемы создайте роль (группу) fansy\_users. В неё следует поместить пользователей программы и предоставить группе fansy\_users право U (usage) на схемы meta и data. У роли «SYSDBA» должны быть все права на схемы META и DATA,

Пример создания пользователя SYSDBA в верхнем регистре из оболочки psql:

CREATE USER "SYSDBA" WITH PASSWORD 'sysdbapass' LOGIN;

## Резервное копирование баз данных (backup)

Для обеспечения надёжного функционирования базы данных и для обеспечения возможности восстановления данных в случае сбоя вычислительного комплекса требуется ежедневно выполнять резервное копирование базы данных.

Рекомендуется хранить копии баз данных за несколько последних дней, а также на конец нескольких последних отчетных периодов.

Лучше, если сервер будет это делать сам, без участия администратора (речь не идёт о снятии с администратора функции контроля за копированием). Для такого копирования на серверах имеется команда Backup.

### Резервное копирование баз данных в Firebird

Резервное копирование можно выполнять консольным приложением **gbak.exe**, которое находится в директории **Firebird\bin**. Оно запускается из командной строки операционной системы и принимает все необходимые параметры для того, чтобы его можно было запускать автоматически из командного файла.

Пример:

gbak -b -g -password masterkey -user sysdba -v -y c:\fansy\bases\ZZZ\_DATA.lst server:c:\fansy\bases\ZZZ\_DATA.fdb c:\fansy\bases\ZZZ\_DATA.fbk

В примере использованы следующие опции:

* -b – (backup\_database) говорит о том, что нужна операция backup;
* -user sysdba – вход в базу будет произведён с именем sysdba;
* -password masterkey – пароль для входа;
* -v – (verbose) вывод подробной информации о выполнении команды;
* -g – опция выключает сборку мусора (сборка мусора не нужна, без неё копирование выполняется быстрее);
* -y c:\fansy\bases\ZZZ\_DATA.lst – направление информации о выполнении команды в файл, с указанным именем (не обязательная опция).

После всех опций указывается копируемая база данных и имя backup-файла, в который это копирование пойдёт.

Файл копии \*.fbk не содержит индексов и его размер сильно меньше чем размер базы данных \*.fdb. Этот файл к тому же очень хорошо сжимается любым архиватором. Поэтому, резервные копии не занимают много места.

Рекомендуется регулярно (возможно, раз в месяц) выполнять разворачивание базы данных из резервной копии. При разворачивании базы по-новому создаются индексы (исходя из того, что размер таблиц изменился), происходит переупорядочивание кластеров базы и повышается её производительность. Вновь развёрнутая база данных не содержит «мусора». Однако, при только при разворачивании возможно обнаружить ошибки, связанные с нарушением целостности данных. Необходимо обратить внимание на листинг – нет ли в конце сообщения об ошибке. Если есть, то необходимо признать backup-файл испорченным и разбираться со структурой данных (в соответствии с сообщением). ВНИМАНИЕ: никогда не разворачивайте backup-архив в файл с существующей базой данных; при неудачном разворачивании база получится испорченной. Всегда разворачивайте backup-архив в новый файл, а старую базу оставьте до тех, пор пока не убедитесь в безошибочной распаковки.

Команду **gbak.exe** можно выполнять из любого планировщика задач, например из MS Schedule+

Также резервное копирование можно выполнять приложением IBExpert.

### Резервное копирование баз данных в MS SQL

Операция может быть проделана из Enterprise Manager командой Backup Database.

![](data:image/png;base64...)

Предварительно из списка баз данных, отображаемых в Enterprise Manager, надо выбрать базу данных для копирования. Команда Backup Database открывает диалоговое окно SQL Server Backup.

![](data:image/png;base64...)

В окне, нажав кнопку Add надо выбрать/ввести имя файла, в котором будет сохранена копия базы данных. Следует помнить, что этот файл может быть размещён только на одном из жестких дисков сервера. Нет возможности создавать таким образом файл на сменных накопителях или на сетевых, по отношению к серверу дисках.

Рекомендуется установить флаг Overwrite existing media. В этом случае файл с копией базы будет создан заново, даже если такой файл уже есть. В противном случае (флаг Append to media) копия базы будет помещена в конец существующего файла и файл будет содержать несколько копий (иногда это полезно).

Рекомендуется делать копии баз данных ежедневно и хранить копии за несколько последних дней.

### Резервное копирование баз данных в ORACLE

Как известно в ORACLE не требуется резервное копирование, а используется технология хранения сегментов откатов. Тем не менее, для резервного копирования данных в ORACLE вполне подходит утилита expdb.

Пример:

expdp SYSDBA/masterkey@ORACLE\_BASE SCHEMAS =SPECTRE DUMPFILE =expdata.dmp.

Файл копии \*.dmp не содержит индексов и его размер сильно меньше файлов баз данных. Этот файл к тому-же очень хорошо сжимается любым архиватором. Поэтому, резервные копии не занимают много места.

### Резервное копирование баз данных в PostgreSQL

Резервное копирование выполняется консольной командами pg\_dump, pg\_dumpall или с помощью pgAdmin 4.

Пример:

pg\_dump -U postgres -N\_depo > d:\backup\pg\_depo.dmp

В примере использованы следующие опции:

-U postgres – вход в базу будет произведён с именем postgres;

-n depo – сохраняется схема depo базы данных по умолчанию;

> d:\backup\pg\_depo.dmp – путь и имя файла, куда сохраняется схема;

## Запуск приложения на многоядерном компьютере

На клиентской машине следует использовать клиентскую (не серверную) версию Windows любой разрядности (х86/х64).

Для ускорения работы на многоядерном компьютере, Fansy-приложение на клиентской машине надо запускать на одном ядре процессора, используя параметр «/affinity» при старте программы. Этим исключаются потери производительности при переключении приложения Fansy операционной системой между ядрами процессора. Для выбора оптимального режима работы программы можно предварительно, переключая приложение через диспетчер задач проверить скорость работы на разных ядрах. В Диспетчере задач нажать правой кнопкой мыши на Fansy приложении, задать соответствие и выбрать процессор.

Привязка к процессору в диспетчере задач:

![](data:image/png;base64...)

Пример запуска программы XXXXX только на третьем ядре (ЦП 2) из командной строки.

c:\windows\system32\cmd.exe /start /affinity4 XXXXX.exe

Для четырех ядерной машины: CPU0 - первое ядро;CPU1 - второе ядро;CPU2 - третье ядро;CPU4 - четвертое ядро.

| Значение ключа affinity | Приложение назначается на ядра |
| --- | --- |
| 1 | CPU0 |
| 2 | CPU1 |
| 3 | CPU0+CPU1 |
| 4 | CPU2 |
| 5 | CPU0+CPU2 |
| 6 | CPU1+CPU2 |
| 7 | CPU0+CPU1+CPU2 |
| 8 | CPU3 |
| 9 | CPU0+CPU3 |
| 0a | CPU1+CPU3 |
| 0b | CPU0+CPU1+CPU3 |
| 0c | CPU2+CPU3 |
| 0d | CPU0+CPU2+CPU3 |
| 0e | CPU1+CPU2+CPU3 |
| 0f | CPU0+CPU1+CPU2+CPU3 |

Буквы, начинающиеся в таблице с 0 - буквы английского алфавита a,b,c,d,e,f - всего лишь шестнадцатиричное представление чисел.

# Настройка программы

## Диалог при запуске и параметры приложения

Для весии x32 Windows. В диалоге Регистрация для базы "МетаДанные" указывается алиас "zzz\_META", а для базы "Данные" алиас "zzz\_DATA".

[Рисунок удалён: ID\_3]

Флаг "Использовать проверку подлинности Windows" (Windows Authentication) позволяет войти в базу данных без имени и пароля, если с именем входа связан пользователь Windows. При этом права на объекты базы данных предоставляются пользователю Windows, а не пользователю СУБД. Такая возможность работает только для СУБД MS SQL Server.

При запуске приложения можно передать в exe-файл следующие параметры: USER=<ИмяВхода>, PASS=<Пароль>, <Имя\_данных>=<АлиасБазыДанных>, OSAUTH=Y, COMPILE=Y, SQL=Y, FORCE\_ORDER=N, LOOP\_JOIN=N, AUTO=<Количество\_секунд>.

Пример:
<приложение>.exe USER=SYSDBA PASS=masterkey Данные=DEM\_DATE МетаДанные=DEM\_META

Параметр Данные=<АлиасБазыДанных> позволяет задать конкретную базу данных в ярлыке запуска приложения и таким образом сделать несколько ярлыков для каждой базы данных отдельно, например, для тестовой и боевой базы данных.

Параметр МетаДанные=<АлиасБазыМетаданных> позволяет задать конкретную базу метаданных в ярлыке запуска приложения и таким образом сделать несколько ярлыков для каждой базы метаданных отдельно, например, для работы (или тестирования) разных версий приложения.

Параметр USER=<ИмяВхода> позволяет задать имя входа (имя пользователя) в ярлыке запуска приложения.

Параметр PASS=<Пароль> позволяет задать пароль для имени входа. Это позволяет настроить ярлык запуска таким образом, чтобы пользователь сразу входил в приложение и в базу данных без лишних вопросов. При этом следует помнить о том, что хранить пароли открытым образом в ярлыках нехорошо.

Параметр SQL=Y включает режим диагностики выполнения SQL команд (аналогичный использованию меню Система->Режим SQL диагностики), который может подсказать причину ошибок, возникающих при входе в базы данных системы.

Параметр COMPILE=Y означает включение режима компиляции при загрузки кодов метафункций, что увеличивает скорость работы кодов программы.

Параметр FORCE\_ORDER=N означает отключение режима управления оптимизатором запросов, при котором сохраняется порядок соединения, заданный синтаксисом запроса (только в MS SQL и в Oracle; по умолчанию включён).

Параметр LOOP\_JOIN=N означает отключение режима построчного сопоставления внешней таблицы с внутренней в запросах (только в MS SQL и в Oracle; по умолчанию включён).

Параметр OSAUTH=Y включает режим авторизации пользователя через учетную запись в операционной системе (доменную авторизацию), при использовании заменяет пару USER и PASS.

Параметр AUTO=<Количество\_секунд> позволяет запустить автомат документооборота с интервалом опроса между циклами с определённым количеством секунд.

[Рисунок удалён: ID\_4]

С флагом "Единый пользователь для всех соединений" будет предлагаться войти в базу данных с подставленным по умолчанию именем того пользователя, которое использовалось для предыдущего входа в другую базу данных. Без флага будет сохраняться имя пользователя для каждой базы данных своё, отличное от имени входа в другую базу.

Флаг "Трассировка всех login-соединений" говорит о том, что не нужно приложению пытаться войти в новую базу с тем же именем и паролем, которые использовались для входа в предыдущую базу данного сеанса работы. Приложение будет всегда спрашивать имя и пароль, не пытаясь войти самостоятельно. Это полезно, когда с одного рабочего места приходится входить в разные базы; например, в тестовую и в боевую.

Для весии x64 Windows и Linux. В диалоге Регистрация для базы "МетаДанные" указывается алиас "zzz\_META", а для базы "Данные" алиас "zzz\_DATA".

[Рисунок удалён: ID\_5]

[Рисунок удалён: ID\_6]

Настройка алиасов проводится в окне, после нажатия на руку с пальцем [Рисунок удалён: ID\_7]

[Рисунок удалён: ID\_8]

Проверка подключения после ввода имени пользователя и пароля проводится нажатием на кнопку [Рисунок удалён: ID\_9]

[Рисунок удалён: ID\_10]

Параметры последнего входа в базу данных (алиасы, имя пользователя, флаги, кроме пароля), а также некоторые другие параметры приложения (местоположение и размеры окон, расположение кнопок панели инструментов и т.д.) сохраняются в системном реестре Windows по следующему пути:
HKEY\_CURRENT\_USER\Software\FANSY\<Наименование\_приложения>

## Настройка операционистов

### Уровни защиты данных

Система предоставляет три уровня защиты данных от несанкционированного доступа: 1) физический уровень прав  - уровень СУБД, 2) логический уровень  - правовой профиль пользователя (префикс пользователя, совокупность его рабочих мест, его ограничения на данные, флаг доступа к персональным двнным), проверяемый во время работы приложений и 3) математическое преобразование пароля доступа к СУБД. Вне зависимости от того, как расставлены физические права на таблицы, логический уровень прав на выборки проверяется всегда, и наоборот. Уровень математического преобразования пароля препятствует возможности входа в СУБД вне санкционированного приложения.

### Заведение нового пользователя

При заведении нового пользователя (операциониста) нужно использовать идентификатор и пароль, ранее заведенный пользователю в используемой СУБД. Длина идентификатора пользователя не должна превышать 24 символа. Запустите программу, войдя администратором (пользователь ADMIN). Откройте форму справочник операционистов и заведите учетную запись пользователя с таким же идентификатором. В базе метаданных заведите пользователей "SYSDBA", "ADMIN", "USER" или "GUEST". Все пользователи базы данных должны иметь стандартные префиксы в идентификаторе "SYSDBA\_", "ADMIN\_", "USER\_" или "GUEST\_", т.к. подключение к базе метаданных осуществляется по префиксу. Физические права, связанные с префиксами, описаны ниже.

Поле “Юридическое лицо фирмы” задает плоскость базы данных, доступную операционисту. Плоскость определяет автономный журнал документов и журналы проводок по каждому доступному плану счетов.

![](data:image/jpeg;base64...)

При наличии нескольких подразделений в компании и необходимости отличать документы подразделений по номеру следует заполнить поле «Код подразделения», тогда документы каждого из подразделений получат префикс в номере, соответствующий коду подразделения. Если для операциониста указан код подразделения, то видимость документов в журнале документов и операций для него будет ограничена документами, созданными в данном подразделении.

После заведения операциониста припишите ему «рабочие места», задающие права на документы и операции, и профили ограничений, задающие права на редактирование данных форм приложения. Администратор не имеет возможности вводить новые рабочие места и управлять их правами, эти настройки заданы разработчиками в метаданных приложения.

![](data:image/png;base64...)

Система администрирования прав на документы строится на основе механизма рабочих мест. Понятие «Рабочее место» является базовым понятием системы администрирования. По функциональному назначению, рабочее место можно сравнить с должностными обязанностями.

Например: «Бэк-офицер», «Бухгалтер», «Контролер», «Специалист» и др. Рабочее место определяет множество прав, необходимых для выполнения должностных обязанностей. Права определяют возможность создавать документ, видеть его в каждом состоянии, выполнять его директивы, определяющие бизнес логику его обработки.

Профили ограничений предназначены для ограничения таких способов доступа к данным, как: вставка, изменение, удаление, просмотр, фильтрация, импорт и экспорт. Реализована алгебра суммирования ограничений. С системой поставляются стандартные профили ограничений, доступные для выбора, а именно: 1) «Запрет на редактирование справочников субъектов, их счетов и кодов»; 2) «Запрет на редактирование справочников ценных бумаг и финансовых инструментов»; 3) «Запрет на редактирование курсов, котировок и индексов»; 4) «Запрет на редактирование параметров портфеля инвестора (опции, тарифы, показатели)». Для задания нестандартных ограничений предназначена форма «Ограничения прав пользователя на данные».

### Права для работы с документами и формами

#### Рабочие места пользователя (роли)

После заведения операциониста припишите ему «рабочие места», задающие права на документы и операции, и профили ограничений, задающие права на редактирование данных форм приложения.

![](data:image/png;base64...)

Система администрирования прав на документы строится на основе механизма рабочих мест. Понятие «Рабочее место» является базовым понятием системы администрирования. По функциональному назначению, рабочее место можно сравнить с должностными обязанностями. Например: Оператор, Бухгалтер, Контролер, Специалист и др. Рабочее место определяет множество прав, необходимых для выполнения должностных обязанностей. Права определяют возможность создавать документ, видеть его в каждом состоянии, выполнять его директивы, определяющие бизнес логику его обработки.

#### Параметры учетной записи пользователя

На закладке «Сведения» задаются следующие параметры учетной записи пользователя: период активации, дата блокировки, максимальное количество дней неактивности, дата входа/выхода из базы данных, данные для мониторинга действия пользователя, параметры SMTP и PROXY – серверов.

![](data:image/png;base64...)

Временная учетная запись (запись с ограниченных периодом использования) может быть заведена для пользователя для выполнения задач ограниченных ограниченных по сроку, требующихся для проведения настройки или тестирования информационной системы, для организации гостевого доступа (посетителям, сотрудникам сторонних организаций, стажерам и иным пользователям с временным доступом к информационной системе). Система осуществляет автоматическое блокирование временных учетных записей пользователей по окончании установленного периода времени для их использования.

Мониторинг транзакций пользователя включает в себя фиксация следующих действий.

* Открытие форм приложения
* Вход и выход из БД приложения – все входы и выходы в базу данных, в том числе неудачные и фиксация не допуска заблокированных пользователей на входе.
* Вставка, изменение, удаление данных в формах
* Вызов отчетов
* Экспорт и импорт данных
* Активация HASP – активируется резервный временный ключ, который хотят использовать вместо утраченного ключа.
* Регистрация документов – действия, связанные с регистрацией документов (директивы регистрации и возврата на редактирование).
* Обработка документов – действия, связанные с созданием и обработкой документов и операций (директивы не связанные с регистрацией и отправкой документов в архив).
* Архивация документов – выполнение директивы для отправки в архив.
* Настройка – добавления/изменения в справочнике операционистов; изменение состава рабочих мест.

Если текущая дата не входит в период действия учетной записи, если дата текущая дата больше чем заданная дата блокировки, если с последней даты вхождения пользователя в БД прошло более чем указанное количество дней неактивности, то осуществляться автоматическое блокирование таких записей пользователей и вход таких пользователей в БД – невозможен.

Оповещение администратора, осуществляющего управление учетными записями пользователей, об изменении сведений о пользователях, их ролях, обязанностях, полномочиях, и ограничениях осуществляется настройками на закладке «События оповещения».

#### События оповещения

События оповещения предназаначены для информирования на e-mail различного рода админиcтраторов о важных событиях в системе. Примеры важных событий:

1. Котировки ценных бумаг загружены
2. Отчеты инвесторам по брокерским договорам сформированы
3. Изменении сведений о пользователе в справочнике операционистов
4. Изменении сведений о пользователе в справочнике операционистов
5. Изменение ограничений пользователя в справочнике операционистов
6. Изменение событий оповещения пользователя в справочнике операционистов

#### Профили ограничений

Профили ограничений предназначены для ограничения таких способов доступа к данным, как: вставка, изменение, удаление, просмотр, фильтрация, импорт и экспорт. Реализована алгебра суммирования ограничений. С системой поставляются стандартные профили ограничений, доступные для выбора, а именно: 1) «Запрет на редактирование справочников субъектов, их счетов и кодов»; 2) «Запрет на редактирование справочников ценных бумаг и финансовых инструментов»; 3) «Запрет на редактирование курсов, котировок и индексов»; 4) «Запрет на редактирование параметров портфеля инвестора (опции, тарифы, показатели)». Для задания нестандартных ограничений предназначена форма «Ограничения прав пользователя на данные».

#### Сертификат пользователя для ЭЦП

Закладка «Сертификаты» предназначена для установки индивидуальной электронной подписи пользователем в момент создания исходящего сообщения при использовании ЭДО.

![](data:image/jpeg;base64...)

Для выбора сертификата нажмите кнопку «Идентификатор».

В качестве списка получателей открываются лица, перечисленные в списке получателей в настроечной форме «Настройка исходящих сообщений».

#### Математическое преобразование пароля пользователя

Для препятствия проникновения в базу данных иными средствами, система позволяет осуществлять математическое преобразование (шифрование) паролей пользователей.

![](data:image/png;base64...)

На закладке «Сведения» можно указать на шифрование пароля к базе данных для конкретного пользователя и о необходимости мониторинга его действий (транзакций).

Флаг «Шифрование пароля» позволяет добиться того, что пароль, который пользователь вводит в приложении будет отличаться от пароля пользователя в базе данных, что приведет к невозможности входа пользователя в базу данных иными средствами нежели чем приложение. Кнопка "Сменить пароль" позволяет изменить пароль уже существующему пользователю приложения. Если для пользователя установлено требование шифрования пароля, то при входе в приложение он должен указывать не реальный пароль к базе данных а, математически преобразованный.

После установки реквизита «Мониторинг транзакций» все отмеченные действия пользователя по входу в БД, открытию форм, выходу из БД, вызову отчетов, вставке, изменению, удалению, импорту и экспорту данных фиксируются в системе. Для администратора приложения реализована форма «Мониторинг транзакций», в которой можно увидеть все транзакции пользователей.

#### Защита доступа к персональным данным

В соответствии с Федеральным законом от 27.07.2006 N 152-ФЗ "О персональных данных", при обработке персональных данных необходимо принять меры для защиты персональных данных от неправомерного доступа, уничтожения, изменения, блокирования, копирования, предоставления и распространения.

Система Fansy хранит персональные данные с использованием системы управления базами данных (СУБД). В качестве СУБД может быть использована одна из сертифицированных Федеральной службой по техническому и экспортному контролю (ФСТЭК) систем: 1) Microsoft SQL Server 2005 Standard Edition и Enterprise Edition; 2) Oracle Database 11g Release 2 Enterprise Edition или 3) [Ред База Данных 2.5](http://www.red-soft.biz/downloads.php?file=1026) (сертифицированная версия СУБД FireBird). Выданные сертификаты свидетельствует о том, что вышеуказанные СУБД имеет оценочный уровень доверия ОУД 1 (усиленный) и могут использоваться для создания автоматизированных систем для класса защищенности 1Г включительно и в ИСПДН до 2 класса. Помимо защищенного хранилища информационная система "FANSY" имеет разграничение прав на доступ к персональным данным для каждого пользователя системы и подсистему мониторинга над событиями доступа к персональным данным, что обеспечивает их защищенное хранение и контролируемое использование.

Для ограничения доступа к персональным данным на закладке «Сведения» можно задать флаг «Запретить доступ к персональным данным», что приведет к невозможности просмотра, изменения, выгрузки и удаления данных из справочника физических лиц, и документа «Анкета физического лица».

Для обеспечения регистрации и учета всех действий, совершаемых с персональными данными в информационной системе тех операторов, для которых разрешен доступ к персональным данным, необходимо установить в реквизите «мониторинг транзакций» соответствующие флаги. Таким образом, можно автоматизировано отслеживать как доступ уполномоченных операционистов к персональным данным (просмотр, изменение, выгрузка, удаление), так и изменения полномочий оператора по доступу к персональным данным, содержащимся в информационной системе.

#### Мониторинг транзакций пользователя

Если для пользователя установлен реквизит «Мониторинг транзакций», то все отмеченные действия пользователя по входу в БД, открытию форм, выходу из БД, вызову отчетов, вставке, изменению и удалению данных, импорту и экспорту данных фиксируются в системе. Для администратора приложения реализована форма «Мониторинг транзакций», в которой можно увидеть все транзакции пользователей. Только администратору приложения доступна возможность удаления записей системы мониторинга из базы данных.

![](data:image/jpeg;base64...)

Для действий по входу в БД, выходу из БД (CONNECT, DISCONNECT) в мониторинге фиксируются драйвер доступа к СУБД, наименование БД и параметры соединения.

Для действий по вызову отчетов в мониторинге фиксируются сведения об отчете и его параметрах запуска.

Для действий по вставке, изменению и удалению данных фиксируются старые и новые значения всех полей выборки данных. На закладке «Ординарные поля» выведен список значений всех ординарных полей выборки, а на закладке «Мемо-поля» значения мемо-полей выборки.

На закладке «Анализ активности» выводится диаграмма активности пользователей приложений по изменению база данных.

#### Права пользователя на документы

Каждый операционист (пользователь системы) должен иметь предписанные ему рабочие места. Комбинируя множество рабочих мест операционистов, возможна точная настройка прав пользователей на документы. Права предписываются категориям документов (возможность завести), состояниям (возможность смотреть, изменять и удалять) и директивам (возможность выполнять). Системная “алгебра прав” реализует функцию суммирования правовых профилей.

|  |  |  |
| --- | --- | --- |
| Наименование правового  профиля рабочего места | Рекомендуемый  префикс | Комментарий |
| АВТОМАТ и ВСЕ ПОЛЬЗОВАТЕЛИ |  | Права на обработку приема сообщений операции «Входящее сообщение» |
|  | SYSDBA | Максимальные права на все объекты и действия приложения. Отсутствие проверки прав. |
| БЭК-ОФИС | USER | Права на обработку директив любых документов, кроме директивы «Подтверждение», права на которую имеет «КОРРЕКТОР». Права на создание любых документов, кроме тех которые предписаны рабочему месту «ФРОНТ-ОФИС» и «СПЕЦИАЛИСТ». |
| БУХГАЛТЕРИЯ | USER | Права на создание и обработку документов группы «Бухгалтерские операции»: «Банковская выписка», «Бухгалтерская справка», «Изменение балансовой позиции учета ценной бумаги», «Изменение остатков средств страховой компании», «Мемориальный ордер», «Перевод валютных корректировок в рубли», «Платежное поручение», «Расчёт тарифов и услуг».  Права на создание документов «Прочие операции с ДС», «Счет», «Счет-фактура», «Активы, в которые инвестировано имущество фонда (ипотечного покрытия)»,  «Перечень операций с денежными средствами, совершённых организацией», «Формирование операций зачисления доходов (погашений) по долговым ЦБ», «Перевод ДС», «Выделение НДС с реализации имущества по акту приема-передачи».  Права группы «Прочие операции с имуществом».  Права на создание и обработку документов группы «Стандартные расчеты». |
| ДЕПОЗИТАРИЙ | USER | Правка на создание и обработку документов «Межбалансовый Перевод ЦБ», «Перевод ЦБ». |
| КОРРЕКТОР | USER | Разрешено редактирование всех документов во всех состояниях, но просмотр разрешен только для документов находящихся в состоянии «На контроле» и «Начальный ввод». Данный набор прав предусматривает возможность редактирования и регистрации документов, при включенном системном режиме «Двойной контроль ввода» на форме «Системные установки». |
| НАЛОГОВИК | USER | Права на создание и обработку документов: «Формирование операций "Расчет НДФЛ" по окончанию налогового периода», «Расчет НДФЛ», «Расчет НДФЛ участников РКИ», «Формирование операций "Зачисление дивидендов/доходов по долевым ценным бумагам"», «Ввод данных об НДФЛ инвестора из внешних подразделений налогового агента», «Начисление земельного налога», «Начисление амортизации имущества «Начисление и оплата налогов», «Начисление налога на имущество». |
| ОПЕРАТОР ТОРГОВЫХ ПОРУЧЕНИЙ | USER | Права на создание и обработку документов «Поручение на сделку купли-продажи» |
| ОПЕРАТОР НЕТОРГОВЫХ ПОРУЧЕНИЙ | USER | Права на создание и обработку документов: Поручение на операцию (приказ, распоряжение) |
| ПОЛЬЗОВАТЕЛЬ | USER | Права на создание и обработку документов «Служебная записка», «Хранимые отчёты». |
| РЕВИЗОР | USER | Разрешен просмотр всех документов в любых состояниях, включая документы в состоянии «Начальный ввод». Данный набор прав не предусматривает возможность ввода, обработки, редактирования и удаления документов. |
| ТОРГОВЫЙ ОТДЕЛ | USER | Права на создание и обработку документов: «Реестр сделок фондового рынка», «Универсальная сделка», «Процентный своп», « Реестр сделок товарного рынка», «Конвертация валюты и сделки с биржевыми драгоценными металлами» |
| ФРОНТ-ОФИС | USER | Права на создание и просмотр документов группы «Договоры и документы», а именно: «Договор с клиентом (портфель)», «Генеральное соглашение о совершении сделок», «Договор аренды», «Договор денежного займа», «Договор депозитного вклада», «Договор займа ценных бумаг», «Договор кредитной линии», «Договор о начислении процентов на остаток по расчетному счету», «Договор об оказании услуг/выполнении работ», «Договор с агентством недвижимости», «Договор с агентством по приобретению кредитных договоров» , «Договор/полис страхования имущества».  Права на создание и просмотр документов группы «Документы РКИ» , а именно: «Анкета физического лица», «Анкета юридического лица», «Договор с агентом», «Запрос на предоставление информации», «Заявка пайщика», «Заявление на закрытие лицевого счета», «Заявление на изменение реквизитов зарегистрированного/уполномоченного лица», «Заявление на открытие лицевого счета».  Права на создание и просмотр документов «Запись в журнале регистрации документов».  Следует отметить, что права на обработку этих документов принадлежат так же рабочему месту «БЭК-ОФИС». |
| КОНТРОЛЕР  Рабочее место отдела контроля. | USER | Права на создание и обработку документов группы «Акты сверки», «Запрос на согласие специализированного депозитария», «Согласие/отказ специализированного депозитария на проведение операции», «Уведомления о нарушении / устранении нарушения», «Нарушение состава и структуры имущества» |
| СПЕЦИАЛИСТ | ADMIN | Права на создание и обработку документов группы «Системные классификаторы»: «Номера счетов Депо владельцев во внешних депозитариях в привязке к портфелям», «Опции ядра системы», «Соответствия юр.лиц справочнику Банка России (форма 0420415 и другие)».  Предоставлены права на удаление любых документов, изменение конфиденциальности любых документов, и выполнению директив «вернуть на редактирование». Данный набор прав не предусматривает возможность ввода и просмотра документов. Рабочее место "СПЕЦИАЛИСТ" позволяет выполнять опасные для учета функции по удалению результатов обработки документов и самих документов. |
| ОПЕРАТОР ВХОДЯЩИХ И ИСХОДЯЩИХ СООБЩЕНИЙ | USER | Рабочее место оператора приема/отправки входящих и исходящих сообщений. Права на создание и обработку документов группы «Почта», «Операции общего назначения» |

Сочетание рабочих мест “СПЕЦИАЛИСТ” и “РЕВИЗОР” позволяет получить весомый набор прав (просмотр, удаление, изменение), но не позволяет вводить новые документы. Максимальный набор прав получается при сочетании всех рабочих мест.

#### Права пользователя на приложение

Помимо прав на документы обеспечивается логический и физический уровни защиты данных от несанкционированного доступа. Логических уровней два:

1. профиль прав на формы, меню и кнопки, задаваемый префиксом логина;
2. профиль ограничений на данные, задаваемый в справочнике операционистов.

Профили ограничений предназначены для ограничения таких способов доступа к данным, как: вставка, изменение, удаление, просмотр, фильтрация, импорт и экспорт. Эти ограничений действуют только на формах, на которые пользователь имеет права в соответствии с первым профилем.

Уровень защиты прав на формы, меню и кнопки приложения зависит от префикса (идентификатора) операциониста: идентификатор 'SYSDBA' задает неограниченные права, префикс ‘ADMIN’ - максимальные права (возможность просмотра и редактирования всех форм, кроме документов), префикс ‘USER’ - нормальные (просмотр всех форм за исключением администраторских, редактирование разрешенных форм), префикс ‘GUEST’ - минимальные (просмотр некоторых форм приложения, редактирование запрещено). От префикса операциониста зависит также состав форм, инструментальной панели и меню приложения и возможность изменять данные приложения.

Следует отметить, что пользователь 'SYSDBA' (без префикса) является так называемым владельцем (в некоторых СУБД - DBO) объектов баз данных приложения. Поэтому скрипты на изменения структуры баз данных должны обрабатываться именно от лица этого пользователя. Пользователю 'SYSDBA' (без префикса) также даны права на изменения объектов базы метаданных. Поэтому системные сообщения на изменение наполнения метаданных следует принимать именно от лица этого пользователя.

Следует отличать пользователя 'SYSDBA' (без префикса) от пользователей 'SYSDBA\_...' (c префикса). И тот и другой имеют неограниченные права на объекты приложения, то только первый имеет права на изменения структуры баз данных и на изменения наполнения базы метаданных.

#### Права группы ‘ADMIN’

Запреты пользователя на данные приложения для группы ‘ADMIN’

|  |  |  |  |  |
| --- | --- | --- | --- | --- |
| Наименование выборки | Изменения | Добавления | Удаления | Просмотр |
| Журнал директив | Запрещены | Запрещены | Запрещены | Разрешен |
| Планы счетов | Запрещены | Запрещены | Запрещены | Разрешен |
| Системные установки | Разрешены | Запрещены | Запрещены | Разрешен |
| Справочник проводок по документу | Разрешен | Разрешен | Разрешен | Разрешен |
| Стандартные операции | Запрещены | Разрешены | Запрещены | Разрешен |
| Структура аналитического регистра | Запрещены | Запрещены | Запрещены | Разрешен |
| Структура плана счетов | Запрещены | Запрещены | Запрещены | Разрешен |

#### Права группы ‘USER’

Запреты пользователя на формы приложения для группы ‘USER’

|  |  |
| --- | --- |
| Форма приложения | Право на открытие |
| Репликация объектов из внешней базы данных | Запрещено |
| Настройка базы 'Данные' | Запрещено |
| Справочник операционистов | Запрещено |
| Справочник подразделений (штатное расписание) | Запрещено |
| Опорные точки | Запрещено |
| История юридического лица | Запрещено |
| История физического лица | Запрещено |
| История субъекта | Запрещено |

Права пользователя на данные приложения для группы ‘USER’

|  |  |  |  |  |
| --- | --- | --- | --- | --- |
| Наименование выборки | Изменения | Добавления | Удаления | Просмотр |
| Даты переоценок | Запрещены | Запрещены | Запрещены | Разрешен |
| Журнал директив | Запрещены | Запрещены | Запрещены | Разрешен |
| Оборотная ведомость | Запрещены | Запрещены | Запрещены | Разрешен |
| Операторы | Запрещены | Запрещены | Запрещены | Разрешен |
| Опорные точки | Запрещены | Запрещены | Запрещены | Разрешен |
| Остатки лицевых счетов на дату | Запрещены | Запрещены | Запрещены | Разрешен |
| Проводки | Запрещены | Запрещены | Запрещены | Разрешен |
| Системные установки | Запрещены | Запрещены | Запрещены | Разрешен |
| Совокупные права пользователя | Запрещены | Запрещены | Запрещены | Разрешен |
| Справочник государств | Запрещены | Запрещены | Запрещены | Разрешен |
| Стандартные операции | Запрещены | Запрещены | Запрещены | Разрешен |
| Текущие остатки лицевых счетов | Запрещены | Запрещены | Запрещены | Разрешен |
| Установки программы | Запрещены | Запрещены | Запрещены | Разрешен |

#### Права группы ‘GUEST’

Запреты пользователя на формы приложения для группы ‘GUEST’

|  |  |
| --- | --- |
| Форма приложения | Право на открытие |
| Справочник удаленных абонентов | Запрещено |
| Классификатор количественного учета | Запрещено |
| Контрагенты и их клиенты | Запрещено |
| Мониторинг важных событий по сделкам | Запрещено |
| Активы бэк-офиса | Запрещено |
| Портфель инвестора | Запрещено |
| Отчёты ФКЦБ | Запрещено |
| Журнал операций (Проводки) | Запрещено |
| Журнал директив | Запрещено |
| Оборотная ведомость в разрезе аналитики | Запрещено |
| Средневзвешенные остатки в разрезе аналитики | Запрещено |
| Остатки в разрезе аналитики | Запрещено |
| Репликация объектов из внешней базы данных | Запрещено |
| Настройка базы 'Данные' | Запрещено |
| Календарь выходных и праздничных дней | Запрещено |
| Справочник подразделений (штатное расписание) | Запрещено |
| Справочник операционистов | Запрещено |
| Опорные точки | Запрещено |
| История юридического лица | Запрещено |
| История физического лица | Запрещено |
| История субъекта | Запрещено |

Права пользователя на данные приложения для группы ‘GUEST’

|  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Наименование выборки | | Изменения | Добавления | | | Удаления | **Просмотр** | | |
| Остатки ЦБ в торговой системе | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Мониторинг должных поставок | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Книга учёта ценных бумаг | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Активы бэк-офиса (ЦБ) | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Активы бэк-офиса (ЦБ по инвесторам) | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Оборотная ведомость по бумагам | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Верхняя часть документа Счёт/Счёт-фактура | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Строки счёта | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Спецификация комплексной сделки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Договор с инвестором | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Сделка биржевого рынка | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Сделка внебиржевого рынка | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Поручение на сделку | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Средства инвестора | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| ДС инвестора на счетах | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Встречные поручения | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Портфель инвестора | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Реестр сделок | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Реестр сделок (заголовок) | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Тикет биржевого рынка | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Тикет сложной сделки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Тикет внебиржевого рынка | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Заявка пайщика | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Пайщики | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Операции по заявке с пайщиком | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Приём сообщений из директории | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Верхняя часть выписки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Запись в журнале регистрации документов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Карточка документа 'Входящее сообщение' | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Документ: Служебная записка | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Распоряжение на внесение записи в реестр | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник кодов инвесторов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Разделы плана счетов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Список аффилированных лиц субъекта | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Классификатор количественного учета | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник выпусков акций | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Структура плана счетов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Реквизиты банков | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Узлы баз данных | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник ипотечных сертификатов участия | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Календарь выходных и праздничных дней | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Цепочки хранения | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Счета ЛОРО/НОСТРО в цепочке | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник переоцениваемых констант | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Купоны/аннуитеты | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник видов валют | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Подразделения фирмы | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Сотрудники подразделения фирмы | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Журнал директив | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Сведения об объявденных дивидендах | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Категории документов (дерево) | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Реквизиты входящего документа | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Реквизиты исходящего документа | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| ЖУРНАЛ ДОКУМЕНТОВ | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Свойства документа | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Опорные точки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник банковских сертификатов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Выписка по лицевому счёту | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник счетов субъекта во внешних хранилищах | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник Субъектов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Мониторинг доверенных лиц на просрочку полномочий | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Тикеры субъектов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник Физических лиц | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник фьючерсов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник имущества | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Оценочная стоимость товаров (имущества) | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| История оценочных стоимостей товаров (имуществ) | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник показателей инвестиционной декларации | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Выборка OD\_INTERVAL | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Спецификации интервальных процентов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Примечание к документу | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Настройка исходящих сообщений | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Сетрификаты операциониста | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник котировок | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Операторы | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Начальники сотрудника | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Подчиненные сотрудника | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Документы операциониста | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Рабочие места операциониста | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Системные установки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник облигаций | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Планы счетов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Опорные точки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник паев инвестиционных фондов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник шкал рейтинговых агенств | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| История котировок (курсов) | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Структура аналитического регистра | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Аналитические регистры | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Лицевые счета | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Точки фиксации переоценок | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Оборотная ведомость | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Управление конфиденциальностью | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Установки программы | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Реквизиты фондов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник всех ценных бумаг | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Опции ценных бумаг | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Тикеры ценных бумаг | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Рейтинг ЦБ | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| История котировок | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Признаки проводки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Стандартные операции | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Опорные точки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Опорные точки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Параметры расчетных схем тарифов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник типов расчетов тарифов и услуг | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Параметры расчетных схем тарифов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Список доверенных лиц субъекта | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник опционов | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник Юридических лиц | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник уставных капиталов ООО | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Пользовательский рубрикатор | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Виды деятельности субъекта | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Совокупные права пользователя | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник векселей | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Проводки | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник проводок по документу | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Права рабочих мест | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник депозитарных расписок | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Справочник закладных | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Обработка стандартных операций | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Поля стандартных операций | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| События стандартных операций | Запрещены | | Запрещены | Запрещены | | | Разрешен |
| Cтандартные операции | Запрещены | | Запрещены | Запрещены | | | Разрешен |

## Системные параметры

Форма с системными параметрами доступна из меню «Вид -> Параметры».

[Рисунок удалён: ID\_11]

Флаг «Блокировать перерасчет прибыли» используется для блокировки трудоемкого алгоритма перерасчета прибыли/убытков при массовой проводки сделок задним числом. После окончания необходимых изменений для восстановления целостности данных снимите указанный флаг и вызовите принудительный перерасчет ( форма Системные установки -> закладка “Расчеты” -> кнопка “Перерасчет средневзвешенных”).

Для функционирования генераторов отчетов требуется указание в параметрах приложения путей до соответствующих директорий (меню: Вид / Параметры...).

[Рисунок удалён: ID\_12]

Для отправки данных по электронной почте (Выписок, Отчётов, Справок и др.) необходимо настроить параметры Вашего SMTP-сервера на закладке «Настройки SMTP».

[Рисунок удалён: ID\_13]

## Системные установки

При входе в систему, пользователь видит форму с установками, предписанными ему администратором.

[Рисунок удалён: ID\_14]

Изменить системные установки может только администратор системы. При изменении метода расчета себестоимости система пересчитает себестоимость вложений за текущий год.

Система использует 3 метода учета себестоимости портфеля компании: возможен расчет по методу среднего, ЛИФО и ФИФО.

«Дата защиты проводок» и «Дата защиты документов» предназначены для ограничения возможности изменения и правки проводок и архивных документов и вставки новых документов с датой (временем) более ранней, чем указанная в поле. Дата защиты документов также защищает от импорта котировок, курсов и оценок ранней датой.

Флаг «Запретить красное сальдо?» устанавливается для автоматической фиксации красного сальдо на текущих остатках лицевых счетов. Если флаг установлен, система не позволит сделать некорректную проводку. Если флаг не установлен, факт красного сальдо будет помечен в соответствующих журналах красным цветом (формы «Баланс», «Журнал проводок» и т.д.). Флаг «Запретить красное сторно?» делает невозможным ввод проводок с отрицательной суммой.

[Рисунок удалён: ID\_15]

Закладка "Реквизиты" позволяет указать должность и ФИО лица, подпись которого будет присутствовать на выводимых системой отчетах.

[Рисунок удалён: ID\_16]

Закладка «Котировки ФВ» (финансовых вложений) позволяет выбрать общий способ взятия котировок для оценки портфелей и структуры финансовых вложений инвесторов отдельно для долевых и долговых (прочих) финансовых инструментов. Для отдельных портфелей способ может быть задан непосредственно в договоре с клиентом. Предусмотрены различные способы вычисления котировок:

|  |
| --- |
| Рыночная 3 [90 дней], Рыночная [90] |
| Рыночная 3 [90 дней], Рыночная [90], Номинал |
| Рыночная 3 [90 дней], Рыночная [90], Оценка [полгода] |
| Рыночная 3 [предыдущая], Рыночная [предыдущая], Спрос [180 дней] |
| Рыночная 3, Рыночная, Средневзвешенная, Спрос |
| Средневзвешенная [15 дней], Спрос [15] |
| Цена закрытия [30 дней], Спрос [30], Средневзвешенная [30], Оценка [полгода] |
| Рыночная 2 (ПФР) [30 дней], Цена закрытия [30], Оценка [полгода] |
| Признаваемая (ПИФ) [предыдущая], Оценка [предыдущая] |
| Оценка [предыдущая] |
| Номинал |

Значения в скобках означают период за который просматриваются рыночные показатели от запрашиваемой даты. Если не указаны, значит рыночные показатели ищутся на один ближайший рабочий день. Если указано [предыдущая], значит поиск ведётся на все дни до начала деятельности.

На закладке "Документы" флаг "Множественный журнал?" позволяет иметь открытыми несколько экземпляров формы "ЖУРНАЛ ДОКУМЕНТОВ и ОПЕРАЦИЙ" (при снятом флаге повторное открытие формы приводит к активации ранее открытого экземпляра формы). Таким образом, можно держать открытыми журналы различных категорий документов.

[Рисунок удалён: ID\_17]

Предусмотрены следующие способы генерации проводок по документам:

1. текущая дата – все проводки порождаются на текущую дату;
2. дата из поля документа иначе текущая дата – все проводки порождаются на дату, указанную в поле документу (если такое поле есть), иначе на текущую дату;
3. дата из поля документа, иначе дата документа – проводки порождаются на дату указанную в поле документу (если такое поле есть, например: дата документа подтверждающего оплату, перерегистрацию и т.д.), иначе на дату самого документа.

Поле "Нумерация" задаёт правила получения номера для новых документов. Нумерация может быть "непрерывная" или "в течении дня". При непрерывной нумерации новым документам предлагается номер по умолчанию цифровой, следующий за последним введённым. При нумерации "в течении дня" номера документов представляют собой пару – дата документа и его порядковый номер за этот день.

Флаг «Двойной контроль ввода» активирует рабочее место «КОРРЕКТОР», когда каждый документ проходит контроль и, возможно, редактирование со стороны оператора-корректора.

Флаг «Контроль XML корректности структуры сообщений» включает/выключает режим проверки перед приёмом различных XML по XSD схемам.

[Рисунок удалён: ID\_18]

Для отображения в отчетах эмблемы Вашей фирмы надо указать имя файла с соответствующей картинкой. Имя указывается в поле "Файл с эмблемой фирмы" (на закладке "Эмблема"). Если путь к файлу не указан, то файл ищется в директории с отчетами (рекомендуется не указывать пути, а файл с эмблемой держать в этой директории).

Эмблема должна представлять собой картинку \*.png, \*.jpg или любого другого формата, поддерживаемого интернет проводниками и приложениями MS Office. Она будет автоматически внедряться в отчеты (MS Word и MS Excel) в левый верхний угол.

ВНИМАНИЕ: если эмблема горизонтальная, то желательно, чтобы её ширина была не более чем в два раза больше высоты! Отчёты сформатированы таким образом, что, если эмблема окажется слишком широкой (относительно высоты), то она будет наползать на текст отчёта. Если же высота эмблемы действительно слишком малая (относительно ширины), то её следует дополнить пустыми полями сверху/снизу таким образом, чтобы высота была как минимум вдвое меньше ширины. Если высота больше, то ничего страшного: можно иметь как квадратную эмблему, так и вертикальную.

Для каждого юридического лица, работающего с базой данных (для каждой учётной плоскости), может быть задана своя эмблема.

## Настройка базы данных

Форма “Настройка Базы Данных” позволяет администратору SYSDBA ввести новую учетную “плоскость” (для организации учета операций другой компании) в той же самой базе данных, удалить учетную плоскость, провести архивацию документов и проводок, а также выбрать национальную валюту учета операций. Первоначальная настройка учетной плоскости производилась разработчиками при генерации базы данных.

### Введение новых учетных плоскостей

Для заведения новой плоскости задайте субъекта, от имени которого предполагается вести учет. Возможен выбор как юридического, так и физического лица.

Плоскость создается нажатием кнопки “Завести”. Каждая плоскость будет иметь свою собственную копию планов счетов, системных установок, почтовых настроек и тарифных планов. Количество учетных плоскостей не ограничено.

[Рисунок удалён: ID\_19]

После заведения новой плоскости не забудьте настроить операционистов, для работы с новой учетной плоскостью. Каждому операционисту в системе соответствует одна учетная плоскость.

### Удаление учетных плоскостей

Любую из созданных плоскостей, кроме текущей можно удалить. Предварительно удалите в ней все проводки и документы. Плоскость создается нажатием кнопки “Удалить”.

[Рисунок удалён: ID\_20]

### Изменение национальной валюты

Изменение национальной валюты влияет на все учетные плоскости и влечет за собой полное удаление проводок и лицевых счетов. Эту операцию следует выполнять над чистой базой данных, сразу вслед за инсталляцией системы.

[Рисунок удалён: ID\_21]

### Удаление документов, котировок и проводок

Практически для всех категорий СУБД, за исключением разве что ORACLE, возрастающее количество объектов в базе данных значительно снижает производительность работы сервера.

Для существенного увеличения производительности работы базы данных предлагается механизм удаления данных (документов, котировок и проводок), относящимся к прошедшим отчетным периодам, при этом доступ к этим данным в текущем экземпляре базы будет утерян, но возможен в архивной копии базы данных. Перед проведением удаления данных всегда следует сделать архивную копию базы ZZZ\_SP\_DATA.

Удаление следует проводить после окончания отчетного периода или до начала любого закрытого отчетного периода.

Для текущего экземпляра базы данных следует выбрать учетную плоскость и указать дату, до которой следует удалять документы. При нажатии кнопки ‘Удалить документы’ будут удалены те документы данной плоскости, которые попали в состояние архив до указанный даты и для которых нет связанных документов, не попавших в архив. Проводки, связанные с удаляемыми документами будут отвязаны и сохранены в системе. При этом теряется возможность анализа балансовых позиций по Т-аналитике, зависимой от удаленных документов (сделки, контрагенты, торговые системы).

Сжатие проводок проводится для каждого плана счетов данной выбранной плоскости отдельно. При нажатии кнопки ‘Сжать проводки’, все проводки данного плана счетов до указанной даты будут сгруппированы по счетам и оставшимся признакам и заменены на результирующие на указанную дату. Проводки по счетам учета методами ЛИФО-ФИФО не сжимаются.

Внимание пользователей приложений, опирающихся на бухгалтерское ядро FANSY! Если до указанной даты сжатия проводок приобретались ЦБ, и они еще не были списаны по методу FIFO, то некоторые расчетные показатели для бухгалтерских портфелей могут быть потеряны. Для целей безопасного сжатия проводок реализовано действие "Расчет минимальной даты сжатия проводок", которая проанализирует все портфели и выдаст минимальную безопасную дату.

[Рисунок удалён: ID\_22]

Удаление устаревших котировок, в общем случае, безопасно, и может привести к существенному увеличению производительности системы в вопросах, связанных с получением чистых активов и оценки финансовых вложений.

Все три алгоритма удаления/сжатия требуют существенного времени для выполнения. Для повышения производительности при их выполнении производится отключение системных триггеров базы данных. Если по каким либо причинам работа каждого из алгоритмов была прервана, или вы перезагрузили приложение, не дождавшись результата выполнения, то дальнейшее нормальное функционирование системы будет не возможно. Поэтому, в этих случаях, следует перезапустить приложение, открыть форму «Настройка базы данных» и нажать кнопку «Восстановление триггеров БД», после чего нормальное функционирование системы будет восстановлено.

## Чистка базы данных

Форма “Чистка Базы Данных” позволяет администратору SYSDBA реализовать процедуру группового удаления объектов базы данных. Объекты сгруппированы по 3-м критериям: "непрофильные объект" - объекты не соответствующие профилю приложения, но принадлежащие текущей плоскости; чужие объекты - объекты соответствующие профилю приложения, но не принадлежащие текущей плоскости; "наши объекты" - объекты соответствующие профилю приложения и принадлежащие текущей плоскости.

[Рисунок удалён: ID\_23]

Чистка директив документов позволяет удалить из базы данных директивы, выполнение которых закончилось с ошибкой.

Чистка результатов мониторинга удаляет все записи системы мониторинга за транзакциями пользователей. Эта операция позволяет существенно сократить объем базы данных.

Чистка счетов депо, ценных бумаг, цепочек хранения, счетов субъектов, субъектов и операционистов позволяет удалить только те объекты, на которые не ссылаются другие объекты. Такое удаление является безопасным с точки зрения сохранения целостности данных. Безопасное удаление объектов защищено правилами ссылочной целостности СУБД, т.е. объект не будет удален, если на него есть хотя бы одна ссылка из других таблиц базы данных.

[Рисунок удалён: ID\_24]

К опасным удалениям относятся удаление проводок, отчетов, остатков и документов. Удаление проводок реализовано с предварительной отвязкой от документов. После проведения данной операции остатки и документы будут содержать неверные сведения, поэтому рекомендуется дальнейшее удаление остатков и документов.

Чистка экземпляров субъектов позволяет удалить информацию об изменение реквизитов субъектов, сохранив последние значения реквизитов в качестве единственных. При этом может быть удалена существенна информация о субъекте, например данные о предыдущей фамилии и т.п.

[Рисунок удалён: ID\_25]

Чистка курсов валют, котировок ценных бумаг, оценок имущества и значений финансовых показателей требует введения даты предельной чистки значений.

## Репликация объектов при совместной работе приложений

Форма “ Репликация объектов из внешней базы данных” позволяет администратору импортировать объекты (субъекты, ценные бумаги, счета) из другой базы данных в текущую базу данных приложения. Эта возможность удобна при совместном использовании приложений FANSY-приложений и раздельных учетных базах хранения информации, а также для консолидации данных многофилиального распределенного офиса.

[Рисунок удалён: ID\_26]

### Репликация справочников

Форма поддерживает как режим индивидуальной репликации объектов, так и режим групповой репликации. Справочники, за исключением счетов Депо, не привязаны к учетной плоскости.

Важную роль играют следующие параметры репликации: способ групповой репликации и способ репликации субъектов.

Способ групповой репликации определяет режимы работы репликатора:

1. “Только добавление новых” – добавляются только новые (не обнаруженные в данной базе) объекты, старые объекты не обновляются;
2. “Обновление по дате с добавлением новых” - добавляются новые (не обнаруженные в данной базе) объекты, старые объекты обновляются если дата версии объекта в целевой базе более новая.
3. “Принудительное обновление” - обновляются только старые объекты, новые не заводятся

Для удобства пользователя на закладке "Ценные бумаги" предоставлена возможность репликации ценных бумаг по видам.

[Рисунок удалён: ID\_27]

### Репликация счетов ДЕПО

Перед репликацией счетов ДЕПО следует выбрать план счетов во внешней базе данных, Реплицируемые счета депо свяжутся с соответствующим планом счетов текущей учетной плоскости.

[Рисунок удалён: ID\_28]

### Репликация проводок и консолидация балансов

Для консолидации данных многофилиального распределенного офиса форма представляет возможность импорта проводок и документов.

Проводки жестко привязаны к учетной плоскости, поэтому перед репликацией следует выбрать учетную плоскость и план счетов во внешней базе данных.

[Рисунок удалён: ID\_29]

Репликация проводок происходит в соответствующий план счетов текущей плоскости базу данных.

Если задан флаг "Реплицировать аналитики?", то объекты А-регистров проводок будут автоматически реплицированы. Флаг следует задавать, если аналитика влияет на формы консолидированной отчетности, при этом не нужно будет отдельно реплицировать справочники, на базе которых построены регистры.

Если задан флаг "Реплицировать документы проводок?", то документы, породившие проводки, будут автоматически реплицированы. Флаг следует задавать, если присутствие документов влияет на формы консолидированной отчетности.

При консолидации балансов многофилиального предприятия следует в текущей базе данных создать учетные плоскости всех филиалов и реплицировать проводки филиала, выбрав нужную учетную плоскость.

Рекомендуемая процедура получения консолидированной отчетности:

1. Завести плоскости всех филиалов в базе данных головного отделения
2. Создать копию базы данных головного отделения и получить копии баз данных всех филиалов
3. Настроить алиасы на базы данных, полученные от филиалов
4. Реплицировать проводки из баз данных филиалов всякий раз выбирая соответствующую учетную плоскость
5. Из формы консолидированной отчетности получить необходимые отчеты

### Репликация документов

Кнопка "Репликация документов" позволяет реплицировать экземпляры документов. В настоящей реализации реплицируются только часть реквизитов документов, достаточная для просмотра журнала документов в режиме "Детализация: минимум о документе".

## Добавление нового конвертора данных

Рассмотрим пример, в котором компания торгует на ММВБ через субброкера «Алор-Инвест», который присылает реестр сделок в XLS файле следующего вида:

![](data:image/png;base64...)

Как организовать импорт реестра в данном формате? Если вы еще не специалист по написанию программ на языке Fansy-script, то пропустите данный раздел и обратитесь к разработчикам.

Система не импортирует напрямую данные из Excel-а. Сохранять файл в формате DBF так же не корректно, так как DBF формат не имеет тип ‘время’ и при сохранении Excel устанавливает формат полей в соответствии с текущими форматами столбцов. Поэтому будем сохранять файл в формате ‘текст с разделителями’ .CSV.

### Добавление новой операции

В меню Система->Формы->Отчеты… выведите список отчетов и операций, определенных для формы ‘Реестр сделок’.( см. документ Fansy.DOC п.п. «Отчёты и операции» )

Добавьте операцию ‘Получить реестр из Алор-Инвест’. Тип отчета - ‘Операция без внешнего файла’.

![](data:image/png;base64...)![](data:image/png;base64...)

### Код программы конвертирования данных

*//------------------------------------------------*

*// Получает новый реестр сделок из Алор-Инвест*

*//------------------------------------------------*

*var FILE\_NAME:='', S, I, J, C,*

*MARKET, RUR, PLACE, D\_DATE, SHARE, CONTRACT, COMMENT,*

*s\_ISSUER, s\_CLASS, s\_TYPE, s\_ISSUENUM,*

*INVESTOR, SHARE\_ACC, MONEY\_ACC, FIND\_RES,*

*Mess := '',TRADE\_DATE, IS\_NEW;*

*//\_\_ Запрашиваем имя файла с реестром*

*if not \_Metal\_F->OpenDialog( 'Укажите файл реестра сделок из Алор-Инвест', '', '\*.csv','csv', FILE\_NAME ) then return(0) end;*

*//\_\_ Уточняем дату реестра*

*D\_DATE := Date( Request( 'Уточните дату реестра', Date(NOW) ) );*

*//\_\_ Читаем реестр*

*FileToList( File\_Name );*

*I := 1; {первую строчку пропускаем, там лежат заголовки колонок}*

*C := ListCount( \_Metal\_F.Globals.L );*

*with 'Данные' do*

*While I < C do*

*s := ListGet( \_Metal\_F.Globals.L, I);*

*if I=1 then // если есть хоть одна запись, то документ 'Реестр' есть*

*//\_\_ Определяем ID для Алора*

*try MARKET := Extract1( 'Данные', 'select F.SELF\_ID from OD\_FACES F where F.LAST\_FLAG=1 and F.MNEM="АЛОР"' );*

*except raise( 'Не определено юр.лицо с мнемоникой "АЛОР"' );*

*end;*

*//\_\_ Ищим ID рублей*

*RUR := Extract1( 'Данные', 'select VALUE\_ID from PR\_GET\_BASE\_CURR(0)');*

*//\_\_ Ищем цепочку хранения, которая упирается концом в ММВБ*

*PLACE := Extract( 'Данные', "select ID from OD\_CHAINS where NAME='АЛОР->ДРС'" );*

*if IsNull( PLACE ) then raise( "Не обнаружена цепочка хранения 'АЛОР->ДРС'" ); end;*

*//\_\_\_ вставляем / ищем OD\_DOCS / D\_B\_REESTR\_HEAD*

*IS\_NEW:=\_F\_REE->Add\_REE( D\_DATE, MARKET, 'Алор-Инвест' );*

*end;*

*//\_\_ Выворачиваем код бумаги*

*SHARE := Clear( 0 );*

*// пробуем сначала по мнемонике*

*SHARE := Extract( 'Данные', 'select SHARE from OD\_VALUE\_CODERS where CODER=:CODER and CODE=:CODE', MARKET, \_Metal\_F->Token( S, ',;', 2) );*

*// ну если и теперь ни чего то спрашиваем у USER-а*

*if IsNull( SHARE ) then*

*if not \_COND\_BODY\_F->Select\_in\_Box(*

*'Данные',*

*List('select S.ID, S.MNEM, I.NAME, C.NAME as CN, T.NAME as TN, S.ISSUENUM',*

*'from OD\_SHARES S, OD\_FACES I, OD\_SYS\_TABS T, OD\_SYS\_TABS C',*

*'where I.SELF\_ID=S.ISSUER and I.LAST\_FLAG=1 and C.CODE="SHARE\_CLASS" and C.NUM=S.CLASS and ((T.CODE="A\_SHARE\_TYPE" and S.CLASS=1) or (T.CODE="O\_SHARE\_TYPE" and S.CLASS=2) or (T.CODE="T\_SHARE\_TYPE" and S.CLASS=4)) and T.NUM=S.TYPE\_',*

*'order by S.ISSUER'*

*),*

*List('NAME=Эмитент;20','MNEM=Мнемоника;15', 'CN=Класс;10', 'TN=Тип;15', 'ISSUENUM=Выпуск'),*

*'S.ID',*

*'Укажите ЦБ( '+\_Metal\_F->Token( S, ',;', 2)+')',*

*'Отказ от операции',*

*'Не найдено какую ЦБ в "Алор-Инвест" кодируют как '+#13+#10+\_Metal\_F->Token( S, ',;', 2)+#13+#10+'Если эта ЦБ уже введена в справочнике'+#13+#10+'Выберите её.',*

*SHARE*

*) or IsNull( SHARE ) then*

*Abort;*

*end;*

*ExecSQL( 'Данные', 'delete from OD\_VALUE\_CODERS where CODER=:CODER and SHARE=:SHARE', MARKET, SHARE );*

*ExecSQL( 'Данные', 'insert into OD\_VALUE\_CODERS ( CODER, SHARE, CODE ) values (:CODER, :SHARE, :CODE )', MARKET, SHARE, \_Metal\_F->Token( S, ',;', 2) );*

*end;*

*//\_\_ Получем счет*

*COMMENT := Trim(\_Metal\_F->Token( S, ',;', 7));*

*CONTRACT := Clear(0);*

*INVESTOR := \_Sys\_setings\_f.OD\_SETS.\_WHOS;*

*SHARE\_ACC := Clear(0);*

*MONEY\_ACC := Clear(0);*

*FIND\_RES := 0;*

*for 'Данные'*

*select "select VC.VAL, VS.VAL, VM.VAL from OD\_OPERATORS O "+*

*"join OD\_DOC\_CATS C on C.SYS\_NAME='SUB\_FACES' "+*

*"left outer join OD\_DOCS D on D.D\_CAT=C.ID and D.WHOS=O.U\_FACE "+*

*"left outer join OP\_FIELDS FD on FD.OP=C.ID and FD.AS\_NAME='CODE' "+*

*"left outer join OP\_FIELDS FC on FC.OP=C.ID and FC.AS\_NAME='CONTRACT' "+*

*"left outer join OP\_FIELDS FS on FS.OP=C.ID and FS.AS\_NAME='SHARE\_ACC' "+*

*"left outer join OP\_FIELDS FM on FM.OP=C.ID and FM.AS\_NAME='MONEY\_ACC' "+*

*"left outer join D\_OP\_VAL VD on VD.DOC=D.ID and VD.DESCR=FD.ID and VD.VAL=:CODE "+*

*"left outer join D\_OP\_VAL VC on VC.DOC=D.ID and VC.DESCR=FC.ID and VC.LINE=VD.LINE "+*

*"left outer join D\_OP\_VAL VS on VS.DOC=D.ID and VS.DESCR=FS.ID and VS.LINE=VD.LINE "+*

*"left outer join D\_OP\_VAL VM on VM.DOC=D.ID and VM.DESCR=FM.ID and VM.LINE=VD.LINE "+*

*"where O.USER\_ID=USER and VD.DOC is not null"*

*from COMMENT*

*into CONTRACT, SHARE\_ACC, MONEY\_ACC*

*do*

*FIND\_RES:=1;*

*end;*

*Assert( FIND\_RES, 'Строка '+str(I)+'. Нет данных по коду клиента ('+COMMENT+') !');*

*if not IsNull( CONTRACT ) then*

*INVESTOR := Extract('Данные', 'select INVESTOR from D\_B\_CONTRACTS where DOC='+CONTRACT );*

*end;*

*//\_\_*

*TRADE\_DATE := DateTime( Float(D\_DATE)+Float(Time(\_Metal\_F->Token( S, ',;', 1))));*

*//\_\_ Вставляем / Ищем строку в D\_B\_REESTR*

*\_F\_REE->Add\_To\_Ree( I, // %LINE*

*iif(\_Metal\_F->Token( S, ',;', 3)='BUY',1,2), // %OP*

*SHARE, // %SHARE*

*iif(\_Metal\_F->Token( S, ',;', 3)='BUY', SHARE\_ACC, Clear(0)), // %B\_ACC*

*iif(\_Metal\_F->Token( S, ',;', 3)='BUY', Clear(0), SHARE\_ACC), // %S\_ACC*

*MONEY\_ACC, // %M\_ACC*

*Float(\_Metal\_F->Token( S, ',;', 6)), // %SUMMA*

*RUR, // %VAL*

*RUR, // %PAY\_VAL*

*Float(\_Metal\_F->Token( S, ',;',4)), // %PRICE*

*Float(\_Metal\_F->Token( S, ',;',5)), // %AMOUNT*

*0.0, // %TAX\_T*

*0.0, // %TAX\_R*

*0.0, // %TAX\_M*

*I, // %TRANS*

*INVESTOR, // %INVESTOR*

*CONTRACT, // %CONTRACT*

*TRADE\_DATE, // %TRADE\_DATE*

*TRADE\_DATE, // %DELIVERY\_DATE*

*TRADE\_DATE, // %PAYMENT\_DATE*

*COMMENT, // %COMMENT*

*PLACE, // %PLACE*

*1, // %IS\_CLEAR*

*Clear(0), // %TRADER*

*Clear(0), // %DEPO*

*IS\_NEW*

*);*

*//\_\_*

*Inc( I );*

*end; // while*

*end; // with*

*if (Mess<>'') then Message( Mess ) end;*

### Корректировка информации о субброкере

Операция создает реестр сделок на торговой площадке ‘Алор-Инвест’, при этом субъект ‘Алор-Инвест’ определяется по мнемонике ‘АЛОР’ ( строка 23 кода).

В справочнике юридических лиц добавьте ‘Алор-Инвест’. Укажите ему краткое наименование АЛОР. На закладке ‘Вид деятельности’ укажите ‘Организация торговли фондами’.

### Добавление нового места хранения

Место хранения определяется как цепочка хранения ( строка 29 кода) с именем ‘АЛОР->ДРС’. Определите в форме ‘Цепочки корреспондентских отношений’ цепочку с соответствующим именем.

### Задание кодов ценных бумаг

Каждая торговая площадка кодирует ЦБ по-своему. Как именно можно видеть в форме ‘Справочник выпусков ценных бумаг’. В закладке ‘Взгляд’ выберите коды с точки зрения торговой площадки – это те коды, которые указаны в присланном реестре. Впрочем, если не расставите коды заранее, то операция во время своего выполнения спросит вас: какой именно финансовый инструмент, из определенных в справочнике ранее, организатор торгов кодирует тем или иным образом.

Наиболее информативной колонкой в приведенном примере реестра является колонка ‘Cчет’. Реально это код инвестора, по которому бэк-офис должен определить договор, по которому совершена сделка, а также счета учета денег и ЦБ.

Для выполнения этой задачи предлагается классификатор ‘Коды инвесторов с точки зрения cубброкера’. В форме ‘Классификаторы’ можете дать ему более благозвучное имя. Важен лишь системный код ‘SUB\_FACES’, по которому операция выбирает именно этот классификатор (строка 74 кода).

### Заполнение классификатора

![](data:image/png;base64...)

Если вы укажите в классификаторе не только счет учета ЦБ, но счет учета денег, то в ‘Справочнике счетов субъектов во внешних хранилищах’ можно не указывать счет платежа против поставки (их не всегда можно однозначно сопоставить).

![](data:image/png;base64...)

### Особенности

Стоит обратить внимание на следующие возможные творческие доработки операции:

* Порядок колонок в присылаемом реестре может быть отличным. Проверьте обращения к колонкам в вызовах типа *\_Metal\_F->Token( S, ',;',* ***<COL\_NUMER>****)*
* Ключевым словом типа операции, рассмотренном примере, является ‘BUY’ (строки 98, 100, 101).
* В рассмотренном примере, количество ЦБ в операции указано в штуках. Если вы имеете дело с реестром, где количество указано в лотах, то его проще всего получать, как отношение обшей суммы и цены за единицу

Внимание. Следует помнить, что отчеты и операции хранятся как часть метаданных. Следовательно, при обновлении версии в рассылке новых метаданных пользовательские операции будут перетерты. Храните в личном архиве текст инициализации операции.

## Настройка справочника отчётов

Администратору дана возможность добавлять в приложение отчёты. Для этого ему предоставляется справочник отчётов, доступный из меню «Система->Формы->Отчеты/действия» главной формы приложения:

[Рисунок удалён: ID\_30]

[Рисунок удалён: ID\_31]

Здесь администратор приложения может добавлять новые отчёты, менять названия, тип и инициализирующий код добавленных ранее отчётов и удалять их. На закладке "Системные отчёты" отображаются описания отчётов размещённые в базе МетаДанных. Они обновляются с каждой новой версией или при приёме соответствующих изменений в виде сообщений. На закладке "Пользовательские отчёты" отображаются описания отчётов, размещённые в базе Данных и они не меняются при установке новой версии. Новые отчёты рекомендуется добавлять на закладку "Пользовательские отчёты". В случае, когда пользовательский отчёт строится как копия системного, его можно создать на закладке "Пользовательские отчёты" нажатием на кнопку "Копировать в пользовательские". Перед этим надо выбрать системный отчёт, который должен быть скопирован.

Справочник может показывать отчёты для всех форм или для одной выбранной формы, которая выбирается в верхней части справочника в поле «Фильтр по форме».

Редактирование справочника происходит обычным образом. Поле «Форма» можно менять только в режиме вставки.

Отчёту задаётся тип шаблона и тип выходного файла. Допустимы следующие типы:

|  |  |  |
| --- | --- | --- |
| Тип шаблона | Тип выходного файла | Комментарий |
| DOT | DOC | Отчёт формата MS Word; шаблон задаётся файлом <Идентификатор\_отчёта>.dot – стандартный шаблон для MS Word |
|  |  | XLT XLS Отчёт формата MS Excel; шаблон задаётся файлом <Идентификатор\_отчёта>.xlt – стандартный шаблон для MS Excel; для формирования используется технология OLE-Automation |
| XLT | XLS | Отчёт формата MS Excel; шаблон задаётся файлом <Идентификатор\_отчёта>.xlt – стандартный шаблон для MS Excel; для формирования используется технология OLE-Automation |
| XLS | XLS | Отчёт формата MS Excel; устаревшая технология; шаблон задаётся двумя файлами <Идентификатор\_отчёта>.xls и <Идентификатор\_отчёта>.xlt; для формирования используется технология DDE |
| OPE <пусто> | XML HTML TXT | Текстовой отчёт; код (шаблон) отчёта расположен в базе данных; отображается и редактируется на закладке "Инициализация" |
| OPE | <пусто | > Действие (не отчёт), код которого находится в базе данных; отображается и редактируется на закладке "Инициализация" |

Идентификатор отчёта это имя файла-шаблона без расширения (если есть шаблон). Все эти файлы лежат в одной директории, путь к которой задаётся в окне «Параметры» (меню: Вид / Параметры...) на закладке «Директории» в поле «Отчёты для приложения».

Процесс создания (редактирования) шаблонов описан в "Руководстве программиста".

Рядом с полями для редактирования функции инициализации есть кнопки для проверки синтаксиса функции.

[Рисунок удалён: ID\_32]

## Настройка параметров приложения

Из пункта меню «Вид->Параметры...» вызывается модальная форма «Парметры»,

На первой странице параметров показываются имена Алиасов Баз Данных, к которым подключено приложение. В этом месте (как и в редакторе соединений) имеется возможность изменить алиасы. Поменяв Алиасы в этой форме следует перезагрузить приложение

[Рисунок удалён: ID\_33]

Fansy-приложение со стандартной главной формой обращается к двум базам данных: к данным предметной области («Данные») и к словарю данных («Метаданные»). Для этого должно быть заведено два алиаса в редакторе соединений. Главная форма приложения по умолчанию настроена так, что подключение происходит к алиасам DATA\_BASE и META\_BASE (предметная область и словарь данных, соответственно).

Алиасы создаются и редактируются средствами редактора соединений. Они могут указывать на одну физическую базу данных или на разные.

Приложения могут быть перестроены на другие алиасы. Это делается двумя способами: в вызываемой из пункта меню «Вид-> Параметры...» модальной форме «Параметры» на странице «Общие» или в редакторе соединений. При изменении имена алиасов на форме «Параметры» приложение надо перезагрузить.

Вторая страницы формы «Параметры», соответственно «Размещение», имеет отношение к экспорту данных.

[Рисунок удалён: ID\_34]

Третья страница формы «Параметры», соответственно «Флаги», предназначена для системных настроек.

Четвертая страницы формы «Параметры», соответственно «Строки», предназначена для настроек SMTP сервера.

[Рисунок удалён: ID\_35]

## Настройка компонентов форм

Из пункта меню «Система->Формы->Компоненты...» главной формы приложения вызывается модальная форма «Компоненты», представляющая информацию о классе и имени **активной** формы и всех ее компонентах. Для визуальных компонентов указываются: общее количество на форме, имена, классы и значения свойств Caption/Text, Parent, Top, Left, Height, Width, Hint компонентов. Для невизуальных компонентов указываются: общее количество на форме, имена, классы и значения свойства Active компонентов. Информация о форме и ее компонентах необходима **администратору приложения** для манипулирования ими (изменения размеров и расположения компонентов, привязки метафункций к кнопкам, определения правил бизнеса) на **языке системного интерпретатора** в процедурах инициализации и финализации форм, задаваемых в метаданных.

Из пункта меню «Система->Формы->Редактор...» главной формы приложения вызывается немодальная форма «Редактор форм», позволяющая создавать новые контролы и редактировать свойства имеющихся контролов. Само по себе редактирование формы результата не даёт, то есть при повторном открытии форма останется прежней. Работы по редактированию форм следует поручить Администратору приложения, который с использованием кнопки «Показать» воспользуется сформированным кодом на языке системного интерпретатора путем копирования его в буфер (clipboard) и дальнейшим размещением в процедурах инициализации и финализации формы. (см. Руководство программиста)

[Рисунок удалён: ID\_36]

# Использование криптографии

**Основные понятия**

1. Шифрование – преобразование открытой (незашифрованной) информации в закрытую(зашифрованную) и обратно.
2. ЭЦП (Электронная Цифровая Подпись) – блок данных, который добавляется к исходному сообщению и позволяет получателю проверить источник и целостность сообщения. На основании Федерального закона об электронной цифровой подписи, ЭЦП признается равнозначной собственноручной подписи в документе на бумажном носителе, при соблюдении ряда условий, описанных в этом законе.
3. Криптография – средства и методы преобразования данных с целью сокрытия их информационного содержания, предотвращения их необнаружимой модификации и/или несанкционированного использования.
4. Криптопровайдер – независимый модуль, позволяющий осуществлять криптографические операции.
5. ОК (Открытый ключ) – криптографический ключ, который связан с секретным (закрытым, личным) ключом. Открытый ключ известен всем пользователям системы и предназначен для проверки ЭЦП, а также шифрования данных.
6. ЗК (Закрытый ключ) – криптографический ключ, который связан с открытым ключом. Закрытый ключ известен только владельцу и предназначен для создания ЭЦП, а также дешифрации данных.
7. Цифровой сертификат (Сертификат) - выпущенный удостоверяющим центром, электронный документ, подтверждающий принадлежность владельцу открытого ключа.
8. Удостоверяющий центр (Центр сертификации, УЦ) - третья сторона, удостоверяющая аутентичность открытых ключей пользователей или других центров сертификации.

**Требования**

Электронный документ считается исходящим от участника ЭДО, если он подписан электронной цифровой подписью (далее - ЭЦП) уполномоченного лица данного участника. При направлении электронного документа участником ЭДО требуется обязательное использование сертифицированных средств ЭЦП, позволяющих идентифицировать владельца сертификата ключа ЭЦП, которым является уполномоченное лицо отправителя электронного документа.

Сертификат ключа ЭЦП выдается удостоверяющим центром. Отношения между участниками ЭДО и удостоверяющими центрами при осуществлении электронного документооборота регулируются соответствующими соглашениями. Сертификат ключа ЭЦП считается действующим в период срока его действия, либо до момента заявления о его недействительности участником ЭДО и/или удостоверяющим центром, либо до момента опубликования соответствующим удостоверяющим центром списка отозванных сертификатов, содержащего сведения о данном сертификате. Риск неправомерного подписания электронного документа несет участник ЭДО, на уполномоченное лицо которого зарегистрирован сертификат соответствующего ключа ЭЦП. С целью защиты информации, содержащейся в электронном документе, участники информационного обмена используют сертифицированные средства криптографической защиты.

Для использования криптографических возможностей системы FANSY, необходимы следующие дополнительные компоненты:

1. Криптопровайдер, сертифицированный ФСБ России
2. Сертификаты участников обмена зашифрованной и/или подписанной информацией.

**Криптопровайдер**

В качестве криптопровайдера должно использоваться программное обеспечение, сертифицированное ФСБ России, например, КриптоПро CSP (www.cryptopro.ru)

**Сертификаты**

Для использования криптографического функционала FANSY, в операционной системе должны быть установлены соответствующие сертификаты участников информационного обмена.

Получить личный сертификат можно в Удостоверяющем центре (http://cpca.cryptopro.ru/)

Сертификаты остальных участников информационного обмена (не являющиеся личными), можно запросить у их владельцев и импортировать в операционную систему.

Чтобы просмотреть список установленных сертификатов, необходимо вызвать консоль управления сертификатами. Подробнее о том как это сделать описано на сайте Microsoft (http://technet.microsoft.com/ru-ru/library/cc737635(WS.10).aspx).

**Экспорт сертификата**

Ваши личные сертификаты, с помощью которых вы можете устанавливать подпись, а также дешифровать данные, указаны в разделе «Личное»

[Рисунок удалён: ID\_37]

Вы можете экспортировать свои сертификаты другим участникам, для взаимодействия.

Для этого выберите необходимый сертификат, нажмите на нем правой кнопкой мышки и выберите в появившемся меню «Экспорт…». Появится Мастер Экспорта сертификата, следуя подсказкам системы (рекомендуется использовать пункты выбора по умолчанию), экспортируйте сертификат в файл. И перешлите данный файл остальным участникам информационного обмена.

**Импорт сертификата**

Если один из участников информационного обмена прислал вам сертификат, вы можете импортировать его в систему. Запустите файл сертификата как обычный файл и нажмите кнопку «Установить сертификат». Далее появится Мастер Импорта сертификата, следуя подсказкам системы (рекомендуется использовать пункты выбора по умолчанию), импортируйте сертификат в операционную систему.

Импортированный сертификат должен появится в разделе «Другие пользователи» консоли управления сертификатами

[Рисунок удалён: ID\_38]

**Действительность сертификатов**

Для использования криптографического функционала FANSY, необходимо чтобы все используемые сертификаты были действительны. Посмотреть статус сертификата вы можете, открыв карточку сертификата через консоль управления сертификатами.

В случае если сертификат не действителен, вы можете посмотреть причину, по которой его нельзя использовать, а также проследить путь сертификации, в котором будет подробно указана причина недействительности каждого сертификата из цепочки подтверждения.

[Рисунок удалён: ID\_39]

**Настройка криптозащиты исходящих сообщений**

Перед тем как использовать криптографический функционал FANSY в информационном обмене, вам необходимо договориться со вторым участником обмена о том, какие именно функции (ЭЦП, шифрование) вы будете использовать, а также обменяться сертификатами.

Для выбора используемых функций откройте форму «Настройка исходящих сообщении» и укажите параметры, которые вы планируете использовать. Эти параметры устанавливаются на закладке «Параметры постобработки сообщений» при означивании реквизита «Способ постобработки».

[Рисунок удалён: ID\_40]

В качестве сертификата отправителя, необходимо использовать один из ваших личных сертификатов, у которого есть закрытый ключ.

В качестве сертификата получателя для шифрования можно использовать как личный, так и чужой сертификат.

Для выбора соответствующего сертификата нажмите кнопку «Идентификатор». Она вызовет диалоговое окно, в котором справа будут отражены все возможные сертификаты, а слева информация о текущем сертификате. Выберите необходимый сертификат и нажмите кнопку OK.

[Рисунок удалён: ID\_41]

Поле «Идентификатор» не рекомендуется изменять вручную. Для более простого опознания сертификата, вы можете поменять поле «Наименование», на более удобное для вас.

**Настройка криптозащиты входящих сообщений**

Перед тем как использовать криптографический функционал FANSY в информационном обмене, вам необходимо договориться со вторым участником обмена о том, какие именно функции (ЭЦП, шифрование) вы будете использовать, а также обменяться сертификатами.

Для выбора нужных параметров откройте карточку операции «Прием сообщений из директории» Эти параметры устанавливаются на закладке «Параметры предобработки сообщений» при означивании реквизита «Способ предобработки».

[Рисунок удалён: ID\_42]

В качестве сертификата отправителя, необходимо использовать один из ваших личных сертификатов, у которого есть закрытый ключ.

В качестве сертификата получателя можно использовать как личный так и чужой сертификат.

Для выбора соответствующего сертификата нажмите кнопку «Идентификатор». Она вызовет диалоговое окно, в котором справа будут отражены все возможные сертификаты, а слева информация о текущем сертификате. Выберите необходимый и нажмите кнопку OK.

[Рисунок удалён: ID\_43]

Поле «Идентификатор» не рекомендуется изменять вручную, для более простого опознания сертификата, вы можете поменять поле «Наименование», на более удобное для вас.

При приеме зашифрованного или подписанного сообщения, можно также указать «Директорию для АРХИВНЫХ файлов»

[Рисунок удалён: ID\_44]

В эту директорию будут складываться исходные версии зашифрованных и/или подписанных документов, так как документ будет иметь юридическую силу только вместе с ЭЦП.

# Диагностика ошибок в ПО

Под дефектами ПО подразумеваются: 1) несоответствия функциональных возможностей ПО, оговоренным в Документации; 2) несоответствия ПО нормативным законодательным актам, в части форм отчетности и алгоритмов расчетов, действующим на дату поставки ПО. Под ошибкой в ПО подразумевается остановка работы какой либо функции ПО с сообщением об ошибке. Критической ошибкой считается ошибка ПО, делающая невозможным продолжение работы. К критическим ошибкам относятся следующее.

1. Несоответствия, приводящие к нарушению логической целостности базы данных ПО или невозможности входа в систему, выхода из системы.
2. Невозможность добавить, отредактировать или удалить бизнес-объект ПО, приводящая к остановке технологического процесса.
3. Невозможность корректного обмена (выгрузка или загрузка документов) при условии, что процедуры обмена разработаны Правообладателем и описаны в Документации
4. Некорректное отображение остатков по счетам в таблицах и формах ПО, при условии правильного ввода данных и корректной работе Пользователя с ПО согласно Документации.
5. Невозможность корректного своевременного получения регламентируемой отчетности, при условии, что этот отчет входит в набор дистрибутивных отчетных форм согласно Документации.
6. Невозможность корректной загрузки сделок и котировок с ММВБ, РТС и иных биржевых площадок.

При обнаружении дефектов и ошибок ПО, Пользователь обязан проинформировать Правообладателя посредством электронной почты или используя иные средства связи (телефон, факс) о факте выявления дефекта или ошибки и предоставить Правообладателю всю необходимую информацию (копии экранов, тексты сообщений об ошибках, обезличенную с помощью предоставленного Правообладателем скрипта копию базы данных), требуемую для устранения ошибок.

## Диагностика последней ошибки

В случае возникновения сообщения об ошибке надо прислать разработчикам диагностику этой ошибки. Для этого:

1) закройте окно с сообщением;

2) в меню «Система» выберите команду «Диагностика последней ошибки»;

![](data:image/png;base64...)

откроется окно «Ошибка»;

![](data:image/png;base64...)

3) проверьте, что клавиатура находится в Русском регистре; если нет – переключите в русский регистр;

![](data:image/png;base64...)

4) в окне «Ошибка» нажмите кнопку «Отправить» для отправки сообщения группе сопровождения; проверить отправленное письмо можно в установленной на рабочей станции почтовой программе, в папке «Отправленные»;

5) кнопка «Отправить» может не сработать, если установленная на рабочей станции почтовая программа не поддерживает данного сервиса или включена защита против программной отправки сообщений; в этом случае в окне «Ошибка» нажмите кнопку «Копировать»; должно появиться сообщение «Информация скопирована в буфер»; это означает что в буфере (clipboard) сейчас находится текст с полной диагностикой и его можно поместить в письмо командой Вставить (Paste) (Ctrl+V).

Эти действия надо выполнять СРАЗУ после появления ошибки. Иногда для более точного описания ситуации можно дополнительно скопировать в буфер экран, нажатием клавиши Print Screen. Содержимое экрана можно из буфера положить в документ MS Word командой Вставить (Paste) (Ctrl+V). MS Word хорошо сжимает такие картинки (что экономит почтовый трафик) и даёт их удобно просматривать.

Для того, чтобы кнопка «Отправить» работала корректно необходимо, чтобы были правильно настроены параметры отправки сообщений. Для настройки этих параметров в меню «Вид->Параметры» выберите закладку «Настройки SMTP».

## Обезличивание базы данных

По просьбе разработчиков с целью ускорения процесса разбора сложных ситуаций Пользователь может выслать обезличенную копию базы данных. Обезличенная копия база данных не содержит информации о юридических и физических лицах, о денежных счетах и счетах депо. В соответствующих справочниках все реквизиты стёрты, а наименования изменены на числовые идентификаторы.

Для обезличивания базы данных в комплект поставки входит скрипт **Anonym.sql**

**Внимание: Такой скрипт можно запускать только над КОПИЕЙ базы данных. Действие скрипта необратимо. Небрежное обращение с ним может привести к потере боевых данных.**

После обезличивания база данных может быть свёрнута (Backup) средствами СУБД, далее сжата одном из стандартных архиваторов с паролем и отправлена по почте или FTP.

# Установка обновлений

## Получение архивов для проведения изменений в системе

Fansy-приложения работают в двухуровневой архитектуре, поэтому обновления как правило состоят из 2-х частей: Серверной и Клиентской. Уведомление об обновлении приходит по электронной почте в виде писем со следующими темами:

1. v4.55a: обновление базы данных с версии 4.12c, до 4.13a (firebird) (14.01.24 21:49)
2. v4.55a Fansy-DEPO: обновление с версии 4.12c, до 4.13a (14.01.24 21:51)

Первое обновление является обновлением Серверной части приложения. Они могут различаться по типам СУБД: для Firebird, PostgreSQL, MSSQL и Oracle эти обновления будут разными.

Второе обновление – это обновление Клиентской части. Они различаются по приложениям: для Fansy-DEPO, Fansy-SPECTRE, Fansy-STANDARD, Fansy-REESTR, Fansy-TRUST и т.д. эти обновления будут разными. Наименование такого обновления всегда начинается с наименования приложения, для которого оно предназначено.

Обновления скачиваются на клиентской странице нашего сайта [www.fansy-service.ru](http://www.fansy-service.ru) в разделе «[Личный кабинет](http://www.fansy-service.ru/clients/)» в виде zip-архивов. Вход в раздел осуществляется с указанием известного имени входа и пароля. Также на клиентской странице сайта кроме обновлений можно посмотреть «Новости»; там описаны изменения в программах различных версий. Можно скачать обновлённую документацию «Документация Fansy-DEPO (14.10.24 15:09)».

Мелкие обновления могут выпускаться только для Клиентской части. Например:

1. v4.57b Fansy-DEPO: service pack 2 для версии 4.10b (13.10.24 18:39)
2. v4.57 Fansy-SPECTRE: Обновление опции ДУ (14.10.24 21:44)

Перед установкой обновления необходимо убедиться в том, что оно предназначено именно для той версии, которая сейчас установлена. Так обновления 3 из вышеприведённого примера предназначено для версии v4.57b; обновление 4 – для версии v4.45; обновления 1 и 2 для версии v4.55a. Посмотреть текущую версию можно в заголовке приложения:

![](data:image/png;base64...)

## Содержание архивов с обновлениями

Обновление Серверной части приложения содержит в своём наименовании вид СУБД: firebird, firebird d3, mssql; oracle. Оно применимо для любого Fansy-приложения. Архив с этим обновлением содержит следующие файлы и директории.

1. Директория SCRIPTS содержит SQL-скрипты для изменения структуры базы данных. Скрипты выполняются в алфавитном порядке.
2. Директория BASES содержит файл с образом новой базы метаданных: для firebird содержится файл zzz\_META.fbk; для ms sql файл zzz\_META.bak; для oracle два файла– meta.dmp и meta.log. Этот образ разворачивается в базу метаданных, целиком заменяя собой прежнюю.
3. Директория IB\_UDF содержит библиотеку функций для СУБД Firebird. Для диалекта 1, работающего под MS Windows, используется файл ib\_Fansy.dll; для диалекта 3 – ib\_Fansy\_3.dll; для Firebird, работающего под Linux, используются файлы в директории IB\_UDF/ForLinux для компиляции библиотеки ib\_Fansy.
4. Директория MAKER (поставляется опционально) содержит SQL-скрипты для создания структуры чистой базы данных, для создания синонимов и для расстановки прав на физические объекты базы данных. Скрипты из этой директории выполняются только в специально оговоренных случаях.

Некоторых из этих директорий может не быть, если изменений соответствующего компонента не требуется.

Обновление Клиентской части приложения содержит в своём наименовании название приложения: Fansy-SPECTRE, Fansy-DEPO или другое. Оно применимо для всех видов СУБД. Архив с этим обновлением содержит следующие файлы и директории.

1. exe-файл приложения (SPECTRE.exe, DEPO.exe и другие).
2. Другие exe и dll-файлы (реализующие некоторые функции приложения).
3. hlp-файлы контекстной подсказки.
4. Иные файлы в директории приложения, необходимые для работы приложения.
5. Директория REPORT содержит шаблоны отчётов.
6. Директория MACROS содержит xtr, xsd-схемы и им подобное.
7. Директории DOC содержит обновлённую документацию.
8. Директории MESSAGES содержит системные сообщения (файлы с расширением MSG) для обновления бизнес-логики работы приложения.

В некоторых обновлениях системные сообщения могут находиться непосредственно в корневой директории архива.

Некоторых из этих директорий и файлов может не быть, если изменений соответствующего компонента не требуется.

## Установка обновления Серверной части приложения

### Обновление серверной части в FIREBIRD

Проследите, чтобы все пользователи вышли из приложения. Рекомендуется переместить exe-файл приложения в архивную директорию, чтобы пользователи не вошли в приложение, пока будет происходить обновление.

Сделайте резервное копирование базы данных BASES\zzz\_sp\_DATA.fdb и базы метаданных BASES\zzz\_sp\_META.fdb (где zzz – буквенно-цифровой код базы, sp – код приложения, не обязательный). Рекомендуется выполнить обратное разворачивание базы данных из backup-архива. Именно, при разворачивании возможно обнаружить ошибки, связанные с нарушением целостности данных. Необходимо обратить внимание на листинг – нет ли в конце сообщения об ошибке. Если есть, то необходимо признать базу данных испорченной и разбираться со структурой данных (в соответствии с сообщением). ВНИМАНИЕ: никогда не разворачивайте backup-архив в файл с существующей базой данных; при неудачном разворачивании база получится испорченной. Всегда разворачивайте backup-архив в новый файл, а старую базу оставьте до тех пор пока не убедитесь в безошибочной распаковки.

Обновить библиотеку функций ib\_Fansy.dll (для диалекта 3 обе – ib\_Fansy\_3.dll и ib\_Fansy.dll; для Linux – из директории UDF\Linux) из директории UDF. Если сервер 64х-битный или 32х-битный, установленный под MS Windows, то функции для них находятся в директориях Win64 и Win32 соответственно. Библиотеку скопировать вместо одноимённой в директорию UDF сервера (например: в C:\Program Files\Firebird\Firebird\_2\_5\UDF). Эта библиотека обновляется не с каждым обновлением базы данных; когда новых функций не появляется, библиотека остаётся прежней.

ВНИМАНИЕ: не пытайтесь выполнять скрипты со старой библиотекой функций. Они будут выполняться с ошибками.

Выполните скрипты SCRIPTS\src000x.sql (где 000 – номер устанавливаемой версии, x – буквенный индекс версии) для изменения структуры базы данных zzz\_sp\_DATA.FDB в порядке их нумерации. Скрипты можно выполнять:

1. утилитой ISQL.exe (интерфейс командной строки); входит в комплект СУБД; пример запуска:

"C:\Program Files\Firebird\Firebird\_2\_5\bin\isql" -i src000x.sql

1. утилитой IB Expert (оконный интерфейс); совместима со всеми версиями Firebird.

В начале скрипта должна быть команда подключения к базе данных (команда CONNECT). Её необходимо исправить, указав свой путь до базы данных. Обращаем Ваше внимание, что путь к базе данных указывается в терминах протокола TCP/IP. Например, если сервер установлен под MS Windows, то команда должна выглядеть примерно так:

connect 'server\_name:d:/fansy/bases/zzz\_sp\_DATA.fdb' user 'SYSDBA' password 'masterkey'

Следом за командой CONNECT должна быть команда проверки текущей версии базы данных. Эта команда сообщит об ошибке в случае, если версия базы данных не соответствует скрипту.

В случае, если скрипт выполнился с ошибкой, надо прервать установку обновлений и прислать ошибку в службу поддержки. Ни в коем случае не продолжайте установку до получения ответа от службы поддержки.

Разверните базу метаданных BASES\zzz\_META.fbk на место старых метаданных. Разворачивать можно:

1. утилитой DBXAdmin.exe (оконный интерфейс); входит в комплект Fansy-приложения;
2. утилитой GBAK.exe (интерфейс командной строки); входит в комплект СУБД; пример запуска:

"C:\Program Files\Firebird\Firebird\_2\_5\bin\gbak" -c -user sysdba -password masterkey -v c:\fansy\update\411\bases\zzz\_META.fbk server\_name:c:\fansy\bases\zzz\_sp\_META.fdb

1. утилитой IB Expert (оконный интерфейс); совместима со всеми версиями Firebird.

### Обновление серверной части в Microsoft SQL Server

Проследите, чтобы все пользователи вышли из приложения. Рекомендуется переместить exe-файл приложения в архивную директорию, чтобы пользователи не вошли в приложение, пока будет происходить обновление.

Сделайте резервное копирование базы данных zzz\_sp\_DATA и базы метаданных zzz\_sp\_META (где zzz – буквенно-цифровой код базы, sp – код приложения, не обязательный).

Выполните скрипты SCRIPTS\src000x.ms.sql (где 000 – номер устанавливаемой версии, x – буквенный индекс версии) для изменения структуры базы данных zzz\_sp\_DATA в порядке их нумерации и скрипты t4\_000\_Func.sql, t5\_000\_Proc.sql, t8\_000\_Trigger.sql. Имена скриптам даются таким образом, чтобы, при сортировки директории SCRIPTS по имени, они выстраивались в правильном порядке для выполнения. Скрипты надо выполнять через Microsoft SQL Server Management Studio пользователем, которому назначена роль db\_owner.

В начале скрипта src000x.ms.sql должна быть команда проверки текущей версии базы данных. Эта команда сообщит об ошибке в случае, если версия базы данных не соответствует скрипту.

В случае, если скрипт выполнился с ошибкой, надо прервать установку обновлений и прислать ошибку в службу поддержки. Ни в коем случае не продолжайте установку до получения ответа от службы поддержки.

Разверните базу метаданных BASES\zzz\_META.bak на место старых метаданных. Разворачивать надо с помощью Microsoft SQL Server Management Studio.

К развёрнутой базе метаданных надо привязать пользователей. В свойствах каждого имени входа (Login Properties), работающих с приложением надо поставить флаг в колонке Схема (Map) напротив вновь-развёрнутой базы метаданных. Ниже надо указать роли базы (Database role): db\_datareader и db\_datawriter (роль public даётся по умолчанию).

![](data:image/png;base64...)

Не давайте пользователю других ролей (это будет препятствовать запуску приложения).

В конце каждого отчетного года секционируйте следующие таблицы: OD\_DOCS по полю D\_DATE, OD\_VALUE\_RATES по полю OFICDATE, OD\_WIRING по полю WIRDATE. Секционирование влияет на производительность системы.

### Обновление серверной части в ORACLE

Проследите, чтобы все пользователи вышли из приложения. Рекомендуется переместить exe-файл приложения в архивную директорию, чтобы пользователи не вошли в приложение, пока будет происходить обновление.

Сделайте резервные копии рабочей базы данных или дампы рабочих схем базы ORACLE. В простейшем случае для сохранения баз данных достаточно скопировать файлы \*.ctl, \*.dbf, \*.log при остановленном сервисе экземпляра базы данных.

Создайте полную копию рабочего экземпляра системы, которая может понадобиться в случае неудачной попытки обновления системы.

В случае SINGLE-инсталляции войдите в базу данных пользователем SYSDBA с ролью NORMAL, а в случае COMPLEX-инсталляции войдите в базу данных пользователем с именем схемы приложения и с ролью NORMAL, при этом необходимо чтобы эти пользователи были занесены в справочник операционистов приложения. Выполните скрипты ORA\_DATA\_XXX.SQL для изменения структуры базы данных в порядке их нумерации. Cкрипты выполнены без префиксации объектов базы данных схемой базы данных, следовательно они должны выполняться пользователем с именем схемы приложения и с ролью NORMAL. Не пытайтесь выполнять скрипты пользователем SYSTEM или с ролью, отличной от NORMAL: это приведет к созданию объектов в схеме данных SYSTEM, а не в схеме данных Fansy-приложения. Cкрипты могут выполняются утилитой SQLPlus, PLSQL Developer или любой аналогичной. Первой командой скрипта является команда проверки текущей версии базы данных. Версия базы данных всегда соответствует наименованию файла с последним скриптом на изменение структуры базы данных. Для контроля отсутствия ошибок при прогоне скрипта рекомендуется создавать лог-файл:

Sql>set echo on;

Sql>spool ora\_data\_XXX.log;

Sql>@ora\_data\_XXX.sql;

Sql>spool off;

Не используйте команды copy/past для погружения скрипта в окно выполнения используемой утилиты, т.к. это может привести к искажению русско-язычного текста, содержащегося в скрипте, и, как следствие, к неработоспособности серверной части системы.

В случае возникновения ошибки при выполнении любого скрипта (ошибки видны при анализе ora\_data\_XXX.log-файла) восстановите сохраненную копию системы и свяжитесь с группой сопровождения. Не пытайтесь дважды выполнить один и тот же скрипт. Перед повторным выполнением скрипта восстановите базу данных предыдущей версии из копии. Рекомендуется обязательно сохранить протокол выполнения скрипта в файл! В дальнейшем, в случае некорректной работы системы, копии всех протоколов прогона скриптов следует направить группе технического сопровождения системы.

Для замены метаданных выполните в ней команду DROP USER META CASCADE, затем заново создайте пользователя META. Проимпортируйте DMP-файл базы метаданных на место старых метаданных утилитой IMPDP, например командой:

impdp SYSTEM/pass@ORACLE\_BASE SCHEMAS=META DUMPFILE=meta.dmp

или

impdp SYSTEM/pass@BASE SCHEMAS=META REMAP\_SCHEMA=META:META41 DUMPFILE=meta.dmp

Дамп базы метаданных в сервисном центре создается командой:

expdp SYSTEM /pass@ORACLE\_BASE SCHEMAS=META DUMPFILE=meta.dmp.

После импорта базы метаданных для SINGLE-инсталляции желательно заново создать публичные или приватные синонимы на объекты метаданных для всех пользователей. Скрипты для создания синонимов поставляются опционально с дистрибутивом системы (директория MAKER): файл ORA\_META\_PUBLIC.sql и ORA\_META\_PRIVATE.sql.

В конце каждого отчетного года секционируйте следующие таблицы схемы SYSDBA: FS\_OD\_DOCS по полю D\_DATE, FS\_OD\_VALUE\_RATES по полю OFICDATE, FS\_OD\_WIRING по полю WIRDATE, PROP\_GARBAGE по полю OP\_DATE. Секционирование влияет на производительность системы.

### Обновление серверной части в PostreSQL

Проследите, чтобы все пользователи вышли из приложения. Рекомендуется переместить exe-файл приложения в архивную директорию, чтобы пользователи не вошли в приложение, пока будет происходить обновление.

Сделайте резервные копии рабочей базы данных или дампы рабочих схем базы PostgreSQL. Убедитесь, что резервная копия сформирована успешно.

Создайте полную копию рабочего экземпляра системы, которая может понадобиться в случае неудачной попытки обновления системы.

Войдите в базу данных пользователем SYSDBA с ролью с повышенными привилегиями. Выполните скрипты PG\_DATA\_XXX.SQL для изменения структуры базы данных в порядке их нумерации. Cкрипты выполнены без префиксации объектов базы данных схемой базы данных, следовательно они должны выполняться пользователем с именем схемы приложения. Для этого используйте команду «set schema ‘имя\_схемы’». Cкрипты могут выполняются утилитой pgAdmin 4, консоли pgsql и других средств. Первой командой скрипта является команда проверки текущей версии базы данных. Версия базы данных всегда соответствует наименованию файла с последним скриптом на изменение структуры базы данных.

Не используйте команды copy/past для погружения скрипта в окно выполнения используемой утилиты, т.к. это может привести к искажению русско-язычного текста, содержащегося в скрипте, и, как следствие, к неработоспособности серверной части системы.

В случае возникновения ошибки при выполнении любого скрипта (ошибки выводятся на экран используемой утилиты) восстановите сохраненную копию системы и свяжитесь с группой сопровождения. Не пытайтесь дважды выполнить один и тот же скрипт. Перед повторным выполнением скрипта восстановите базу данных предыдущей версии из копии.

В конце каждого отчетного года секционируйте следующие таблицы схемы SYSDBA: FS\_OD\_DOCS по полю D\_DATE, FS\_OD\_VALUE\_RATES по полю OFICDATE, FS\_OD\_WIRING по полю WIRDATE, PROP\_GARBAGE по полю OP\_DATE. Секционирование влияет на производительность системы при большом числе записей в таблице.

## Установка обновления Клиентской части приложения

Архив с обновлением Клиентской части приложения представляет собой набор файлов, которые надо скопировать в директорию приложения и заменить ими старые файлы.

Перед этой заменой старые файлы необходимо сохранить в архивной директории; это нужно для того, чтобы была возможность вернуться к предыдущей версии. Замене могут подлежать все или некоторые из следующих файлов:

* исполняемый файл приложения (SPECTRE, DEPO или другие);
* другие библиотечные файлы \*.so, \*.dll (реализующие некоторые функции приложения);
* иные файлы из директории приложения;
* шаблоны отчётов в директории REPORT;
* файлы в директории MACROS (xtr, xsd-схемы и им подобные);
* файлы в директории DOC (обновлённая документация)

Особым образом обрабатываются файлы с расширением \*.mes, содержащиеся в архиве обновления в директории MESSAGES либо в корневой директории архива. Они предназначены для изменения бизнес-логики приложения.

Их необходимо скопировать в специальную директорию (обычно C:\POST) и обработать следующим образом.

1. Запустить обновляемое Fansy-приложение (Fansy-SPECTRE, Fansy-DEPO или иное); войдя в него пользователем SYSDBA.
2. Открыть в приложении Журнал документов (меню: Форма – Открыть – Журнал докуменетов).
3. На первой закладке Журнала документов выбрать категорию «Прием сообщений из директории»; найти в журнале документ, который настроен на нужную директорию (в карточке документа должна быть указана правильная директория – обычно C:\POST); если документа нет, его можно создать на закладке «Новый документ».
4. Выполнить директиву документа «Прием файлов из почтовой директории и обработка полученных сообщений» (меню: Документ – Выполнить – Прием файлов из почтовой директории и обработка…).

![](data:image/png;base64...)

Если создан новый документ, то надо будет сперва выполнить директиву «Регистрация»

1. Обработка сообщений может занять несколько минут. По окончании откроется окно с информацией «Принято сообщений 14; все успешно распакованы». В случае НЕ успеха сообщить в службу поддержки.

В случае иного способа обработки сообщений (например, непосредственно из категории «Входящие сообщения») следует иметь ввиду, что более новые сообщения следует обрабатывать позже более старых, т.е. в хронологическом порядке. Обработка в неправильном порядке приведет в общем случае к тому, что более старый код ляжет поверх более нового, что, в общем случае, приведет к непредвиденной ошибке.

# Типовые ошибки при инсталляции системы

***Вопрос:*** Приложение молча зависает при первом запуске.

***Ответ:*** Это возможно, когда запускается приложение, использующее шлюз DBX (dbExpress) и при этом в реестре не прописан путь до настроечных файлов DBX. Запустите сначала DBX Administrator (DBXAdmin.exe). При первом запуске он создаст нужные настройки; заодно настройте соединения.

***Вопрос:*** Не устанавливается драйвер ключа HASP; при установке «подвисает». А после его неудачной установки перестало работать другое программное обеспечение, установленное ранее.

***Ответ:*** Возможно, на рабочей станции были установлены пиратские копии другого программного обеспечения, использующие всевозможные взломщики защиты. Уберите взломщики и переустановите драйвер.

***Вопрос:*** Система запрашивает пароль пользователя в окне «Регистрация» и выдает ошибку:

Unknown database.

Alias: Метаданные

***Ответ:*** Прежде чем запускать систему следует инсталлировать сервер баз данных FIREBIRD и драйвера доступа к нему (FIREBIRD Client и DBX). Утилитой Admin следует специфицировать привязку баз данных к файлам операционной системы.

***Вопрос:*** Система запрашивает пароль пользователя в окне «Регистрация» и выдает ошибку:

Unknown database.

Your user name and password are not defined. Ask your database administrator to set up an FIREBIRD login.

Alias: Метаданные

***Ответ:*** Прежде чем запускать систему следует завести пользователей базы данных FIREBIRD сервера. Запустите утилиту Server Manager (IB v5.x) или IBConsole (IB v6.x).

***Вопрос:*** После старта программы на фоне окна "Инициализация форм" выскакивает следующая ошибка:

Справочник поля: PLAN\_ID содержит ошибки

General SQL error.

Invalid request BLR at offset 3443

Function F\_DOCNUMDATE is not defined

Module name or entrypoint could not be found.

После чего программа загружается, но ни одна функция не доступна?

***Ответ:*** Ошибка связана с неправильным размещением dll-библиотек, которые надо поместить в нужную директорию FIREBIRD сервера. Имя директории зависит от версии сервера. После копирования библиотек остановите и перезапустите сервер.

***Вопрос:*** Не формируется отчет в MS Excel, пишет: "Нет доступа к файлу. (C:\FANSY\REPORT\AppName.txt)"

***Ответ:*** Директория с отчётами должна быть открыта для записи. AppName.txt – это временный файл для формирования отчетов. Возможна ситуация когда этот файл не может открыться для записи, если имеет атрибут Read only. Тогда его можно просто удалить (он будет создан снова, уже без этого атрибута).

***Вопрос:*** Не формируется отчет в MS Excel, появилась форма "DDE-Serv off" с сообщением "Соединение закрыто", в MS Excel ничего не появляется.

***Ответ:*** Формированию отчётов препятствует защита от вирусов в MS Excel. В меню Сервис – Макросы – Безопасность установите уровень безопасности Средний или Низкий. При установке среднего уровня MS Excel будет перед формированием каждого отчёта спрашивать подтверждение у пользователя.

***Вопрос:*** Не формируется отчет в MS Excel с сообщением "Run-time error '13': Type mismatch"

***Ответ:*** В региональных настройках (Regional and Language Options) Windows установлен символ ',' (запятая) в качестве разделителя целой и дробной части чисел. Это делает невозможным обмен данными между двумя приложениями (при запуске приложение сообщало об этом). Надо заменить на символ '.' (точка). Другим приложениям это работать не мешает.

***Вопрос:*** Не формируется отчет в MS Excel с сообщением "Не могу установить свойство RightHeader"

***Ответ:*** У Вас установлен MS Excel, но не установлен ни один драйвер принтера. Без драйвера принтера любое приложение пакета MS Office может работать некорректно. Установите драйвер принтера.

***Вопрос:*** Возникает сообщение «Алиас xxx\_META указывает на базу, которая не содержит Данных Вашего приложения. Выберите другой алиас или перенастройте этот.»

(имя алиаса в сообщении может быть и другим)

***Ответ:*** Приложение входит в две базы данных и два раза запрашивает имя и пароль (см. п. Запуск системы). Первый запрос имени и пароля происходит при подключении к базе МЕТАДАННЫХ, там лежит информация о том, как должно вести себя приложение; потом происходит подключение к базе ДАННЫХ, где содержатся Ваши данные. Такое сообщение об ошибке говорит о том, что Вы во втором запросе выбрали ту же базу метаданных (тот же алиас), что и в первом запросе. Запустите ещё раз и не забудьте во втором запросе имени и пароля выбрать алиас базы ДАННЫХ (xxx\_DATA)

***Вопрос:*** Не запускается дистрибутив с сообщением о том, что невозможно запустить 16-битные приложения.

***Ответ:*** Надо настроить операционную систему так, чтобы в ней была такая возможность.

***Вопрос:*** Перед формированием отчёта возникает сообщение «Нарушение ограничений лицензии на объем транзакций. Свяжитесь с правообладателем!» или

«Вы дважды превысили допустимый объем сделок ( > 200 ) 14.03.2003

срок действия вашей версии истекает 14.04.2003» или тоже самое без указания даты с последующим закрытием приложения.

***Ответ:*** Лицензия приложения даёт право на определенное число сделок в день. Появление такого сообщения означает, что наступил день, в котором нарушен этот пункт лицензионного соглашения. Если число сделок превышено один раз или «срок действия вашей версии» еще не истёк, то работать ещё можно. Надо связаться с разработчиками и урегулировать вопрос.

***Вопрос:*** Не формируются отчёты с сообщением "не найден файл ole32.dll".

***Ответ:*** Речь идёт о формировании отчётов в MS Word. При этом используется MS Word из MS Office 2003. Иногда MS Word этой версии устанавливается некорректно. Не трогая MS Office в целом, деинсталлируйте MS Word и установите его заново.

***Вопрос:*** Не формируются отчёты с сообщением "Interface Not Supported".

***Ответ:*** Возможно, установлен 64-разрядный MS Office 2010. По признанию Microsoft это не рабочая версия. Microsoft рекомендует в этом случае установить 32-разрядный MS Office, даже если установлен 64-разрядный MS Windows.

***Вопрос:*** Приложение подключается к серверу MS SQL Server. Сразу после входа в базу данных появляется сообщение о том, что у пользователя нет прав на форму… Сообщение повторяется для каждой формы приложения.

***Ответ:*** Неправильно заведён пользователь на сервере MS SQL Server. У пользователя не должно быть никаких серверных ролей (Server Role), а из ролей базы данных ему достаточно задать только public, db\_datareader и db\_datawriter.

# HELPDESK - cлужба поддержки клиента

## Что такое Helpdesk

Fansy HelpDesk – это система поддержки клиентов использующих программные продукты Fansy.

**Основные возможности системы:**

* Прямая связь с разработчиками программного обеспечения. Вы сможете взаимодействовать не только с сотрудниками службы поддержки, которые помогут вам с постановкой задачи, но и с разработчиками системы.
* Хранение переписки в контексте заявок. Нет нужды искать нужную тему в архивах электронной почты.
* Почтовые уведомления при изменении заявки.
* Умный поиск заявок, сортировка и группировка по наиболее важным полям
* Подсветка в зависимости от состояния заявки. Все заявки подсвечиваются специальным образом в зависимости от текущего состояния. Ваша заявка не останется незамеченной, а наши сотрудники будут уведомлены, если на заявку долго не было ответа.

## Как работает Helpdesk

Если у вас появилась потребность связаться со службой поддержки, необходимо пройти по ссылке с нашего сайта и ввести свой Логин и Пароль, которые Вы получили при заключении договора. В случае утери параметров связи они могут быть присланы электронным письмом. После ввода параметров идентификации Вы увидите следующее окно:

![](data:image/png;base64...)![](data:image/png;base64...)

Вы можете зайти в хелпдеск напрямую, пройдя по адресу <http://helpdesk.fansy-service.ru> и ввести учетные данные. Используйте опцию «Оставаться в системе», чтобы дольше оставаться в сети. В противном случае необходимо будет вновь войти в систему после закрытия окна браузера.

![](data:image/png;base64...)

## Список заявок

Посмотреть перечень незакрытых заявок можно через меню «Актуальные заявки»:

![](data:image/png;base64...)

Для каждой заявки указываются общие параметры, такие как:

* номер заявки
* приоритет
* тип
* тема
* даты открытия и изменения
* срок исполнения
* ответственный сотрудник
* статус
* от кого ожидается ответ

Меню «Все заявки», отобразит Вам список всех заявок (как закрытых, так и нет), которые Вы когда-либо создавали.

Для поиска интересующей Вас заявки используйте общую строку поиска. Она поможет найти совпадения по всем параметрам заявки.

![](data:image/png;base64...)

Вы также можете использовать фильтр по полям «Тип», «Ответственный», «Ожидание ответа от» и «Статус» чтобы отфильтровать интересующие заявки.

![](data:image/png;base64...)

Кликнув по заголовку таблицы можно отсортировать список отображаемых заявок по возрастанию или убыванию.

Следует учитывать, что фильтрация и порядок отображения заявок сохраняется после выхода из системы. Настройки сохраняются отдельно как для журнала актуальных заявок, так и для журнала всех заявок.

## Просмотр заявки

Для просмотра заявки необходимо нажать на номер или тему заявки, либо дважды кликнуть по позиции заявки в таблице.

![](data:image/png;base64...)

На данной странице можно просмотреть информацию по заявке, прочитать сообщения сотрудника службы поддержки, написать свое сообщение либо закрыть её. Индикатор состояния заявки показывает текущий прогресс.

Для добавления нового сообщения необходимо нажать на кнопку «Добавить комментарий», расположенную прямо над перепиской.

![](data:image/png;base64...)

В ответ откроется форма добавления сообщений:

![](data:image/png;base64...)

К сообщению можно прикрепить вложения различных форматов. Вы можете прикрепить один файл к каждому сообщению, размером не более 20 мегабайт.

После того, как будет введен текст сообщения и нажата кнопка «Отправить», сообщение с прикрепленными вложениями будут добавлены к обсуждению заявки.

Ваши сообщения для удобства выделяются голубым цветом, сообщения сотрудника службы поддержки – зеленым. Заявки сотрудников так же отмечены специальной иконкой.

Сообщения сотрудника службы поддержки так же могут содержать вложенные файлы, которые потребуются для решения проблемы. Для того чтобы загрузить эти файлы, просто нажмите на имя или иконку требуемого файла. Загрузка файла начнется автоматически.

![](data:image/png;base64...)

Если по какой-либо причине Вам уже не требуется помощь по открытой заявке, Вы можете изменить ее статус на «Закрыта» или «Отменена».

![](data:image/png;base64...)

Нажмите на кнопку «Отменить заявку», чтобы прекратить дальнейшую работу с ней. Нажмите на кнопку «Завершить заявку», если нашим сотрудникам удалось решить Вашу проблему.

![](data:image/png;base64...)

Если проблема вновь повторится, Вы можете возобновить уже закрытую или завершенную заявку с помощью кнопки «Возобновить заявку».

## Создание новой заявки

Для того чтобы создать заявку, нажмите на кнопку «Создать новую заявку» на левой панели. Вы увидите следующую страницу:

![](data:image/png;base64...)

Для создания заявки необходимо заполнить необходимые поля:

1. Кратко сформулировать основную тему заявки и ввести ее в поле «Тема заявки». Чем точнее – тем лучше.
2. Выбрать тип заявки. Возможные варианты: «Ошибка», «Вопрос», «Доработка», «Иная проблема», «Доработка Fansy HelpDesk».
3. Укажите приоритет заявки. Приоритет определяет каким заявкам будет уделено больше времени в ущерб остальным Вашим заявкам.
4. Выбрать продукт, в котором возникла проблема.
5. Описать проблему. Для более оперативного решения проблемы, следует описать проблему наиболее подробно. Рекомендуется сопровождать заявку вложениями, которые могли бы помочь нашим сотрудникам при решении проблемы. Так, например, диагностику последней ошибки желательно сопровождать приложенным снимком экрана, чтобы мы могли понять, в какой именно момент возникла данная ошибка.

После того, как все данные будут введены, нажмите кнопку «Создать заявку», после чего заявка будет размещена в системе и наши сотрудники смогут её изучить.

## Предложения и замечания

Мы стремимся сделать систему удобнее. Любые Ваши предложения, замечания и пожелания по развитию системы вы можете оформить в виде заявки с темой «Доработка Fansy HelpDesk». Мы будем благодарны за помощь в развитии системы, ваши отзывы и предложения помогут нам двигаться в сторону повышения качества обслуживания.

1. Понятие «транзакция» зависит от используемого приложения и может означать следующее: 1) количество операций, обрабатываемых в день (как, например, в приложении Fansy-DEPO); 2) количество сделок покупки/продажи совершаемых в день (как, например, в приложениях Fansy-SPECTRE и Fansy-TRUST). [↑](#footnote-ref-1)